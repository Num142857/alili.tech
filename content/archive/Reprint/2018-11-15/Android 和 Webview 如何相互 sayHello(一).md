---
title: 'Android 和 Webview 如何相互 sayHello(一)' 
date: 2018-11-15 21:20:48
hidden: true
slug: r3totapgtp
categories: [reprint]
---

{{< raw >}}
<blockquote>&#x672C;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x4E00;&#x5171;&#x6709;&#x4E24;&#x7BC7;&#xFF1A;&#x4E3B;&#x8981;&#x6765;&#x8BB2;&#x89E3; webview &#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4EA4;&#x4E92;&#x3002;<br>&#x672C;&#x7BC7;&#x4E3A;&#x7B2C;&#x4E00;&#x7BC7;&#xFF1A;Android &#x548C; webview &#x7684;&#x4EA4;&#x4E92;<br>&#x540E;&#x7EED;&#x4E00;&#x7BC7;&#x662F;&#xFF1A;IOS &#x548C; webview &#x7684;&#x4EA4;&#x4E92;<br>&#x5982;&#x9700;&#x83B7;&#x5F97;&#x6700;&#x65B0;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x524D;&#x7AEF;&#x5C0F;&#x5409;&#x7C73;</blockquote><p>&#x5728;&#x79FB;&#x52A8;&#x65F6;&#x4EE3; Web &#x7684;&#x5F00;&#x53D1;&#x65B9;&#x5F0F;&#x9010;&#x6E10;&#x4ECE; PC &#x9002;&#x914D;&#x65F6;&#x4EE3;&#x8F6C;&#x5411; Hybird &#x7684; Webview&#x3002;&#x4EE5;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x4E00;&#x4E0B; PC Chrome &#x63D0;&#x4F9B;&#x7684;&#x51E0;&#x4E2A;&#x64CD;&#x4F5C;&#x884C;&#x4E3A;&#xFF0C;&#x6BD4;&#x5982; DOM&#x3001;BOM&#x3001;&#x9875;&#x9762; window.location &#x8DF3;&#x8F6C;&#x7B49;&#x7B49;&#x3002;&#x4F60;&#x7684;&#x4E00;&#x5207;&#x884C;&#x4E3A;&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x548C; &#x6D4F;&#x89C8;&#x5668;&#x6253;&#x4EA4;&#x9053;&#xFF0C;&#x53EA;&#x8981;&#x89C4;&#x89C4;&#x77E9;&#x77E9;&#x7684;&#x6309;&#x7167; W3C/MDN &#x4E0A;&#x9762;&#x7684;&#x6587;&#x6863;&#x5F00;&#x53D1;&#x5373;&#x53EF;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x9700;&#x8981;&#x4F60;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x622A;&#x5C4F;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x540E;&#x9762;&#x4E00;&#x67E5;&#x6587;&#x6863;&#xFF0C;&#x53D1;&#x73B0; API &#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x6CA1;&#x6CD5;&#x505A;&#xFF0C;&#x76F4;&#x63A5;&#x6253;&#x56DE;~</p><p>&#x540E;&#x9762;&#xFF0C;&#x4F60;&#x5F00;&#x59CB;&#x505A; Hybird APP&#xFF0C;&#x4EA7;&#x54C1;&#x53C8;&#x63D0;&#x4E86;&#x8FD9;&#x4E2A;&#x622A;&#x5C4F;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x4F60;&#x67E5;&#x4E86;&#x4E00;&#x4E0B;&#x6587;&#x6863;&#xFF0C;&#x53D1;&#x73B0; API &#x8FD8;&#x662F;&#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x5B66;&#x5C31;&#x5728;&#x8FB9;&#x4E0A;&#xFF0C;&#x4F60;&#x4E00;&#x62CD;&#x5927;&#x817F;&#x8BF4;&#xFF0C;&#x8001;&#x94C1;&#xFF0C;&#x7ED9;&#x6211;&#x4E00;&#x4E2A;&#x622A;&#x5C4F;&#x7684; jsbridge &#x6CA1;&#x95EE;&#x9898;&#x5427;&#xFF1F;</p><p>&#x5BF9;&#x4E8E; PC Web &#x548C; Hybird App &#x6765;&#x8BF4;&#xFF0C;&#x7ED9; HTML5 &#x5F00;&#x53D1;&#x8005;&#x6700;&#x76F4;&#x89C2;&#x7684;&#x611F;&#x53D7;&#x5C31;&#x662F;&#xFF0C;&#x4EE5;&#x524D; PC &#x4E0A;&#x4E00;&#x4E9B;&#x5E95;&#x5C42;&#x57FA;&#x7840;&#x529F;&#x80FD;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; App &#x91CC;&#x9762;&#xFF0C;&#x914D;&#x5408;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;&#x9664;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x7684;&#x533A;&#x522B;&#x70B9;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><ul><li>&#x4F7F;&#x7528; window.location&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x4E00;&#x5B9A;&#x80FD;&#x5B9E;&#x73B0;&#x8DF3;&#x8F6C;</li><li>unload &#x4E8B;&#x4EF6;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x4F1A;&#x89E6;&#x53D1;</li><li>302/301 &#x91CD;&#x5B9A;&#x5411;&#x95EE;&#x9898;&#x4F1A;&#x8BA9;&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x5B66;&#x5D29;&#x6E83;</li><li>https &#x8BC1;&#x4E66;&#x95EE;&#x9898; log&#xFF0C;&#x53EA;&#x80FD;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x5B66;&#x90A3;&#x53D6;</li><li>&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x62FF;&#x5230;&#x4F60;&#x7684; cookie</li><li>UA &#x7684;&#x5B9A;&#x5236;&#x9700;&#x8981;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x624B;&#x52A8;&#x8BBE;&#x7F6E;</li><li>ServiceWorker &#x5F00;&#x4E0D;&#x5F00;&#x8FD8;&#x5F97;&#x95EE;&#x5BA2;&#x6237;&#x7AEF;</li><li>&#x4E0D;&#x4E00;&#x800C;&#x8DB3;...</li></ul><p>&#x8FD9;&#x91CC;&#xFF0C;&#x5C06;&#x4ECE;&#x4E00;&#x4E2A; Web &#x5F00;&#x53D1;&#x8005;&#x7684;&#x89D2;&#x5EA6;&#x89E6;&#x53D1;&#xFF0C;&#x4ED4;&#x7EC6;&#x63A2;&#x5BFB;&#x4E00;&#x4E0B; Webview &#x5F00;&#x53D1;&#x4E0B;&#xFF0C;Web &#x5F00;&#x53D1;&#x8005;&#x5C06;&#x9047;&#x89C1;&#x54EA;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x4E86;&#x89E3;&#x548C; &#x5BA2;&#x6237;&#x7AEF; &#x4EA4;&#x4E92;&#x7684;&#x5E95;&#x5C42;&#x539F;&#x7406;&#x3002;&#x672C;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x5C06;&#x5206;&#x522B;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x5728; Android &#x548C; IOS &#x7CFB;&#x7EDF;&#x4E0B;&#xFF0C;&#x5F00;&#x53D1; Hybird APP &#x5927;&#x81F4;&#x6D41;&#x7A0B;&#x548C;&#x5176;&#x4E2D;&#x7684;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x3001;&#x4F18;&#x5316;&#x7684;&#x5730;&#x65B9;&#x3002;</p><blockquote>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x7684;&#x662F; Android &#x4E0B; Webview &#x7684;&#x5F00;&#x53D1;&#x3002;</blockquote><h2>tl;dr</h2><p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x4ECE; H5 &#x5F00;&#x53D1;&#x8005;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x7B80;&#x5355;&#x8BB2;&#x89E3;&#x4E00;&#x4E0B;&#x5728; Hybird &#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x76F8;&#x5173;&#x95EE;&#x9898;&#x548C;&#x5BF9;&#x5E94;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p><ul><li>android &#x4E24;&#x79CD;&#x8C03;&#x7528; H5 &#x7684;&#x65B9;&#x5F0F;</li><li>javascript &#x8C03;&#x7528; android &#x65B9;&#x5F0F;&#x7684;&#x5BF9;&#x6BD4;</li><li>jsbridge.js &#x6587;&#x4EF6;&#x7684;&#x8D77;&#x6E90;</li><li>android &#x5982;&#x4F55; inject JS &#x6587;&#x4EF6;</li><li>&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x4E8E; webview &#x7684;&#x6027;&#x80FD;&#x4F18;&#x5316;</li></ul><h2>Anriod &#x5F00;&#x53D1; Webview &#x57FA;&#x7840;</h2><p>Webview &#x5728; Android &#x91CC;&#x9762;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x800C;&#x5DF2;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x50CF;&#x5176;&#x4ED6;&#x7684; Android &#x7EC4;&#x4EF6;&#x4E00;&#x6837;&#x5728; screen &#x4E2D;&#x5B9A;&#x4F4D;&#x5E03;&#x5C40;&#x3002;&#x5BF9;&#x6BD4;&#x4E8E; HTML5 &#x5F00;&#x53D1;&#x6765;&#x8BF4;&#xFF0C;&#x53EF;&#x4EE5;&#x7C7B;&#x6BD4;&#x4E3A;&#x4E00;&#x4E2A; Div&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;webview &#x53EF;&#x4EE5;&#x91CD;&#x53E0; webview&#xFF0C;&#x540C;&#x4E00;&#x4E2A; screen &#x53EF;&#x4EE5;&#x5C55;&#x793A;&#x591A;&#x4E2A; webview &#x5185;&#x5BB9;&#x3002;</p><pre><code>&lt;RelativeLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    tools:showIn=&quot;@layout/activity_main&quot;&gt;
    &lt;WebView
        android:id=&quot;@+id/webview&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;/&gt;
&lt;/RelativeLayout&gt;</code></pre><p>&#x4E0A;&#x9762;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; webview-activity &#x5B9A;&#x4E49;&#x3002;&#x987A;&#x4FBF;&#x63D0;&#x4E00;&#x4E0B;&#xFF1A;<code>activity &#x662F; Android &#x5F00;&#x53D1;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E; Router &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5B50;&#x9875;&#x9762;</code>&#x3002;&#x6240;&#x4EE5;&#x8BF4;&#xFF0C;&#x4F60;&#x65B0;&#x6253;&#x5F00;&#x7684; webview &#x7684;&#x6837;&#x5F0F;&#x548C;&#x5E03;&#x5C40;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x7248;&#x672C;&#x624D;&#x80FD;&#x66F4;&#x65B0;&#x7684;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5FAE;&#x4FE1;&#x7684; webview-acitivit &#x548C; &#x624B;Q &#x7684; webview-activity &#x662F;&#x4E24;&#x4E2A;&#x5B8C;&#x5168;&#x4E0D;&#x4E00;&#x6837;&#x7684; activity.</p><p><span class="img-wrap"><img data-src="/img/remote/1460000016087106?w=1080&amp;h=1920" src="https://static.alili.tech/img/remote/1460000016087106?w=1080&amp;h=1920" alt="&#x624B;Q" title="&#x624B;Q"></span><span class="img-wrap"><img data-src="/img/remote/1460000016087107?w=1080&amp;h=1920" src="https://static.alili.tech/img/remote/1460000016087107?w=1080&amp;h=1920" alt="&#x5FAE;&#x4FE1;" title="&#x5FAE;&#x4FE1;"></span></p><p>&#x5728;&#x5B9A;&#x5236;&#x7279;&#x6709;&#x7684; acitvity &#x4E4B;&#x540E;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x7684; webivew&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5BF9; webview &#x505A;&#x76F8;&#x5173;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x56FE;&#x4E3A;&#xFF1A;</p><p><span class="img-wrap"><img data-src="/img/remote/1460000016087108" src="https://static.alili.tech/img/remote/1460000016087108" alt="image.png-55.5kB" title="image.png-55.5kB"></span></p><p>&#x53C2;&#x8003;&#x5B9E;&#x9645;&#x4EE3;&#x7801;&#x4E3A;&#xFF1A;</p><pre><code>// activity &#x7684; onCreate &#x4E8B;&#x4EF6;&#x4E2D;
WebView webView = (WebView) findViewById(R.id.webview);
webView.setWebViewClient(defaultViewClient);
webView.setWebChromeClient(mChromeClient);

// &#x8BBE;&#x7F6E; webSettings
WebSettings webSettings = webView.getSettings();
webSettings.setJavaScriptEnabled(true);
webSettings.setAllowContentAccess(true);
webSettings.setDatabaseEnabled(true);
webSettings.setDomStorageEnabled(true);


// &#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528; loadUrl&#xFF0C;&#x6765;&#x52A0;&#x8F7D;&#x9875;&#x9762;
webView.loadUrl(url);</code></pre><p>&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x3002;webview &#x672C;&#x8EAB;&#x53EA;&#x662F;&#x7528;&#x6765;&#x4F5C;&#x4E3A;&#x6253;&#x5F00; H5 &#x9875;&#x9762;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5176;&#x672C;&#x8EAB;&#x5E76;&#x4E0D;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5904;&#x7406;&#x9875;&#x9762;&#x4E4B;&#x95F4;&#x8DF3;&#x8F6C;&#x6216;&#x8005;&#x52A0;&#x8F7D;&#x4E8B;&#x4EF6;&#x7B49;&#x884C;&#x4E3A;&#x3002;&#x800C; setWebViewClient &#x548C; setWebChromeClient &#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x4F5C;&#x4E3A;&#x8865;&#x5145;&#x4F7F;&#x7528;&#x3002;&#x5177;&#x4F53;&#x89E3;&#x91CA;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;</p><ul><li>webview: &#x4EC5;&#x4EC5;&#x7528;&#x6765;&#x6E32;&#x67D3;&#x548C;&#x89E3;&#x6790;&#x9875;&#x9762;</li><li></li><li></li></ul><p>&#x66F4;&#x591A;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x53C2;&#x8003; Android &#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684; public method &#x67E5;&#x9605;&#x5373;&#x53EF;&#x3002;&#x5982;&#x679C;&#x5BF9; react &#x5F00;&#x53D1;&#x6709;&#x4E86;&#x89E3;&#x7684;&#x540C;&#x5B66;&#xFF0C;&#x5E94;&#x8BE5;&#x80FD;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E0A;&#x9762; public method &#x7684;&#x5927;&#x81F4;&#x542B;&#x4E49;&#x3002;&#x5F53;&#x8BBE;&#x7F6E;&#x5BF9;&#x5E94;&#x7684; webview &#x914D;&#x7F6E;&#x4E4B;&#x540E;&#xFF0C;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x5C31;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x5C31;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#xFF1A;</p><pre><code>WebView myWebView = (WebView) findViewById(R.id.webview);
myWebView.loadUrl(&quot;https://www.example.com&quot;);</code></pre><p>findViewById &#x548C;&#x524D;&#x7AEF;&#x7684; document.getElementById &#x5F88;&#x7C7B;&#x4F3C;&#xFF0C;&#x76F4;&#x63A5;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684; webview &#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x5229;&#x7528; loadUrl API &#x76F4;&#x63A5;&#x6253;&#x5F00;&#x6307;&#x5B9A;&#x7684;&#x5730;&#x5740;&#x3002;&#x540E;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4E3B;&#x8981;&#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#xFF0C;android &#x662F;&#x5982;&#x4F55;&#x548C; js &#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x7684;&#x3002;</p><h2>android &#x5982;&#x4F55;&#x548C; js &#x76F8;&#x4E92;&#x901A;&#x4FE1;</h2><p>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x63D0;&#x51FA;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x60F3;&#x4E00;&#x60F3;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48; android &#x548C; js &#x4E4B;&#x95F4;&#x4E00;&#x5B9A;&#x8981;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x5462;&#xFF1F;</p><p>&#x56DE;&#x60F3;&#x4E00;&#x4E0B;&#x5E73;&#x5E38;&#x7684; hybird &#x7684;&#x5F00;&#x53D1;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x5728;&#x524D;&#x7AEF;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x53E3;&#x6765;&#x83B7;&#x53D6;&#x76F8;&#x5173;&#x5185;&#x5BB9;&#xFF1A;</p><ul><li>&#x83B7;&#x53D6;&#x7528;&#x6237;&#x5730;&#x7406;&#x4F4D;&#x7F6E;</li><li>&#x83B7;&#x53D6;&#x7528;&#x6237;&#x9009;&#x62E9;&#x7167;&#x7247;&#x7684;&#x5185;&#x5BB9;&#xFF08;&#x901A;&#x5E38;&#x8FD4;&#x56DE;&#x7684;&#x662F; base64&#xFF09;</li><li>&#x62FF;&#x5230;&#x9760;&#x8C31;&#x7684; visibilityChange &#x4E8B;&#x4EF6;</li><li>&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x63A5;&#x53E3; &#x52A0;&#x5FEB;&#x8BF7;&#x6C42;&#x901F;&#x5EA6;&#xFF0C;&#x6BD4;&#x5982;&#x817E;&#x8BAF;&#x5185;&#x90E8;&#x7684; Webso</li><li>...</li></ul><p>&#x6240;&#x4EE5;&#xFF0C;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x4E0D;&#x4EC5;&#x5FC5;&#x987B;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x91CD;&#x8981;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B; <strong>&#x901A;&#x4FE1;</strong>&#x3002;</p><p>&#x6240;&#x8C13;&#x7684;&#x901A;&#x4FE1;&#xFF0C;&#x5176;&#x5B9E;&#x66F4;&#x786E;&#x5207;&#x7684;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x4F20;&#x9012;&#x6D88;&#x606F;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x8FD9;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x5E76;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5EFA;&#x7ACB;&#x8D77;&#x4E00;&#x4E2A;&#x901A;&#x9053;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x65B9;&#x5411;&#x548C;&#x65B9;&#x5F0F;&#x8FD8;&#x662F;&#x6709;&#x4E9B;&#x533A;&#x522B;&#x7684;&#x3002;</p><ul><li>android =&gt; js: &#x662F;&#x901A;&#x8FC7; <code>javascript:window.jsbridge_visibilityChange(xxx)</code> &#x76F4;&#x63A5;&#x8C03;&#x7528; window &#x91CC;&#x9762;&#x7ED1;&#x5B9A;&#x7684;&#x6267;&#x884C;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x4F20;&#x53C2;&#x7684;&#x8BDD;&#xFF0C;&#x662F;&#x76F4;&#x63A5;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x7B26;&#x4E32; inline &#x5230;&#x51FD;&#x6570;&#x91CC;&#x9762;&#x53BB;&#x3002;</li><li>js =&gt; android: &#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x8BA9; android &#x76D1;&#x542C;&#x76F8;&#x5173;&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x8FD9;&#x4E9B;&#x4E8B;&#x4EF6;&#x5BF9;&#x5E94;&#x7740; JS API &#x91CC;&#x9762;&#x7684;&#x67D0;&#x4E9B;&#x65B9;&#x6CD5;&#xFF0C;&#x6BD4;&#x5982; console&#x3001;alert&#x3001;prompt &#x7B49;&#x3002;</li></ul><h3>android &#x8C03;&#x7528; js</h3><p>&#x6211;&#x4EEC;&#x6DF1;&#x5165;&#x5230; API &#x5C42;&#x9762;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E4B;&#x95F4;&#x662F;&#x5982;&#x4F55;&#x76F8;&#x4E92;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x7684;&#xFF1A;</p><ul><li><p>android =&gt; js: &#x65B9;&#x6CD5;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x975E;&#x5E38;&#x7B80;&#x5355;</p><ul><li>&#x4F7F;&#x7528; loadUrl(&quot;javascript:window.jsbridge_visibilityChange &quot;)</li><li>API &gt; 19&#x3002;</li></ul></li></ul><pre><code>mWebView.evaluateJavascript(&quot;(function() { return &apos;this&apos;; })();&quot;, new ValueCallback&lt;String&gt;() {
    @Override
    public void onReceiveValue(String s) {
        // &#x4E0A;&#x8FF0;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x65F6;&#xFF0C;return &#x7684;&#x5185;&#x5BB9;
        Log.d(&quot;LogName&quot;, s); // Prints: &quot;this&quot;
    }
});</code></pre><ul><li><p>js =&gt; android</p><ul><li>&#x8C03;&#x7528; android &#x8BBE;&#x7F6E;&#x7684; JavascriptInterface (4.2 &#x4EE5;&#x4E0A;&#x624D;&#x80FD;&#x4F7F;&#x7528;)</li><li>&#x901A;&#x8FC7; WebViewClient.shouldOverrideUrlLoading() &#x4E8B;&#x4EF6;&#x62E6;&#x622A;&#x5BF9;&#x5E94;&#x7684;&#x8C03;&#x7528;</li><li>WebChromeClient.onConsoleMessage() &#x76D1;&#x542C; js &#x7684; console &#x89E6;&#x53D1;&#x5185;&#x5BB9;&#x3002;</li><li>WebChromeClient.onJsPrompt &#x76D1;&#x542C; js &#x7684; prompt &#x89E6;&#x53D1;&#x5185;&#x5BB9;&#x3002;</li></ul></li></ul><p>js =&gt; android &#x7684;&#x65B9;&#x6CD5;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5176;&#x4E2D;&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684;&#x6709;&#xFF1A;WebChromeClient.onJsPrompt&#x3001;WebViewClient.shouldOverrideUrlLoading&#x3001;JavascriptInterface&#x3002;</p><p>&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x7740;&#x91CD;&#x6765;&#x8BB2;&#x89E3;&#x4E00;&#x4E0B; js &#x8C03;&#x7528; android &#x7684;&#x7B80;&#x5355;&#x8FC7;&#x7A0B;&#x3002;</p><h3>js &#x76F4;&#x63A5;&#x8C03;&#x7528; android</h3><p>&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x5206;&#x65B9;&#x6CD5;&#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x4E0A;&#x9762;&#x5BF9;&#x5E94;&#x7684;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#x3002;&#x9996;&#x5148;&#x662F; addJavaScriptInterface&#x3002;</p><h4>addJavaScriptInterface</h4><p>&#x901A;&#x8FC7; addJavaScriptInterface &#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; window &#x4E0A;&#x6CE8;&#x5165;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x4E0A;&#x9762;&#x6302;&#x8F7D;&#x8FD9; JavaScriptInterface &#x91CC;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#x548C;&#x5185;&#x5BB9;&#x3002;</p><p>&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x770B;&#x4E00;&#x4E2A; addJavascriptInterface &#x5185;&#x5BB9;&#x3002;</p><pre><code># &#x5B9A;&#x4E49;&#x4E00;&#x4E2A; interface &#x5BF9;&#x8C61;
public class WebAppInterface {
    Context mContext;

    /** Instantiate the interface and set the context */
    WebAppInterface(Context c) {
        mContext = c;
    }

    // &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528; Android &#x4E0A;&#x9762;&#x7684;
    @JavascriptInterface
    public void showToast(String toast) {
        Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();
    }
}

# &#x5728; webview &#x5B9E;&#x4F8B;&#x91CC;&#x9762;&#x6DFB;&#x52A0;&#x8BE5; interface
mWebView.addJavascriptInterface(new JavaScriptInterface(), &quot;jsinterface&quot;);</code></pre><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; js &#x4EE3;&#x7801;&#x91CC;&#x9762;&#x8C03;&#x7528;&#x5BF9;&#x8C61;&#x4E0A;&#x6302;&#x8F7D;&#x7684; API&#x3002;</p><pre><code>var String = window.jsinterface.showToast(&quot;update&quot;);</code></pre><p>&#x4E0D;&#x8FC7;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5728; 4.2 &#x7248;&#x672C;&#x4E4B;&#x524D;&#x5B58;&#x5728;&#x4E25;&#x91CD;&#x7684;&#x5B89;&#x5168;&#x6F0F;&#x6D1E;--&#x5229;&#x7528; Java &#x53CD;&#x5C04;&#x673A;&#x5236;&#xFF0C;&#x76F4;&#x63A5;&#x80FD;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x654F;&#x611F;&#x7684; android &#x6743;&#x9650;&#x3002;&#x8BE6;&#x7EC6;&#x53EF;&#x4EE5;&#x53C2;&#x8003; <a href="https://blog.csdn.net/self_study/article/details/55046348" rel="nofollow noreferrer">addJavascriptInterface &#x8FDC;&#x7A0B;&#x6307;&#x5B9A;&#x4EE3;&#x7801;&#x6F0F;&#x6D1E;</a>&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x4E0A;&#x9762;&#x52A0;&#x4E0A; <code>@JavascriptInterface</code> &#x88C5;&#x9970;&#x7B26;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x5B66;&#x662F;&#x975E;&#x5E38;&#x8BA4;&#x53EF;&#x800C;&#x4E14;&#x63A8;&#x5D07;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#x4E0D;&#x9700;&#x8981;&#x548C;&#x5176;&#x5B83;&#x590D;&#x6742;&#x7684;&#x65B9;&#x6CD5;&#x8026;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x5E72;&#x51C0;&#x6574;&#x6D01;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x6709;&#x4E2A;&#x95EE;&#x9898;&#x662F;&#xFF0C;4.2 &#x4E00;&#x4E0B;&#x7684;&#x7248;&#x672C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x6BD4;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x901A;&#x8FC7; <code>shouldOverrideUrlLoading</code> &#x6765;&#x5904;&#x7406;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x6548;&#x7387;&#x66F4;&#x9AD8;&#xFF0C;&#x66F4;&#x6709;&#x6548;&#x7387;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x4E00;&#x65E6;&#x8003;&#x8651;&#x7684;&#x4F4E;&#x7248;&#x672C;&#xFF0C;&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x5BF9;&#x4E8E;&#x540C;&#x4E00;&#x4EFD; jsbridge &#x5B9E;&#x73B0;&#x4E24;&#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x5BF9;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x50CF;&#x662F; Achilles&apos; Heel&#x3002;</p><h4>onJsPrompt</h4><p>&#x4F7F;&#x7528; onJsprompt &#x7684;&#x903B;&#x8F91;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x76D1;&#x542C; WebChromeClient.onJsPrompt &#x4E8B;&#x4EF6;&#xFF0C;&#x8BBE;&#x7F6E;&#x597D;&#x5BF9;&#x5E94;&#x534F;&#x8BAE;&#x7684;&#x5185;&#x5BB9;&#x5373;&#x53EF;&#x3002;jsPrompt &#x5728; Web &#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x884C;&#x4E3A;&#x662F;&#x5F39;&#x51FA;&#x4E00;&#x4E2A;&#x6846;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x7528;&#x6237;&#x7684;&#x8F93;&#x5165;&#x6846;&#x548C;&#x786E;&#x5B9A;&#x3001;&#x53D6;&#x6D88;&#x6309;&#x94AE;&#x3002;</p><p><span class="img-wrap"><img data-src="/img/remote/1460000016087109?w=888&amp;h=260" src="https://static.alili.tech/img/remote/1460000016087109?w=888&amp;h=260" alt="image.png-17.1kB" title="image.png-17.1kB"></span></p><p>&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><pre><code> mWebView.setWebChromeClient(new WebChromeClient() {
    /**
     * msg: &#x662F;&#x901A;&#x8FC7; prompt(msg) &#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;
     * 
     */
    @Override
    public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result) {
  
        Uri uri = Uri.parse(message);
        
        boolean handle = message.startsWith(&quot;jsbridge:&quot;);

        if(handle){
            result.confirm(&quot;trigger&quot;); // &#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x4E0D;&#x4F1A;&#x540A;&#x8D77; input 
            return true;
        }

        return super.onJsPrompt(view, url, message, defaultValue, result);
    }
});</code></pre><p>&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x5728; webview &#x91CC;&#x9762;&#x76F4;&#x63A5;&#x4F7F;&#x7528; prompt &#x8C03;&#x7528;&#x5373;&#x53EF;&#x3002;</p><pre><code>function jsbridgePrompt(url){
    if(url) {
        nativeReady = false;
        var jsoncommand = JSON.stringify(url);
        var _temp = prompt(jsoncommand,&apos;&apos;);
        return true;
    } else {
        // there is invalid jsbridge url
        return false;
    }
}</code></pre><h4>&#x6548;&#x7387;&#x4F4E;&#x4E0B;&#x7684; shouldOverrideUrlLoading</h4><p>&#x4E0A;&#x9762;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x5BF9;&#x5E94;&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x989D;&#x5916;&#x8026;&#x5408;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x5904;&#x7406;&#x903B;&#x8F91;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x76F4;&#x63A5;&#x7528;&#x6765;&#x76D1;&#x542C;&#x9875;&#x9762;&#x7684;&#x8BF7;&#x6C42;&#x6765;&#x505A;&#x76F8;&#x5E94;&#x5904;&#x7406;&#x7684; -- WebViewClient.shouldOverrideUrlLoading&#x3002;</p><p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5728; Android &#x91CC;&#x9762;&#x7528;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x4E0D;&#x4EC5;&#x9700;&#x8981;&#x5904;&#x7406;&#x5BF9;&#x5E94;&#x7684; 302/301 &#x8DF3;&#x8F6C;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x505A;&#x76F8;&#x5173; webview &#x7684;&#x6743;&#x9650;&#x5904;&#x7406;&#x3002;&#x867D;&#x7136;&#xFF0C;&#x8C03;&#x7528;&#x5904;&#x7406;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x91CC;&#x9762;&#x4EE3;&#x7801;&#x590D;&#x6742;&#x5EA6;&#x548C;&#x5B9E;&#x73B0;&#x6548;&#x7387;&#x6BD4;&#x8D77;&#x6765;&#x662F;&#x65E0;&#x6CD5;&#x548C;&#x4E0A;&#x9762;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x76F8;&#x6BD4;&#x7684;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x5BF9; shouldOverrideUrlLoading &#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x3002;shouldOverrideUrlLoading &#x4E00;&#x822C;&#x53EA;&#x5BF9;&#x4E8E; a &#x6807;&#x7B7E;&#x7684;&#x8DF3;&#x8F6C;&#x548C; HTML &#x7684;&#x8BF7;&#x6C42;&#x6709;&#x76F8;&#x5173;&#x7684;&#x54CD;&#x5E94;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6709;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x600E;&#x6837;&#x53BB;&#x6784;&#x9020;&#x8FD9;&#x6837;&#x7684;&#x8BF7;&#x6C42;&#xFF1F;</p><p>&#x5BF9;&#x4E8E; a &#x6807;&#x7B7E;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7528;&#x6237;&#x7684;&#x624B;&#x52A8;&#x884C;&#x4E3A;&#xFF0C;&#x4F60;&#x662F;&#x65E0;&#x6CD5;&#x89E6;&#x53D1; onclick &#x4E8B;&#x4EF6;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x6784;&#x9020; iframe &#x8BF7;&#x6C42;&#x6765;&#x5B9E;&#x73B0;&#x7C7B; shouldOverrideUrlLoading &#x7684;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x7248;&#x672C;&#xFF1A;</p><pre><code>const fakeInvokeSchema = (url, errHandler) =&gt; {
  let iframe = document.createElement(&apos;iframe&apos;);

  let onload = function () {
    // &#x5982;&#x679C; shouldOverrideUrlLoading &#x6CA1;&#x6709;&#x5F88;&#x597D;&#x7684;&#x6355;&#x83B7;&#x5E76;&#x4E14;&#x53D6;&#x6D88; iframe &#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x4F1A;&#x76F4;&#x63A5;&#x6267;&#x884C; iframe &#x7684; onload &#x4E8B;&#x4EF6;
    if (typeof errHandler === &apos;function&apos;) {
      errHandler(&quot;trigger faile&quot;, url);
    }


  };
  iframe.src = url;
  iframe.onload = onload;
  (document.body || document.documentElement).appendChild(iframe);

  // &#x89E6;&#x53D1;&#x5B8C;&#x6210;&#x540E;&#x79FB;&#x9664;&#xFF0C;&#x51CF;&#x5C11;&#x9875;&#x9762;&#x7684;&#x6E32;&#x67D3;&#x3002;
  setTimeout(function () {
    iframe &amp;&amp; iframe.parentNode &amp;&amp; iframe.parentNode.removeChild(iframe);
  }, 0);
}</code></pre><p>&#x6B63;&#x5E38;&#x601D;&#x7EF4;&#x903B;&#x8F91;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x8FD9;&#x6837;&#x5904;&#x7406;&#x5C31;&#x6CA1;&#x5565;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x5F80;&#x5F80;&#x4F1A;&#x7ED9;&#x4F60;&#x4E00;&#x5DF4;&#x638C;&#x3002;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5982;&#x4E0B;&#xFF1A;</p><ul><li><p>&#x5982;&#x679C;&#x662F; IOS &#x5E73;&#x53F0;:</p><ul><li>&#x9700;&#x8981;&#x5148;&#x8FDB;&#x884C; onload &#x548C; src &#x7684;&#x7ED1;&#x5B9A;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06; iframe append &#x5230; body &#x91CC;&#x9762;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x9020;&#x6210;&#x8FDE;&#x7EED; api &#x7684;&#x8C03;&#x7528;&#xFF0C;&#x4F1A;&#x95F4;&#x9694;&#x6267;&#x884C;&#x6210;&#x529F;&#x3002;</li></ul></li><li><p>&#x5982;&#x679C;&#x662F; Android:</p><ul><li>&#x5219;&#x9700;&#x8981;&#x5148; append &#x5230;&#x9875;&#x9762;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7ED1;&#x5B9A; onload &#x548C; src&#x3002;&#x5426;&#x5219;&#x4F1A;&#x9020;&#x6210; onload &#x5931;&#x8D25; &#x548C;&#x989D;&#x5916;&#x89E6;&#x53D1;&#x4E00;&#x6B21; about:blank &#x7684; onload &#x4E8B;&#x4EF6;&#x3002;about:black &#x7684;&#x73B0;&#x8C61;&#x53EF;&#x4EE5;&#x53C2;&#x8003; juejin.com &#x6253;&#x5F00; github &#x767B;&#x5F55;&#x3002;</li></ul></li></ul><h2>listener &#x76D1;&#x542C;&#x56DE;&#x8C03;&#x4E4B;&#x8C1C;</h2><p>&#x901A;&#x8FC7;&#x524D;&#x6587;&#x7684; <a href="#android-%E5%A6%82%E4%BD%95%E5%92%8C-js-%E7%9B%B8%E4%BA%92%E9%80%9A%E4%BF%A1">android js &#x7684;&#x76F8;&#x4E92;&#x8C03;&#x7528;</a>&#xFF0C;&#x6211;&#x4EEC;&#x5927;&#x81F4;&#x80FD;&#x4E86;&#x89E3;&#x4E24;&#x8005;&#x4E4B;&#x524D;&#x4E92;&#x76F8;&#x8C03;&#x7528;&#x7684;&#x57FA;&#x7840;&#x3002;&#x4F46;&#x5728;&#x771F;&#x6B63;&#x5B9E;&#x8DF5;&#x5F53;&#x4E2D;&#xFF0C;jsbridge &#x7684;&#x76F8;&#x4E92;&#x8C03;&#x7528;&#x5176;&#x5B9E;&#x53EF;&#x4EE5;&#x5F52;&#x7EB3;&#x4E3A;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF1A;</p><li><ul><li><p>java call js:</p><ul><li><p>with callback</p><ul><li>once</li><li>permanent: &#x6BD4;&#x5982;&#xFF0C;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x72B6;&#x6001;&#x7684;&#x53D8;&#x6362;&#x4FE1;&#x606F;&#x3002;&#x76F8;&#x5F53;&#x4E8E;&#x5C31;&#x662F; listener&#x3002;</li></ul></li><li>without callback</li></ul></li></ul></li><ul><li><p>js call java:</p><ul><li><p>with callback</p><pre><code>* once
* permanent: &#x6BD4;&#x5982;&#xFF0C;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x9875;&#x9762; visibility &#x7684;&#x53D8;&#x66F4;&#x72B6;&#x6001;&#x3002;</code></pre></li><li>without callback</li></ul></li></ul><p>&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x7684;&#x6765;&#x89E3;&#x51B3;&#xFF08;&#x6211;&#x4EEC;&#x53EA;&#x4E86;&#x89E3; H5 &#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#xFF09;&#xFF0C;&#x9996;&#x5148;&#x7B80;&#x5355;&#x4E86;&#x89E3;&#x4E00;&#x4E0B; once callback &#x5982;&#x4F55;&#x89E3;&#x51B3;&#x3002;</p><p><strong>once callback:</strong> &#x8BE5;&#x7C7B;&#x7684; callback &#x975E;&#x5E38;&#x597D;&#x89E3;&#x51B3;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7684; jsbridge &#x6587;&#x4EF6;&#x91CC;&#x9762;&#x901A;&#x8FC7; <em>_CLIENT_CALLBACK</em> + globalId++ &#x7684;&#x65B9;&#x5F0F;&#x751F;&#x6210;&#x552F;&#x4E00;&#x7684; callback &#x65B9;&#x6CD5;&#x3002;&#x5BF9;&#x4E8E;&#x6B64;&#x7C7B; callback &#x6709;&#x65F6;&#x5019;&#x4E3A;&#x4E86;&#x8282;&#x7701;&#x5185;&#x5B58;&#x5728;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5220;&#x9664;&#x8BE5; callback</p><pre><code>// jsCode call jsbridge
jsbridge.getDeviceId(callback)

// jsbridge.js register once callback
let onceCallback = &quot;__ONCE_CALLBACK__&quot; + globalId++;
window[onceCallback] = function(data){
    callback(data);
    delete(window[onceCallback]);
}</code></pre><p><strong>with callback:</strong> &#x8FD9;&#x7C7B;&#x5E26; callback &#x6216;&#x8005;&#x8BF4;&#x662F;&#x5E26; listener &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x6BD4;&#x8F83;&#x96BE;&#x5904;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x4E00;&#x76F4;&#x4FDD;&#x7559;&#x5F53;&#x524D;&#x7684; Listener &#xFF0C;&#x5982;&#x679C; webview &#x901A;&#x8FC7; removeListener &#x79FB;&#x9664;&#x8FD8;&#x9700;&#x8981;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8FD8;&#x9700;&#x8981;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7684; listener &#x662F;&#x5426;&#x548C;&#x5BF9;&#x5E94; register &#x7684; webview &#x4E00;&#x81F4;&#xFF0C;&#x4E0D;&#x4E00;&#x81F4;&#x8FD8;&#x9700;&#x8981;&#x9500;&#x6BC1;&#x5F53;&#x524D;&#x6CE8;&#x518C;&#x7684; listener. &#x4E0D;&#x8FC7;&#xFF0C;&#x5177;&#x4F53;&#x601D;&#x8DEF;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x901A;&#x8FC7; jsbridge &#x5C06;&#x5728; window &#x91CC;&#x9762;&#x6CE8;&#x518C;&#x7684;&#x51FD;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p><pre><code>// jsCode call jsbridge
jsbridge.qbVisibilityChange((vis)=&gt;{
    // xxx
})


# &#x5E95;&#x5C42;&#x7684;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x4E3A;:
const jsbridge.qbVisibilityChange = function(callback){

        let CALLBACK_Listner = function(param){
            callback(param);
        }
        window[&quot;CALLBACK_Listner&quot;] = CALLBACK_Listner;
        prompt(`jsbridge://qq.com/visibility#__callback__=CALLBACK_Listner`);
}</code></pre><h3>jsbridge.js &#x6587;&#x4EF6;&#x7684;&#x8D77;&#x6E90;</h3><p>&#x4E0A;&#x9762;&#x8FD9;&#x4E9B;&#x8C03;&#x7528;&#x4EE3;&#x7801;&#xFF0C;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x548C;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x65E0;&#x5173;&#x7684;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x4ED4;&#x7EC6;&#x9884;&#x60F3;&#x4E00;&#x4E0B;&#xFF0C;&#x5982;&#x679C; H5 &#x9700;&#x8981;&#x9002;&#x914D;&#x591A;&#x4E2A; app &#x7684; jsbridge&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x9700;&#x8981;&#x5199;&#x4E00;&#x4E2A; switch/case &#x7684;&#x8BED;&#x53E5;&#x3002;</p><pre><code>switch(){
    case xx:
        load(&apos;bridgeA.js&apos;)
    case xx:
        load(&apos;bridgeB.js&apos;);
    case xx:
        load(&apos;bridgeC.js&apos;);
    break;
}</code></pre><p>&#x800C;&#x4E14;&#x5982;&#x679C;&#x4ED6;&#x4EEC;&#x5BF9;&#x5E94;&#x7684; API &#x63A5;&#x53E3;&#x540D;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x8FD8;&#x9700;&#x8981;&#x518D;&#x5305;&#x4E00;&#x5C42;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x3002;&#x8FD9;&#x4E5F;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x60F3;&#x81EA;&#x5DF1;&#x5199;&#x4E00;&#x4E2A; jsbridge&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x4E0D;&#x4E00;&#x81F4;&#x7684; API &#x63A5;&#x53E3;&#x540D;&#xFF0C;&#x653E;&#x5230;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x91CC;&#x9762;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p><pre><code>// WrapBridge.js
jsbridge.visibilityChange = function(cb){
    if(UA.isQQ){
        jsbridge.qqVisibilityChange(cb)
    }else if(UA.isWeChat){
        jsbridge.wxVisibilityChange(cb)
    }
    ...
}</code></pre><p>&#x6240;&#x4EE5;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x4F60;&#x8C03;&#x7528;&#x4E00;&#x4E2A; jsbridge &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#x8BE5;&#x65B9;&#x6CD5;&#x4E0B;&#x9762;&#x5305;&#x4E86;&#x591A;&#x5C11;&#x5C42;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x6709;&#x4E9B; app &#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8BE5; jsbridge.js &#x4FB5;&#x5165;&#x4E1A;&#x52A1;&#x5C42;&#x4E1A;&#x52A1;&#x5F15;&#x5165;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x9009;&#x62E9;&#x4F7F;&#x7528;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#x76F4;&#x63A5;&#x4FB5;&#x5165;&#x52A0;&#x8F7D;&#x3002;</p><p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5982;&#x4F55;&#x505A;&#x5230;&#x76F4;&#x63A5;&#x4FB5;&#x5165; webview &#x52A0;&#x8F7D; jsbridge.js &#x6587;&#x4EF6;&#x7684;&#x3002;</p><h2>android &#x4FB5;&#x5165; webview &#x52A0;&#x8F7D; bridge.js</h2><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x5230;&#x5982;&#x679C; java &#x8C03;&#x7528; js &#x662F;&#x9700;&#x8981;&#x989D;&#x5916;&#x5F15;&#x5165;&#x5B9A;&#x5236;&#x5316;&#x7684; invokeSchame://xxx &#xFF0C;&#x65B9;&#x4FBF;&#x63D0;&#x4F9B;&#x7ED9; web &#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x7C7B;&#x5B9A;&#x5236;&#x5316;&#x9700;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x989D;&#x5916;&#x5F15;&#x5165; jsbridge.js&#x3002;&#x8FD9;&#x91CC;&#x4E00;&#x822C;&#x63D0;&#x4F9B;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x5F15;&#x5165; jsbridge.js&#x3002;&#x4E00;&#x662F;&#x901A;&#x8FC7;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x544A;&#x8BC9; H5 &#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x5728;&#x5F00;&#x53D1;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x989D;&#x5916;&#x5F15;&#x5165;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x3002;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x5229;&#x7528; webview &#x6CE8;&#x5165;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5C06;&#x6307;&#x5B9A;&#x7684; js &#x6587;&#x4EF6;&#x6253;&#x8FDB;&#x53BB;&#x3002;</p><ul><li>&#x77E5;&#x4F1A; H5 &#x5F00;&#x53D1;&#x989D;&#x5916;&#x5F15;&#x5165;&#x6587;&#x4EF6;&#xFF1A;&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x642D;&#x914D; hybird &#x5F00;&#x53D1;&#x4F7F;&#x7528;&#xFF0C;&#x4E00;&#x6765;&#x5171;&#x540C;&#x65B9;&#x4FBF;&#xFF0C;&#x4E8C;&#x6765;&#x4E5F;&#x65B9;&#x4FBF; debugger</li><li>&#x76F4;&#x63A5;&#x5BA2;&#x6237;&#x7AEF;&#x5F15;&#x5165;&#xFF1A;&#x5BF9;&#x4E8E;&#x5E73;&#x53F0;&#x7EA7;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x5E38;&#x5E38;&#x4F1A;&#x7528;&#x5230;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#xFF0C;&#x51CF;&#x5C11; H5 &#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6C9F;&#x901A;&#x548C;&#x590D;&#x6742;&#x5EA6;&#x3002;</li></ul><p>&#x8FD9;&#x91CC;&#xFF0C;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5982;&#x4F55;&#x5F15;&#x5165; JS &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4FDD;&#x8BC1;&#x5176;&#x80FD;&#x591F;&#x751F;&#x6548;&#x3002;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6CE8;&#x5165;&#x7684;&#x65F6;&#x673A;&#x5E94;&#x8BE5;&#x662F;&#x5728; DomContentLoaded &#x4E8B;&#x4EF6;&#x4E4B;&#x540E;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x548C;&#x4E8B;&#x4EF6;&#x3002;&#x53CD;&#x6620;&#x5230; webviewClient &#x91CC;&#x9762;&#x7684;&#x4E8B;&#x4EF6;&#x4E5F;&#x5C31;&#x662F;&#xFF1A;</p><ul><li>onPageStarted</li><li>onPageFinished</li></ul><p>&#x6700;&#x4FDD;&#x9669;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x76F4;&#x63A5;&#x5728; onPageFinished &#x4E8B;&#x4EF6;&#x91CC;&#x9762;&#x6CE8;&#x5165; JS &#x6587;&#x4EF6;. &#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x4F2A;&#x4EE3;&#x7801;&#xFF0C;&#x76F4;&#x63A5;&#x5728;&#x5168;&#x5C40;&#x91CC;&#x9762;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x3002;</p><pre><code>webView.setWebViewClient(new WebViewClient(){
    @Override
    public void onPageFinished(WebView view, String url) {
        super.onPageFinished(view, url);
        webView.loadUrl(
            &quot;javascript:(function() { &quot; +
                &quot;var element = document.getElementById(&apos;hplogo&apos;);&quot;
                + &quot;element.parentNode.removeChild(element);&quot; +
            &quot;})()&quot;);
    }
});
</code></pre><p>&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x601D;&#x8003;&#x4E00;&#x4E0B;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x5F53;&#x524D;&#x7684; webview &#x662F;&#x5426;&#x503C;&#x5F97;&#x6CE8;&#x5165;&#xFF0C;&#x5373;&#xFF0C;&#x5224;&#x65AD; webview &#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x8BA4;&#x4E3A;&#x5982;&#x4E0B; webview &#x662F;&#x6709;&#x6548;&#x7684;&#xFF1A;</p><ul><li>&#x91CD;&#x5B9A;&#x5411;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x6700;&#x65B0;&#x6253;&#x5F00;&#x7A33;&#x5B9A;&#x7684; webview</li><li>&#x5DF2;&#x7ECF;&#x6253;&#x5F00;&#x7684; webview &#xFF0C;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x88AB;&#x6CE8;&#x5165;&#x8FC7;</li></ul><p>&#x4E00;&#x822C;&#x5904;&#x7406;&#x505A;&#x6CD5;&#x662F;&#x76F4;&#x63A5;&#x5728; webview &#x7684; onPageFinished &#x4E8B;&#x4EF6;&#x91CC;&#x9762;&#x76F4;&#x63A5;&#x6CE8;&#x5165; jsbridge &#x6587;&#x4EF6;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x6587;&#x4EF6;&#x7B80;&#x5355;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6839;&#x636E;&#x4E0A;&#x9762;&#xFF0C;&#x5199;&#x5728; inline &#x91CC;&#x9762;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x62BD;&#x79BB;&#x6210;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684; js &#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x91CC;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5C06; jsbridge &#x6587;&#x4EF6;&#x8F6C;&#x6362;&#x6210; base64 &#x7F16;&#x7801;&#xFF0C;&#x7136;&#x540E;&#x5229;&#x7528; window.atob &#x76F4;&#x63A5;&#x89E3;&#x6790;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x5176;&#x5B9E;&#x548C;&#x89E3;&#x6790;&#x56FE;&#x7247;&#x6709;&#x4E9B;&#x7C7B;&#x4F3C;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5916;&#x5E26;&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x574F;&#x5904;&#x662F;&#x589E;&#x52A0; js &#x7684;&#x89E3;&#x6790;&#x65F6;&#x95F4;&#x3002;&#x5177;&#x4F53;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p><pre><code>        @Override
       public void onPageFinished(WebView view, String url) {
          super.onPageFinished(view, url);

          injectScriptFile(view, &quot;js/script.js&quot;); // &#x6CE8;&#x5165;&#x5916;&#x94FE;&#x4EE3;&#x7801;

          // test if the script was loaded
          view.loadUrl(&quot;javascript:setTimeout(test(), 500)&quot;);
       }

       private void injectScriptFile(WebView view, String scriptFile) {
          InputStream input;
          try {
            // &#x4E00;&#x822C;&#x4F1A;&#x76F4;&#x63A5;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x5C06;&#x8BE5; js &#x6587;&#x4EF6;&#x9884;&#x8BFB;&#x4E3A; base64
             input = getAssets().open(scriptFile);
             byte[] buffer = new byte[input.available()];
             input.read(buffer);
             input.close();
             String encoded = Base64.encodeToString(buffer, Base64.NO_WRAP);

             view.loadUrl(&quot;javascript:(function() {&quot; +
                          &quot;var parent = document.getElementsByTagName(&apos;head&apos;).item(0);&quot; +
                          &quot;var script = document.createElement(&apos;script&apos;);&quot; +
                          &quot;script.type = &apos;text/javascript&apos;;&quot; +
             // &#x5C06; base64 &#x8F6C;&#x6210; string &#x4EE3;&#x7801;
                          &quot;script.innerHTML = window.atob(&apos;&quot; + encoded + &quot;&apos;);&quot; +
                          &quot;parent.appendChild(script)&quot; +
                          &quot;})()&quot;);
          } catch (IOException e) {
             // TODO Auto-generated catch block
             e.printStackTrace();
          }
       }</code></pre><p>&#x5177;&#x4F53;&#x53C2;&#x8003;&#xFF1A;<a href="https://stackoverflow.com/questions/21552912/android-web-view-inject-local-javascript-file-to-remote-webpage" rel="nofollow noreferrer">standalone js</a>&#x3002;</p><p>&#x524D;&#x9762;&#x6211;&#x4E5F;&#x544A;&#x8BEB;&#x8FC7;&#x5927;&#x5BB6;&#xFF1A;</p><blockquote>&#x6559;&#x79D1;&#x4E66;&#x5F0F;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x5565;&#x4E5F;&#x89E3;&#x51B3;&#x4E0D;&#x4E86;</blockquote><p>&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x822C;&#x9009;&#x62E9;&#x4FB5;&#x5165;&#x7684;&#x65F6;&#x673A;&#x901A;&#x5E38;&#x4F1A;&#x9009;&#x5728; onPageFinished &#x4E2D;&#xFF0C;&#x8FD9;&#x5DF2;&#x7ECF;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4E86;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53C8;&#x8BA9;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x53D8;&#x5F97;&#x4E0D;&#x90A3;&#x4E48;&#x4F18;&#x96C5;&#x3002;</p><h3>webview &#x91CD;&#x5B9A;&#x5411;&#x89E3;&#x51B3;&#x529E;&#x6CD5;</h3><p>&#x73B0;&#x5728;&#x6700;&#x5173;&#x952E;&#x7684;&#x662F;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x6253;&#x5F00;&#x7684; webview &#x662F;&#x6709;&#x6548;&#x679C;&#x7684;&#xFF1F;</p><p>&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x7F51;&#x9875;&#x6709;&#x4E24;&#x4E2A;&#x529E;&#x6CD5;&#xFF1A;</p><ul><li>webivew &#x81EA;&#x8EAB;&#x63A7;&#x5236;&#xFF1A;&#x70B9;&#x51FB; a &#x6807;&#x7B7E;&#x76F4;&#x63A5;&#x8DF3;&#x8F6C;&#x3001;&#x901A;&#x8FC7; window.location &#x76F4;&#x63A5;&#x4FEE;&#x6539;</li><li>&#x8C03;&#x7528;WebView&#x7684;loadUrl()&#x65B9;&#x6CD5;</li></ul><p>&#x548C; URL &#x6253;&#x5F00;&#x76F8;&#x5173;&#x7684;&#x4E09;&#x4E2A;&#x4E8B;&#x4EF6;&#x6709;&#xFF1A;</p><ul><li>shouldOverrideUrlLoading(): &#x62E6;&#x622A;&#x9875;&#x9762;&#x7684; GET/POST &#x8BF7;&#x6C42;&#xFF0C;&#x6CE8;&#x610F; HTML &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x6613; GET &#x8BF7;&#x6C42; &#x540C;&#x6837;&#x4E5F;&#x4F1A;&#x62E6;&#x622A;&#x3002;</li><li>onPageStarted()&#xFF1A;&#x9875;&#x9762;&#x5F00;&#x59CB;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x89E6;&#x53D1;</li><li>onPageFinished(): &#x9875;&#x9762;&#x52A0;&#x8F7D;&#x5B8C;&#x6210;&#x65F6;&#x4F1A;&#x89E6;&#x53D1;&#x3002;&#x5F53;&#x8BF7;&#x6C42;&#x91CD;&#x5B9A;&#x5411;&#x5730;&#x5740;&#xFF0C;&#x5E76;&#x4E14;&#x6210;&#x529F;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x4E5F;&#x4F1A;&#x89E6;&#x53D1;&#x8BE5;&#x4E8B;&#x4EF6;</li><li>onProgressChanged: &#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x7684;&#x8FDB;&#x5EA6;&#xFF0C;&#x4F1A;&#x5728; onPageStarted &#x548C; onPageFinished &#x4E4B;&#x95F4;&#x89E6;&#x53D1;&#x591A;&#x6B21;&#xFF0C;&#x901A;&#x5E38;&#x662F; 20-50-80-100 &#x8FD9;&#x6837;&#x7684;&#x6B21;&#x6570;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5728;&#x91CD;&#x5B9A;&#x5411;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x4E5F;&#x4F1A;&#x591A;&#x6B21;&#x89E6;&#x53D1;&#x8BE5;&#x51FD;&#x6570;&#x3002;</li></ul><p>&#x6240;&#x4EE5;&#xFF0C;&#x4E3A;&#x4E86;&#x5F97;&#x5230;&#x9875;&#x9762;&#x771F;&#x6B63;&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x7684; flag&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4ED4;&#x7EC6;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5728; 301/302 &#x65F6;&#xFF0C;&#x4E0A;&#x8FF0;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x7684;&#x6D41;&#x7A0B;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x5BF9;&#x5E94;&#x4E86;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x6253;&#x5F00;&#x65B9;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA;&#x662F;&#x5426;&#x5B58;&#x5728;&#x91CD;&#x5B9A;&#x5411;&#x7684; 2x2 &#x7684;&#x9009;&#x62E9;&#x3002;</p><ul><li><p>200 &#x6B63;&#x5E38;&#x4E00;&#x6B21;&#x6027;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</p><ul><li><p>loadUrl &#x6253;&#x5F00;</p><ul><li><p>onPageStarted()-&gt; onPageFinished()</p><ul><li>&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1; shouldOverrideUrlLoading &#x4E8B;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E2A;&#x5F88;&#x91CD;&#x8981;</li></ul></li></ul></li><li><p>a &#x6807;&#x7B7E;&#xFF0C;window.location &#x6253;&#x5F00;</p><ul><li>shouldOverrideUrlLoading() =&gt; onPageStarted() =&gt; onPageFinished()</li></ul></li></ul></li><li><p>301/302 &#x91CD;&#x5B9A;&#x5411;&#x8FD4;&#x56DE;</p><ul><li><p>loadUrl &#x6253;&#x5F00;</p><ul><li>repeat( onPageStarted()-&gt;shouldOverrideUrlLoading()-&gt;onPageFinished() ) * &#x91CD;&#x5B9A;&#x5411;&#x6B21;&#x6570;N =&gt; onPageStarted()-&gt;onPageFinished()</li></ul></li><li><p>a &#x6807;&#x7B7E;&#xFF0C;window.location &#x6253;&#x5F00;</p><ul><li>shouldOverrideUrlLoading =&gt; repeat( onPageStarted()-&gt;shouldOverrideUrlLoading()-&gt;onPageFinished() ) * &#x91CD;&#x5B9A;&#x5411;&#x6B21;&#x6570;N =&gt; onPageStarted()-&gt;onPageFinished()</li></ul></li></ul></li></ul><p>&#x7B80;&#x5355;&#x5F52;&#x7EB3;&#x4E00;&#x4E0B;&#xFF0C;&#x5728; webview &#x4E2D;&#x65B0;&#x6253;&#x5F00;&#x9875;&#x9762;&#xFF0C;&#x4E00;&#x5B9A;&#x4F1A;&#x89E6;&#x53D1; shouldOverrideUrlLoading&#x3002;&#x5728; native &#x91CC;&#x9762;&#x6253;&#x5F00; url&#xFF0C;&#x5219;&#x53EA;&#x4F1A;&#x8D70;&#x6B63;&#x5E38;&#x903B;&#x8F91; (pageStart =&gt; onPageFinished )&#xFF0C;&#x9664;&#x975E;&#x91CD;&#x5B9A;&#x5411;&#x3002;</p><p>&#x4E5F;&#x5C31;&#x662F;&#x51E1;&#x662F;&#x5728; onPageStarted &#x548C; onPageFinished &#x4E4B;&#x95F4;&#xFF0C;&#x89E6;&#x53D1;&#x4E86; shouldOverrideUrlLoading &#x90FD;&#x662F;&#x91CD;&#x5B9A;&#x5411;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x5173;&#x952E;&#x70B9;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A; flag &#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x8BB0;&#x5F55;&#x6B64;&#x65F6;&#x6587;&#x6863;&#x662F;&#x5426;&#x771F;&#x6B63;&#x7684;&#x52A0;&#x8F7D;&#x5B8C;&#x6210;&#x3002;&#x57FA;&#x672C;&#x6B65;&#x9AA4;&#x4E3A;&#xFF1A;</p><ul><li>onPageStarted &#x91CC;&#x9762;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF; this.loaded = true</li><li>&#x5728; shouldOverrideUrlLoading&#xFF0C;&#x5C06; this.loaded = false</li><li>&#x5728; onPageFinished &#x5224;&#x65AD; this.loaded === true, &#x662F;&#x4EE3;&#x8868;&#x5F53;&#x524D; webview &#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x3002;&#x4E0D;&#x662F;&#xFF0C;&#x5219;&#x4EE3;&#x8868;&#x91CD;&#x5B9A;&#x5411;</li></ul><h2>webview &#x7684;&#x6027;&#x80FD;&#x4F18;&#x5316;</h2><p>&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;webview &#x7684;&#x6E32;&#x67D3;&#x6027;&#x80FD;&#x5728; Android &#x673A;&#x4E0A;&#x7B97;&#x662F;&#x5DEE;&#x5F3A;&#x4EBA;&#x610F;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5176;&#x672C;&#x8EAB;&#x7684;&#x6027;&#x80FD;&#x6C38;&#x8FDC;&#x662F;&#x65E0;&#x6CD5;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x76F8;&#x63D0;&#x5E76;&#x8BBA;&#x7684;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9; webview &#x4F18;&#x5316;&#x6027;&#x80FD;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x63D0;&#x5347;&#xFF0C;&#x5E73;&#x5E38;&#x505A;&#x7684;&#x65B9;&#x6848;&#x6709;&#xFF1A;</p><ul><li>&#x79BB;&#x7EBF;&#x5305;&#xFF1A;&#x901A;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x9884;&#x5148;&#x4E0B;&#x8F7D; web &#x7684;&#x79BB;&#x7EBF;&#x5305;&#x8D44;&#x6E90;&#xFF0C;&#x6781;&#x5927;&#x7684;&#x51CF;&#x5C11; webview &#x7684;&#x52A0;&#x8F7D;&#x65F6;&#x5EF6;&#x3002;</li><li><p>RN/Flutter: &#x901A;&#x8FC7; JsBundle &#x7684;&#x5F62;&#x5F0F;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x7EC4;&#x4EF6;&#x7684; API &#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x5C06;&#x4F7F;&#x7528;&#x4EE3;&#x7801;&#x89E3;&#x6790;&#x4E3A; DSL &#x6811;&#xFF0C;&#x7531; JsBundle &#x89E3;&#x6790;&#x6E32;&#x67D3;&#x3002;&#x7531;&#x4E8E;&#x53C2;&#x7167;&#x5BF9;&#x8C61;&#x5B8C;&#x5168;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5C06;&#x4EE3;&#x7801;&#x5B8C;&#x5168;&#x8BBE;&#x8BA1;&#x4E3A; H5 &#x4EE3;&#x7801;&#x6765;&#x8BF4;&#x662F;&#x975E;&#x5E38;&#x56F0;&#x96BE;&#x7684;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5B9E;&#x73B0;&#x50CF; CSS &#x4E00;&#x6837;&#x7684;&#x5E03;&#x5C40;&#x8BED;&#x6CD5;&#x3002;</p><ul><li>&#x4ED6;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x81F4;&#x547D;&#x7684;&#x52A3;&#x52BF;&#xFF0C;&#x5373;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x7EC4;&#x4EF6;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x5FC5;&#x987B;&#x6BCF;&#x6B21;&#x66F4;&#x65B0;&#x5E95;&#x5C42;&#x7684;&#x89E3;&#x6790;&#x7248;&#x672C;&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x5E03;&#x5230; Store &#x91CC;&#x9762;&#x5E76;&#x66F4;&#x65B0;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x7D27;&#x6025; Bug &#x548C;&#x65B0;&#x529F;&#x80FD;&#x7684;&#x63D0;&#x5BA1;&#x6765;&#x8BF4;&#x5F71;&#x54CD;&#x975E;&#x5E38;&#x5927;&#x3002;</li></ul></li></ul><p>&#x672C;&#x6587;&#x540E;&#x7EED;&#x6D89;&#x53CA;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x53EA;&#x9488;&#x5BF9;&#x4E8E;&#x504F;&#x5411;&#x524D;&#x7AEF;&#x7684; H5 &#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x4F18;&#x5316;&#x548C;&#x6E32;&#x67D3;&#x4F18;&#x5316;&#x3002;</p><h3>&#x79BB;&#x7EBF;&#x5305;&#x4F18;&#x5316;</h3><p>&#x5BF9;&#x4E8E; H5 &#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x4F18;&#x5316;&#xFF0C;&#x79BB;&#x7EBF;&#x5305;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;&#x78BE;&#x538B;&#x4E00;&#x5207;&#xFF0C;&#x4E0D;&#x8FC7;&#x5F0A;&#x7AEF;&#x548C; RN &#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x540C;&#x6837;&#x4E5F;&#x9700;&#x8981;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8054;&#x52A8;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x751F; bug &#x53EA;&#x80FD;&#x6309;&#x7167;&#x7248;&#x672C;&#x7684;&#x66F4;&#x66FF;&#x8FDB;&#x884C;&#x53D1;&#x5E03;&#x3002;&#x4EC5;&#x4EC5;&#x8003;&#x8651;&#x5230;&#x66F4;&#x65B0;&#x548C;&#x7248;&#x672C;&#x95EE;&#x9898;&#x6765;&#x8BF4;&#xFF0C;&#x79BB;&#x7EBF;&#x5305;&#x786E;&#x5B9E;&#x5F88;&#x6E23;&#x3002;However&#xFF0C;&#x4F60;&#x4ED4;&#x7EC6;&#x60F3;&#x4E00;&#x60F3;&#xFF0C;&#x79BB;&#x7EBF;&#x5305;&#x673A;&#x5236;&#x6709; RN &#x590D;&#x6742;&#xFF1F;&#x5B83;&#x4F1A;&#x6D89;&#x53CA; UI &#x4E48;&#xFF1F;&#x5B9E;&#x73B0;&#x96BE;&#x5EA6;&#x5927;&#x4E48;&#xFF1F;</p><p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x60F3;&#x5E94;&#x8BE5;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x592A;&#x591A;&#x89E3;&#x91CA;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x79BB;&#x7EBF;&#x5305;&#x4EC5;&#x4EC5;&#x662F;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7684;&#x903B;&#x8F91; package&#xFF0C;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#x9876;&#x591A;&#x5C31;&#x662F;&#x8D70;&#x7EBF;&#x4E0A;&#x7684;&#x8D44;&#x6E90;&#x800C;&#x5DF2;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E00;&#x70B9;&#x6765;&#x8BF4;&#xFF0C;&#x79BB;&#x7EBF;&#x5305;&#x673A;&#x5236;&#x66F4;&#x80DC;&#x4E8E; RN&#x3001;&#x6027;&#x80FD;&#x66F4;&#x4F18;&#x4E8E; H5&#x3002;</p><h3>ServiceWorker webview &#x5185;&#x4F18;&#x5316;</h3><p>ServiceWorker &#x5176;&#x5B9E;&#x4E0D;&#x4EC5;&#x4EC5;&#x53EA;&#x5C40;&#x9650;&#x4E8E; H5&#xFF0C;&#x5BF9;&#x6240;&#x6709;&#x7528;&#x5230; &#x7F51;&#x9875;&#x5F00;&#x53D1; &#x6765;&#x8BF4;&#x90FD;&#x610F;&#x4E49;&#x91CD;&#x5927;&#x3002;&#x7A76;&#x5176;&#x7F18;&#x7531;&#x4E3B;&#x8981;&#x662F;&#x4ED6;&#x7684;&#x6027;&#x80FD;&#x4F18;&#x52BF;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x7F16;&#x7A0B;&#x6027;&#x5F00;&#x53D1;&#x3002;&#x5BF9;&#x6807;&#x4E8E; Android &#x7684;&#x56DB;&#x5927;&#x7EC4;&#x4EF6;&#x7684; Service &#x6765;&#x8BF4;&#xFF0C;ServiceWorker &#x672C;&#x8EAB;&#x7684;&#x60F3;&#x8C61;&#x529B;&#x5C31;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x9A7B;&#x7559; Web &#x7A0B;&#x5E8F;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x4E2D;&#x95F4;&#x5C42;&#x7684;&#x4EE3;&#x7406;&#x63A7;&#x5236;&#x3002;</p><p>&#x4F46;&#xFF0C;&#x5F0A;&#x7AEF;&#x4E5F;&#x4E0D;&#x662F;&#x6CA1;&#x6709;&#xFF0C;&#x4E3B;&#x8981;&#x5728;&#x4E8E;&#x5B83;&#x81EA;&#x8EAB;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x662F;&#x72EC;&#x7ACB;&#x4E8E;&#x5F53;&#x524D;&#x5BF9;&#x5E94;&#x7684; Web &#x9879;&#x76EE;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x9879;&#x76EE;&#x91CC;&#x9762;&#x989D;&#x5916;&#x5F15;&#x5165;&#x4E00;&#x4E2A; sw.js&#x3002;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x65B0;&#x624B;&#x540C;&#x5B66;&#x6765;&#x8BF4;&#xFF0C;&#x4E0A;&#x624B;&#x96BE;&#x5EA6;&#x8FD8;&#x662F;&#x6709;&#x4E00;&#x70B9;&#xFF0C;&#x4E0D;&#x8FC7;&#x5F71;&#x54CD;&#x4E0D;&#x5927;&#x3002;&#x4F46;&#x5BF9;&#x6BD4;&#x4E8E;&#x79BB;&#x7EBF;&#x5305;&#x673A;&#x5236;&#x6765;&#x8BF4;&#xFF0C;&#x5904;&#x7406;&#x7F13;&#x5B58;&#x5DEE;&#x4E00;&#x70B9;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x5E94;&#x8BE5;&#x7B97;&#x662F;&#x78BE;&#x538B;&#x3002;</p><ul><li>&#x5176;&#x4ED6;&#x5BA2;&#x6237;&#x7AEF;&#x4F18;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;</li></ul><p><a href="https://segmentfault.com/a/1190000010711024">&#x817E;&#x8BAF;&#x796D;&#x51FA;&#x5927;&#x62DB;VasSonic&#xFF0C;&#x8BA9;&#x4F60;&#x7684;H5&#x9875;&#x9762;&#x9996;&#x5C4F;&#x79D2;&#x5F00;</a></p><ul><li>&#x5173;&#x4E8E; ServiceWorker &#x5185;&#x5BB9;&#x53EF;&#x4EE5;&#x53C2;&#x8003; <a href="https://www.villainhr.com/page/2017/01/08/Service%20Worker%20%E5%85%A8%E9%9D%A2%E8%BF%9B%E9%98%B6" rel="nofollow noreferrer">villainhr &#x7B80;&#x8FF0; ServiceWorker</a></li></ul><blockquote>&#x6B22;&#x8FCE;&#x5173;&#x6CE8; <strong>&#x524D;&#x7AEF;&#x5C0F;&#x5409;&#x7C73;</strong></blockquote>
{{< /raw >}}

# 版权声明
本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，
本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。
原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！

## 原文标题
Android 和 Webview 如何相互 sayHello(一)

## 原文链接
[https://segmentfault.com/a/1190000016087103](https://segmentfault.com/a/1190000016087103)

