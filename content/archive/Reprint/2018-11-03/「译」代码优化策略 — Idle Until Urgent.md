---
title: 「译」代码优化策略 — Idle Until Urgent
reprint: true
categories: reprint
abbrlink: 6ce8297d
date: 2018-11-03 02:30:13
---

{{% raw %}}
<p><span class="img-wrap"><img data-src="https://img.alicdn.com/tfs/TB1u.rsepzqK1RjSZFzXXXjrpXa-1919-913.png" src="https://static.alili.techhttps://img.alicdn.com/tfs/TB1u.rsepzqK1RjSZFzXXXjrpXa-1919-913.png" alt="" title="" style="cursor:pointer;display:inline"></span></p><h1 id="articleHeader0">Idle Until Urgent&#xFF08;&#x95F2;&#x7F6E;&#x76F4;&#x5230;&#x7D27;&#x6025;&#xFF09;</h1><blockquote>&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x5927;&#x5BB6;&#x8033;&#x719F;&#x80FD;&#x8BE6;&#x7684;&#x4F18;&#x5316;&#x7B56;&#x7565;&#x5DF2;&#x7ECF;&#x8C08;&#x8BBA;&#x4E86;&#x597D;&#x591A;&#x5E74;&#x4E86;&#xFF0C;&#x7528; Chrome &#x6027;&#x80FD;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x53D1;&#x73B0;&#x74F6;&#x9888;&#x5E76;&#x9488;&#x5BF9;&#x6027;&#x4F18;&#x5316;&#x7684;&#x6587;&#x7AE0;&#x7F51;&#x7EDC;&#x4E0A;&#x4E5F;&#x6709;&#x4E0D;&#x5C11;&#xFF0C;&#x4F46;&#x662F;&#x4ECE;&#x8FD0;&#x884C;&#x65F6;&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x6765;&#x601D;&#x8003;&#x4F18;&#x5316;&#x65B9;&#x5F0F;&#x7684;&#x5374;&#x51E4;&#x6BDB;&#x9E9F;&#x89D2;&#xFF0C;&#x6B63;&#x5982;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x53EA;&#x77E5;&#x9053;&#x4F7F;&#x7528; setTimeout &#x6765;&#x8FDB;&#x884C; throttling &#x548C; debounce&#x3002;&#x56E0;&#x6B64;&#x5728;&#x5076;&#x7136;&#x770B;&#x5230;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x65F6;&#xFF0C;&#x6211;&#x6709;&#x4E00;&#x79CD;__&#x8C41;&#x7136;&#x5F00;&#x6717;__&#x7684;&#x611F;&#x89C9;&#xFF1A;&#x539F;&#x6765;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x4E48;&#x7EC6;&#x81F4;&#x7684;&#x7C92;&#x5EA6;&#x4E0A;&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#x3002;</blockquote><p>&#x539F;&#x6587;&#xFF1A;<a href="https://philipwalton.com/articles/idle-until-urgent/" rel="nofollow noreferrer" target="_blank">https://philipwalton.com/articles/idle-until-urgent/</a></p><p>&#x51E0;&#x5468;&#x524D;&#xFF0C;&#x6211;&#x6B63;&#x7740;&#x624B;&#x67E5;&#x770B;&#x6211;&#x7F51;&#x7AD9;&#x7684;&#x4E00;&#x4E9B;&#x6027;&#x80FD;&#x6307;&#x6807;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x60F3;&#x770B;&#x770B;&#x6211;&#x5728;&#x6211;&#x4EEC;&#x6700;&#x65B0;&#x7684;&#x6027;&#x80FD;&#x6807;&#x51C6;&#xFF0C;&#x5373;<a href="https://developers.google.com/web/updates/2018/05/first-input-delay" rel="nofollow noreferrer" target="_blank">&#x9996;&#x6B21;&#x8F93;&#x5165;&#x5EF6;&#x8FDF;&#xA0;&#xFF08;FID&#xFF09;</a>&#x4E0A;&#x7684;&#x8868;&#x73B0;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x7684;&#x7F51;&#x7AD9;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x535A;&#x5BA2;&#xFF08;&#x5E76;&#x6CA1;&#x6709;&#x8FD0;&#x884C;&#x5F88;&#x591A; JavaScript &#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x5E0C;&#x671B;&#x6211;&#x80FD;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x76F8;&#x5F53;&#x4E0D;&#x9519;&#x7684;&#x7ED3;&#x679C;&#x3002;</p><p>&#x5C0F;&#x4E8E; 100 &#x6BEB;&#x79D2;&#x7684;&#x8F93;&#x5165;&#x5EF6;&#x8FDF;&#x901A;&#x5E38;&#x88AB;&#x7528;&#x6237;&#x89C6;&#x4E3A;<a href="https://developers.google.com/web/fundamentals/performance/rail#ux" rel="nofollow noreferrer" target="_blank">&#x5373;&#x65F6;&#x54CD;&#x5E94;</a>&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x7684;&#x6027;&#x80FD;&#x76EE;&#x6807;&#xFF08;&#x4EE5;&#x53CA;&#x6211;&#x5E0C;&#x671B;&#x5728;&#x6211;&#x7684;&#x5206;&#x6790;&#x4E2D;&#x770B;&#x5230;&#x7684;&#x6570;&#x5B57;&#xFF09;&#x662F;&#xFF1A;&#x5BF9;&#x4E8E; 99&#xFF05; &#x7684;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x6765;&#x8BF4;&#xFF0C;FID &lt;100ms&#x3002;</p><p>&#x4EE4;&#x6211;&#x60CA;&#x8BB6;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x7684;&#x7F51;&#x7AD9;&#x5728;&#x7B2C; 99 &#x767E;&#x5206;&#x4F4D;&#x6570;&#x4E0B;&#x7684; FID &#x4E3A; 254 &#x6BEB;&#x79D2;&#x3002;&#x867D;&#x7136;&#x90A3;&#x5E76;&#x4E0D;&#x53EF;&#x6015;&#xFF0C;&#x4F46;&#x6211;&#x7684;&#x5B8C;&#x7F8E;&#x4E3B;&#x4E49;&#x6027;&#x683C;&#x5374;&#x4EE4;&#x6211;&#x65E0;&#x6CD5;&#x677E;&#x61C8;&#x3002;&#x55EF;&#xFF0C;&#x6211;&#x5FC5;&#x987B;&#x89E3;&#x51B3;&#x5B83;&#xFF01;</p><p>&#x603B;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5728;&#x4E0D;&#x5220;&#x9664;&#x6211;&#x7F51;&#x7AD9;&#x7684;&#x4EFB;&#x4F55;&#x529F;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x9700;&#x8981;&#x80FD;&#x591F;&#x5728;&#x7B2C; 99 &#x767E;&#x5206;&#x4F4D;&#x6570;&#x4E0B;&#x5C06;&#x6211;&#x7684;FID&#x63A7;&#x5236;&#x5728; 100 &#x6BEB;&#x79D2;&#x4EE5;&#x4E0B;&#x3002;&#x4F46;&#x6211;&#x786E;&#x4FE1;&#xFF0C;&#x4F60;&#x4EEC;&#x8FD9;&#x4E9B;&#x8BFB;&#x8005;&#x66F4;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x662F;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p><ul><li>&#x6211;&#x662F;_&#x5982;&#x4F55;_&#x8BCA;&#x65AD;&#x95EE;&#x9898;&#x7684;&#x3002;</li><li>&#x6211;&#x7528;&#x4E86;_&#x4EC0;&#x4E48;_&#x5177;&#x4F53;&#x7684;&#x7B56;&#x7565;&#x548C;&#x6280;&#x672F;&#x6765;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</li></ul><p>&#x5BF9;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x7B2C;&#x4E8C;&#x70B9;&#xFF0C;&#x5F53;&#x6211;&#x8BD5;&#x56FE;&#x89E3;&#x51B3;&#x6211;&#x7684;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x6211;&#x5076;&#x7136;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x8BA9;&#x6211;&#x60F3;&#x5206;&#x4EAB;&#x7684;&#xFF0C;&#x975E;&#x5E38;&#x6709;&#x8DA3;&#x7684;&#x6027;&#x80FD;&#x7B56;&#x7565;&#xFF08;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x5199;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#xFF09;&#x3002;</p><p>&#x6211;&#x5C06;&#x8FD9;&#x4E2A;&#x7B56;&#x7565;&#x79F0;&#x4E4B;&#x4E3A;&#xFF1A;_idle-until-urgent&#xFF08;&#x95F2;&#x7F6E;&#x76F4;&#x5230;&#x7D27;&#x6025;&#xFF09;_&#xA0;&#x3002;</p><h2 id="articleHeader1">&#x6211;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;</h2><p><a href="https://developers.google.com/web/updates/2018/05/first-input-delay" rel="nofollow noreferrer" target="_blank">&#x9996;&#x6B21;&#x8F93;&#x5165;&#x5EF6;&#x8FDF;&#xFF08;FID&#xFF09;</a>&#x662F;&#x4E00;&#x4E2A;&#x5EA6;&#x91CF;&#x6807;&#x51C6;&#xFF0C;&#x7528;&#x4E8E;&#x8861;&#x91CF;&#x7528;&#x6237;&#x9996;&#x6B21;&#x4E0E;&#x60A8;&#x7684;&#x7F51;&#x7AD9;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x5BF9;&#x4E8E;&#x50CF;&#x6211;&#x8FD9;&#x6837;&#x7684;&#x535A;&#x5BA2;&#x6765;&#x8BF4;&#xFF0C;&#x6700;&#x6709;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x70B9;&#x51FB;&#x94FE;&#x63A5;&#xFF09;&#x4EE5;&#x53CA;&#x6D4F;&#x89C8;&#x5668;&#x80FD;&#x591F;&#x54CD;&#x5E94;&#x8BE5;&#x4E92;&#x52A8;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x5BF9;&#x4E8E;&#x6211;&#x535A;&#x5BA2;&#x7684;&#x70B9;&#x51FB;&#x4EA4;&#x4E92;&#x6765;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x8BF7;&#x6C42;&#x52A0;&#x8F7D;&#x4E0B;&#x4E00;&#x9875;&#xFF09;&#x3002;</p><p>&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x5EF6;&#x8FDF;&#x7684;&#x539F;&#x56E0;&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x6B63;&#x5728;&#x5FD9;&#x4E8E;&#x505A;&#x5176;&#x4ED6;&#x4E8B;&#x60C5;&#xFF08;&#x901A;&#x5E38;&#x662F;&#x6267;&#x884C; JavaScript &#x4EE3;&#x7801;&#xFF09;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8981;&#x8BCA;&#x65AD;&#x51FA;&#x9AD8;&#x4E8E;&#x9884;&#x671F;&#x7684; FID&#xFF0C;&#x60A8;&#x9996;&#x5148;&#x5E94;&#x5F53;&#x505A;&#x7684;&#x662F;&#x5728;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x65F6;&#x542F;&#x7528;&#x7AD9;&#x70B9;&#x7684;&#x6027;&#x80FD;&#x8DDF;&#x8E2A;&#xFF08;&#x540C;&#x65F6;&#x542F;&#x7528; CPU &#x548C;&#x7F51;&#x7EDC;&#x9650;&#x5236;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0A;&#x67E5;&#x627E;&#x9700;&#x8981;&#x6267;&#x884C;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#x7684;&#x5404;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;&#x4E00;&#x65E6;&#x786E;&#x5B9A;&#x4E86;&#x8FD9;&#x4E9B;&#x957F;&#x4EFB;&#x52A1;&#xFF0C;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x5C06;&#x5B83;&#x4EEC;&#x5206;&#x89E3;&#x4E3A;&#x66F4;&#x5C0F;&#x7684;&#x4EFB;&#x52A1;&#x3002;</p><p>&#x4EE5;&#x4E0B;&#x662F;&#x6211;&#x5728;&#x5BF9;&#x7F51;&#x7AD9;&#x8FDB;&#x884C;&#x6027;&#x80FD;&#x8DDF;&#x8E2A;&#x65F6;&#x7684;&#x53D1;&#x73B0;&#xFF1A;<br><span class="img-wrap"><img data-src="https://img.alicdn.com/tfs/TB1ttUwdYvpK1RjSZPiXXbmwXXa-1400-739.png" src="https://static.alili.techhttps://img.alicdn.com/tfs/TB1ttUwdYvpK1RjSZPiXXbmwXXa-1400-739.png" alt="idle-until-urget-before-1400w-efc9f3a53c.png" title="idle-until-urget-before-1400w-efc9f3a53c.png" style="cursor:pointer;display:inline"></span><br><em>&#x4E00;&#x4EFD;&#x52A0;&#x8F7D;&#x6211;&#x7F51;&#x7AD9;&#x65F6;&#x7684; JavaScript &#x6027;&#x80FD;&#x8DDF;&#x8E2A;&#xFF08;&#x542F;&#x7528;&#x7F51;&#x7EDC;/ CPU&#x9650;&#x5236;&#xFF09;&#x3002;</em></p><p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5728; main &#x811A;&#x672C; bundle &#x6267;&#x884C;&#x65F6;&#xFF0C;&#x5B83;&#x4F5C;&#x4E3A;&#x5355;&#x4E2A;&#x4EFB;&#x52A1;&#x9700;&#x8981; 233 &#x6BEB;&#x79D2;&#x624D;&#x80FD;&#x8FD0;&#x884C;&#x5B8C;&#x6210;&#x3002;</p><p><span class="img-wrap"><img data-src="https://img.alicdn.com/tfs/TB1rjqFelLoK1RjSZFuXXXn0XXa-1400-600.png" src="https://static.alili.techhttps://img.alicdn.com/tfs/TB1rjqFelLoK1RjSZFuXXXn0XXa-1400-600.png" alt="idle-until-urget-before-eval-1400w-7a455de908.png" title="idle-until-urget-before-eval-1400w-7a455de908.png" style="cursor:pointer;display:inline"></span><br><em>&#x6267;&#x884C;&#x6211;&#x7F51;&#x7AD9;&#x7684; main bundle &#x9700;&#x8981; 233 &#x6BEB;&#x79D2;&#x3002;</em></p><p>&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x662F; webpack boilerplate &#x548C; babel polyfill&#xFF0C;&#x4F46;&#x5927;&#x591A;&#x6570;&#x4EE3;&#x7801;&#x6765;&#x81EA;&#x6211;&#x811A;&#x672C;&#x4E2D;&#x7684;&#xA0;main()&#xA0;&#x5165;&#x53E3;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x672C;&#x8EAB;&#x9700;&#x8981; 183 &#x6BEB;&#x79D2;&#x624D;&#x80FD;&#x5B8C;&#x6210;&#xFF1A;<br><span class="img-wrap"><img data-src="https://img.alicdn.com/tfs/TB1SZmCegHqK1RjSZJnXXbNLpXa-1400-450.png" src="https://static.alili.techhttps://img.alicdn.com/tfs/TB1SZmCegHqK1RjSZJnXXbNLpXa-1400-450.png" alt="idle-until-urget-before-main-1400w-08fe4dd1c5.png" title="idle-until-urget-before-main-1400w-08fe4dd1c5.png" style="cursor:pointer;display:inline"></span><br><em>&#x6267;&#x884C;&#x6211;&#x7684;&#x7AD9;&#x70B9;&#x7684;main()&#x5165;&#x53E3;&#x51FD;&#x6570;&#x9700;&#x8981; 183 &#x6BEB;&#x79D2;&#x3002;</em></p><p>&#x7136;&#x800C;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x5728;&#x6211;&#x7684;&#xA0;main()&#xA0;&#x51FD;&#x6570;&#x4E2D;&#x505A;&#x4EC0;&#x4E48;&#x5947;&#x602A;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x6211;&#x5728;&#x51FD;&#x6570;&#x4E2D;&#x53EA;&#x662F;&#x521D;&#x59CB;&#x5316;&#x6211;&#x7684; UI &#x7EC4;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x5206;&#x6790;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const main = () =&gt; {
  drawer.init();
  contentLoader.init();
  breakpoints.init();
  alerts.init();

  analytics.init();
};" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> main = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  drawer.init();
  contentLoader.init();
  breakpoints.init();
  alerts.init();

  analytics.init();
};</code></pre><p>&#x90A3;&#x4E48;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x82B1;&#x4E86;&#x8FD9;&#x4E48;&#x957F;&#x65F6;&#x95F4;&#x5728;&#x8FD0;&#x884C;&#xFF1F;</p><p>&#x597D;&#x5427;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x706B;&#x7130;&#x56FE;&#x7684;&#x5C3E;&#x90E8;&#xFF0C;&#x4F60;&#x4E0D;&#x4F1A;&#x770B;&#x5230;&#x6709;&#x4EFB;&#x4F55;&#x51FD;&#x6570;&#x5728;&#x6267;&#x884C;&#x65F6;&#x660E;&#x663E;&#x5730;&#x5360;&#x636E;&#x4E86;&#x5927;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#x3002;&#x5927;&#x591A;&#x6570;&#x5355;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x5728;&#x4E0D;&#x5230; 1 &#x6BEB;&#x79D2;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x8FD0;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x4F60;&#x5C06;&#x5B83;&#x4EEC;&#x5168;&#x90E8;&#x6DFB;&#x52A0;&#x8D77;&#x6765;&#x4E4B;&#x540E;&#xFF0C;&#x5728;&#x5355;&#x4E2A;&#x540C;&#x6B65;&#x8C03;&#x7528;&#x5806;&#x6808;&#x4E2D;&#x8FD0;&#x884C;&#x5B83;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x82B1;&#x8D39;&#x8D85;&#x8FC7; 100 &#x6BEB;&#x79D2;&#x3002;</p><p>&#x8FD9;&#x5C31;&#x662F;&#x6740;&#x5343;&#x5200;&#x7684; JavaScript&#x3002;</p><p>&#x7531;&#x4E8E;&#x95EE;&#x9898;&#x662F;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x90FD;&#x4F5C;&#x4E3A;&#x5355;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x6D4F;&#x89C8;&#x5668;&#x5FC5;&#x987B;&#x7B49;&#x5230;&#x6B64;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x624D;&#x80FD;&#x591F;&#x54CD;&#x5E94;&#x7528;&#x6237;&#x7684;&#x4EA4;&#x4E92;&#x3002;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x5C06;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x5206;&#x89E3;&#x4E3A;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;&#x4F46;&#x8FD9;&#x8BF4;&#x8D77;&#x6765;&#x5BB9;&#x6613;&#xFF0C;&#x505A;&#x8D77;&#x6765;&#x96BE;&#x3002;</p><p>&#x4E4D;&#x4E00;&#x770B;&#xFF0C;&#x4F3C;&#x4E4E;&#x663E;&#x800C;&#x6613;&#x89C1;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x7ED9; <code>main()</code>&#xA0;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#x6392;&#x4E2A;&#x4F18;&#x5148;&#x7EA7;&#xFF08;&#x5B83;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x5DF2;&#x7ECF;&#x6309;&#x4F18;&#x5148;&#x7EA7;&#x987A;&#x5E8F;&#x6392;&#x5217;&#xFF09;&#xFF0C;&#x6700;&#x5FEB;&#x521D;&#x59CB;&#x5316;&#x6700;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x63A8;&#x8FDF;&#x5230;&#x540E;&#x7EED;&#x7684;&#x4EFB;&#x52A1;&#x53BB;&#x505A;&#x3002;</p><p>&#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x53EF;&#x80FD;&#x5BF9;&#x67D0;&#x4E9B;&#x4EBA;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x4F46;&#x5B83;&#x5E76;&#x4E0D;&#x662F;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x53EF;&#x4EE5;&#x5B9E;&#x65BD;&#x7684;&#x901A;&#x7528;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x5F88;&#x597D;&#x5730;&#x6269;&#x5C55;&#x5230;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5927;&#x7684;&#x7F51;&#x7AD9;&#x4E2D;&#x3002;&#x539F;&#x56E0;&#x5982;&#x4E0B;&#xFF1A;</p><ul><li>&#x63A8;&#x8FDF; UI &#x7EC4;&#x4EF6;&#x521D;&#x59CB;&#x5316;&#x4EC5;&#x5728;&#x7EC4;&#x4EF6;&#x5C1A;&#x672A;&#x6E32;&#x67D3;&#x65F6;&#x624D;&#x6709;&#x7528;&#x3002;&#x5982;&#x679C;&#x5B83;&#x5DF2;&#x7ECF;&#x88AB;&#x6E32;&#x67D3;&#x8FC7;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5EF6;&#x8FDF;&#x8FD9;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FD0;&#x884C;&#xFF0C;&#x5219;&#x4F1A;&#x5E26;&#x6765;&#x5728;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x65F6;&#x7EC4;&#x4EF6;&#x5E76;&#x672A;&#x51C6;&#x5907;&#x597D;&#x7684;&#x98CE;&#x9669;&#x3002;</li><li>&#x5728;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6240;&#x6709; UI &#x7EC4;&#x4EF6;&#x8981;&#x4E48;&#x540C;&#x7B49;&#x91CD;&#x8981;&#xFF0C;&#x8981;&#x4E48;&#x5F7C;&#x6B64;&#x4F9D;&#x8D56;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x4EEC;&#x90FD;&#x9700;&#x8981;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;</li><li>&#x6709;&#x65F6;&#x5355;&#x4E2A;&#x7EC4;&#x4EF6;&#x9700;&#x8981;&#x8DB3;&#x591F;&#x957F;&#x7684;&#x65F6;&#x95F4;&#x6765;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6B64;&#x65F6;&#x5373;&#x4F7F;&#x5B83;&#x4EEC;&#x53EA;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x4EFB;&#x52A1;&#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x4F1A;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;</li></ul><p>&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x662F;&#xFF0C;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x4EFB;&#x52A1;&#x4E2D;&#x521D;&#x59CB;&#x5316;&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#x901A;&#x5E38;&#x662F;&#x4E0D;&#x591F;&#x9AD8;&#x6548;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x5F80;&#x5F80;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x9700;&#x8981;&#x628A;&#x4EFB;&#x52A1;&#x5206;&#x89E3;&#x5230;&#x6BCF;&#x4E2A;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x7684;&#x7EC4;&#x4EF6;&#x4E2D;&#x3002;</p><h2 id="articleHeader2">&#x8D2A;&#x5A6A;&#x7684;&#x7EC4;&#x4EF6;</h2><p>&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x9700;&#x8981;&#x5C06;&#x5176;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;&#x5206;&#x89E3;&#x7684;&#x7EC4;&#x4EF6;&#x7684;&#x5B8C;&#x7F8E;&#x793A;&#x4F8B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x6B64;&#x6027;&#x80FD;&#x8DDF;&#x8E2A;&#x7ED3;&#x679C;&#x8FDB;&#x4E00;&#x6B65;&#x7F29;&#x653E;&#x89C2;&#x5BDF;&#x770B;&#x5230;&#x3002;&#x5728;&#xA0;<code>main()</code>&#xA0;&#x51FD;&#x6570;&#x7684;&#x4E2D;&#x95F4;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x6211;&#x7684;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x4F7F;&#x7528;&#xA0;<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DateTimeFormat" rel="nofollow noreferrer" target="_blank">Intl.DateTimeFormat</a> API&#xFF1A;<br><span class="img-wrap"><img data-src="https://img.alicdn.com/tfs/TB1dviDegTqK1RjSZPhXXXfOFXa-1400-460.png" src="https://static.alili.techhttps://img.alicdn.com/tfs/TB1dviDegTqK1RjSZPhXXXfOFXa-1400-460.png" alt="idle-until-urget-before-date-time-format-1400w-c67615763f.png" title="idle-until-urget-before-date-time-format-1400w-c67615763f.png" style="cursor:pointer"></span><br><em>&#x521B;&#x5EFA;&#xA0;<code>Intl.DateTimeFormat</code> &#x5B9E;&#x4F8B;&#x82B1;&#x4E86; 13.47ms&#xFF01;</em></p><p>&#x521B;&#x5EFA;&#x6B64;&#x5BF9;&#x8C61;&#x9700;&#x8981; 13.47 &#x6BEB;&#x79D2;&#xFF01;</p><p>&#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;&#xA0;<code>Intl.DateTimeFormat</code>&#xA0;&#x5B9E;&#x4F8B;&#x867D;&#x7136;&#x5728;&#x7EC4;&#x4EF6;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x88AB;&#x521B;&#x5EFA;&#x4E86;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x6CA1;&#x6709;&#x88AB;&#x5F15;&#x7528;&#xFF0C;&#x76F4;&#x5230;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x5C06;&#x5176;&#x7528;&#x4E8E;&#x683C;&#x5F0F;&#x5316;&#x65E5;&#x671F;&#x4E3A;&#x6B62;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6B64;&#x7EC4;&#x4EF6;&#x4E0D;&#x77E5;&#x9053;&#x5B83;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F1A;&#x88AB;&#x5F15;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x53EA;&#x80FD;&#x8C28;&#x614E;&#x884C;&#x4E8B;&#xFF0C;&#x7ACB;&#x5373;&#x5B9E;&#x4F8B;&#x5316;&#xA0;<code>Int.DateTimeFormat</code>&#xA0;&#x5BF9;&#x8C61;&#x3002;</p><p>&#x4F46;&#x8FD9;&#x771F;&#x7684;&#x662F;&#x6B63;&#x786E;&#x7684;&#x4EE3;&#x7801;&#x6C42;&#x503C;&#x7B56;&#x7565;&#x5417;&#xFF1F;&#x5982;&#x679C;&#x4E0D;&#x662F;&#xFF0C;&#x90A3;&#x6B63;&#x786E;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</p><h2 id="articleHeader3">&#x4EE3;&#x7801;&#x6C42;&#x503C;&#x7B56;&#x7565;</h2><p>&#x5728;&#x4E3A;&#x53EF;&#x80FD;&#x6267;&#x884C;&#x4EE3;&#x4EF7;&#x9AD8;&#x6602;&#x7684;&#x4EE3;&#x7801;&#x9009;&#x62E9;<a href="https://en.wikibooks.org/wiki/Introduction_to_Programming_Languages/Evaluation_Strategies" rel="nofollow noreferrer" target="_blank">&#x6C42;&#x503C;&#x7B56;&#x7565;</a>&#x65F6;&#xA0;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x4F1A;&#x9009;&#x62E9;&#x4EE5;&#x4E0B;&#x5176;&#x4E2D;&#x4E00;&#x9879;&#xFF1A;</p><ul><li><a href="https://en.wikipedia.org/wiki/Eager_evaluation" rel="nofollow noreferrer" target="_blank">&#x53CA;&#x65E9;&#x6C42;&#x503C;</a>&#xFF08;Eager evaluation&#xFF09;&#xFF1A;&#x60A8;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x4EE3;&#x4EF7;&#x9AD8;&#x6602;&#x7684;&#x4EE3;&#x7801;&#x3002;</li><li><a href="https://en.wikipedia.org/wiki/Lazy_evaluation" rel="nofollow noreferrer" target="_blank">&#x60F0;&#x6027;&#x6C42;&#x503C;</a>&#xFF08;Lazy evaluation&#xFF09;&#xFF1A;&#x4F60;&#x7B49;&#x5230;&#x7A0B;&#x5E8F;&#x7684;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x9700;&#x8981;&#x8FD9;&#x6BB5;&#x4EE3;&#x4EF7;&#x9AD8;&#x6602;&#x4EE3;&#x7801;&#x7684;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x4F60;&#x624D;&#x8FD0;&#x884C;&#x5B83;&#x3002;</li></ul><p>&#x8FD9;&#x4E5F;&#x8BB8;&#x662F;&#x4E24;&#x79CD;&#x6700;&#x53D7;&#x6B22;&#x8FCE;&#x200B;&#x200B;&#x7684;&#x6C42;&#x503C;&#x7B56;&#x7565;&#xFF0C;&#x4F46;&#x5728;&#x91CD;&#x6784;&#x5B8C;&#x6211;&#x7684;&#x7F51;&#x7AD9;&#x540E;&#xFF0C;&#x6211;&#x73B0;&#x5728;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E9B;&#x53EF;&#x80FD;&#x662F;&#x4F60;&#x6700;&#x7CDF;&#x7CD5;&#x7684;&#x9009;&#x62E9;&#x3002;</p><h3 id="articleHeader4">&#x53CA;&#x65E9;&#x6C42;&#x503C;&#x7684;&#x7F3A;&#x70B9;</h3><p>&#x6211;&#x7F51;&#x7AD9;&#x4E0A;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x5F88;&#x597D;&#x5730;&#x8BF4;&#x660E;&#x4E86;&#x53CA;&#x65E9;&#x6C42;&#x503C;&#x7684;&#x4E00;&#x4E2A;&#x7F3A;&#x70B9;&#xFF0C;&#x5373;&#x5982;&#x679C;&#x7528;&#x6237;&#x5728;&#x4EE3;&#x7801;&#x6C42;&#x503C;&#x65F6;&#x5C1D;&#x8BD5;&#x4E0E;&#x60A8;&#x7684;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5FC5;&#x987B;&#x7B49;&#x5230;&#x4EE3;&#x7801;&#x5B8C;&#x6210;&#x6C42;&#x503C;&#x624D;&#x80FD;&#x505A;&#x51FA;&#x54CD;&#x5E94;&#x3002;</p><p>&#x5982;&#x679C;&#x60A8;&#x7684;&#x9875;&#x9762;&#x770B;&#x8D77;&#x6765;&#x5DF2;&#x51C6;&#x5907;&#x597D;&#x54CD;&#x5E94;&#x7528;&#x6237;&#x8F93;&#x5165;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5374;&#x65E0;&#x6CD5;&#x54CD;&#x5E94;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x5C24;&#x5176;&#x6210;&#x95EE;&#x9898;&#x3002;&#x7528;&#x6237;&#x4F1A;&#x8BA4;&#x4E3A;&#x60A8;&#x7684;&#x9875;&#x9762;&#x7F13;&#x6162;&#x751A;&#x81F3;&#x5B8C;&#x5168;&#x662F;&#x574F;&#x7684;&#x3002;</p><p>&#x4F60;&#x9884;&#x5148;&#x6C42;&#x503C;&#x7684;&#x4EE3;&#x7801;&#x8D8A;&#x591A;&#xFF0C;&#x60A8;&#x7684;&#x9875;&#x9762;&#x8FBE;&#x5230;&#x53EF;&#x4EE5;&#x4EA4;&#x4E92;&#x6240;&#x9700;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x8D8A;&#x957F;&#x3002;</p><h3 id="articleHeader5">&#x60F0;&#x6027;&#x6C42;&#x503C;&#x7684;&#x7F3A;&#x70B9;</h3><p>&#x5982;&#x679C;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x662F;&#x4E0D;&#x597D;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6700;&#x660E;&#x663E;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5C31;&#x662F;&#x7B49;&#x5230;&#x5B9E;&#x9645;&#x9700;&#x8981;&#x5B83;&#x7684;&#x65F6;&#x5019;&#x518D;&#x8FD0;&#x884C;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x4F1A;&#x4E0D;&#x5FC5;&#x8981;&#x5730;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x7528;&#x6237;&#x5B9E;&#x9645;&#x4E0A;&#x4ECE;&#x672A;&#x9700;&#x8981;&#x5B83;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x7B49;&#x5230;&#x7528;&#x6237;&#x9700;&#x8981;&#x8BE5;&#x4EE3;&#x7801;&#x7684;&#x7ED3;&#x679C;&#x65F6;&#x518D;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;&#x7528;&#x6237;&#x8F93;&#x5165;&#x80AF;&#x5B9A;&#x4F1A;&#x88AB;&#x4F60;&#x90A3;&#x4E9B;&#x4EE3;&#x4EF7;&#x9AD8;&#x6602;&#x7684;&#x4EE3;&#x7801;&#x7ED9;&#x5835;&#x585E;&#x4F4F;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x4E8B;&#x60C5;&#xFF08;&#x6BD4;&#x5982;&#x4ECE;&#x7F51;&#x7EDC;&#x52A0;&#x8F7D;&#x5176;&#x4ED6;&#x5185;&#x5BB9;&#xFF09;&#xFF0C;&#x5C06;&#x5176;&#x63A8;&#x8FDF;&#x5230;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x65F6;&#x518D;&#x6267;&#x884C;&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x60A8;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5927;&#x591A;&#x6570;&#x4EE3;&#x7801;&#xFF08;&#x4F8B;&#x5982;&#x4ECE; localStorage &#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5904;&#x7406;&#x5927;&#x578B;&#x6570;&#x636E;&#x96C6;&#x7B49;&#xFF09;&#xFF0C;&#x60A8;&#x80AF;&#x5B9A;&#x5E0C;&#x671B;&#x5728;&#x9700;&#x8981;&#x5B83;&#x7684;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#x5C31;&#x80FD;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;</p><h3 id="articleHeader6">&#x5176;&#x4ED6;&#x9009;&#x62E9;</h3><p>&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x53CA;&#x65E9;&#x548C;&#x60F0;&#x6027;&#x6C42;&#x503C;&#x4E4B;&#x95F4;&#x9009;&#x53D6;&#x4E00;&#x79CD;&#x5176;&#x5B83;&#x6C42;&#x503C;&#x7B56;&#x7565;&#xFF0C;&#x6211;&#x4E0D;&#x786E;&#x5B9A;&#x4EE5;&#x4E0B;&#x4E24;&#x79CD;&#x7B56;&#x7565;&#x662F;&#x5426;&#x6709;&#x5B98;&#x65B9;&#x540D;&#x79F0;&#xFF0C;&#x4F46;&#x6211;&#x4F1A;&#x79F0;&#x4E4B;&#x4E3A;&#x5EF6;&#x8FDF;&#x6C42;&#x503C;&#x548C;&#x7A7A;&#x95F2;&#x6C42;&#x503C;&#xFF1A;</p><ul><li>__&#x5EF6;&#x8FDF;&#x6C42;&#x503C;&#xFF08;Deferred evaluation&#xFF09;__&#xFF1A;&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E; <code>setTimeout</code> &#x4E4B;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x5C06;&#x4EE3;&#x7801;&#x5B89;&#x6392;&#x5728;&#x4E00;&#x4E2A;&#x672A;&#x6765;&#x7684;&#x4EFB;&#x52A1;&#x91CC;&#x6267;&#x884C;</li><li>__&#x7A7A;&#x95F2;&#x6C42;&#x503C;&#xFF08;Idle evaluation&#xFF09;__&#xFF1A;&#x4E00;&#x79CD;&#x5EF6;&#x8FDF;&#x6C42;&#x503C;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x50CF; <a href="https://developers.google.com/web/updates/2015/08/using-requestidlecallback" rel="nofollow noreferrer" target="_blank">requestIdleCallback</a> &#x8FD9;&#x6837;&#x7684;API&#x6765;&#x5B89;&#x6392;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x3002;</li></ul><p>&#x8FD9;&#x4E24;&#x4E2A;&#x9009;&#x9879;&#x901A;&#x5E38;&#x90FD;&#x6BD4;&#x53CA;&#x65E9;&#x6216;&#x60F0;&#x6027;&#x6C42;&#x503C;&#x66F4;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x963B;&#x6B62;&#x8F93;&#x5165;&#x7684;&#x5355;&#x4E2A;&#x957F;&#x4EFB;&#x52A1;&#x53D1;&#x751F;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#xFF0C;&#x867D;&#x7136;&#x6D4F;&#x89C8;&#x5668;&#x65E0;&#x6CD5;&#x4E2D;&#x65AD;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x4EE5;&#x54CD;&#x5E94;&#x7528;&#x6237;&#x8F93;&#x5165;&#x65F6;&#xFF08;&#x8FD9;&#x6837;&#x505A;&#x5C06;&#x6781;&#x6709;&#x53EF;&#x80FD;&#x8BA9;&#x9875;&#x9762;&#x5D29;&#x6E83;&#xFF09;&#xFF0C;&#x4F46;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;&#x7684;&#x961F;&#x5217;&#x4E4B;&#x95F4;&#x8FD0;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x5C06;&#x7528;&#x6237;&#x8F93;&#x5165;&#x5F15;&#x53D1;&#x7684;&#x4EFB;&#x52A1;&#x8FD9;&#x4E48;&#x5B89;&#x6392;&#x3002;&#x8FD9;&#x79F0;&#x4E3A;<a href="https://blogs.windows.com/msedgedev/2017/06/01/input-responsiveness-event-loop-microsoft-edge/" rel="nofollow noreferrer" target="_blank">&#x8F93;&#x5165;&#x4F18;&#x5148;&#x7EA7;</a>&#xA0;&#x3002;</p><p>&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF1A;&#x5982;&#x679C;&#x80FD;&#x591F;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x90FD;&#x8FD0;&#x884C;&#x5728;&#x7B80;&#x77ED;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x4EFB;&#x52A1;&#x4E2D;&#xFF08;&#x6700;&#x597D;<a href="https://developers.google.com/web/fundamentals/performance/user-centric-performance-metrics#long_tasks" rel="nofollow noreferrer" target="_blank">&#x5C11;&#x4E8E; 50 &#x6BEB;&#x79D2;</a>&#xA0;&#xFF09;&#xFF0C;&#x60A8;&#x7684;&#x4EE3;&#x7801;&#x5C06;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x5835;&#x585E;&#x7528;&#x6237;&#x8F93;&#x5165;&#x3002;</p><p>__&#x91CD;&#x8981;&#xFF01;__&#xA0;&#x867D;&#x7136;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x4EE5;&#x5728;&#x6392;&#x961F;&#x4EFB;&#x52A1;&#x4E4B;&#x524D;&#x6267;&#x884C;&#x8F93;&#x5165;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x4F46;&#x5B83;&#x4EEC;&#x65E0;&#x6CD5;&#x5728;&#x6392;&#x961F;&#x7684;&#x5FAE;&#x4EFB;&#x52A1;&#x4E4B;&#x524D;&#x8FD0;&#x884C;&#x8F93;&#x5165;&#x56DE;&#x8C03;&#x3002;&#x7531;&#x4E8E; promises &#x548C; async &#x51FD;&#x6570;&#x4F1A;&#x4F5C;&#x4E3A;&#x5FAE;&#x4EFB;&#x52A1;&#x8FD0;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x5C06;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x57FA;&#x4E8E; promise &#x7684;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x4F1A;&#x907F;&#x514D;&#x5B83;&#x5835;&#x585E;&#x7528;&#x6237;&#x8F93;&#x5165;&#xFF01;</p><p>&#x5982;&#x679C;&#x60A8;&#x4E0D;&#x719F;&#x6089;&#x4EFB;&#x52A1;&#x548C;&#x5FAE;&#x4EFB;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x6211;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x60A8;&#x89C2;&#x770B;&#x6211;&#x7684;&#x540C;&#x4E8B; Jake&#xA0;<a href="https://youtu.be/cCOL7MC4Pl0" rel="nofollow noreferrer" target="_blank">&#x5173;&#x4E8E;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7684;&#x7CBE;&#x5F69;&#x6F14;&#x8BB2;</a> &#x3002;</p><p>&#x9274;&#x4E8E;&#x6211;&#x521A;&#x624D;&#x6240;&#x8BF4;&#xFF0C;&#x6211;&#x53EF;&#x4EE5;&#x91CD;&#x6784;&#x6211;&#x7684; <code>main()</code> &#x51FD;&#x6570;&#xFF0C;&#x4F7F;&#x7528; <code>setTimeout()</code> &#x548C; <code>requestIdleCallback()</code> &#x5C06;&#x6211;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;&#x5206;&#x89E3;&#x4E3A;&#x72EC;&#x7ACB;&#x7684;&#x4EFB;&#x52A1;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const main = () =&gt; {
  setTimeout(() =&gt; drawer.init(), 0);
  setTimeout(() =&gt; contentLoader.init(), 0);
  setTimeout(() =&gt; breakpoints.init(), 0);
  setTimeout(() =&gt; alerts.init(), 0);

  requestIdleCallback(() =&gt; analytics.init());
};

main();;" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> main = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> drawer.init(), <span class="hljs-number">0</span>);
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> contentLoader.init(), <span class="hljs-number">0</span>);
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> breakpoints.init(), <span class="hljs-number">0</span>);
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> alerts.init(), <span class="hljs-number">0</span>);

  requestIdleCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> analytics.init());
};

main();;</code></pre><p>&#x7136;&#x800C;&#xFF0C;&#x867D;&#x7136;&#x8FD9;&#x6BD4;&#x4EE5;&#x524D;&#x597D;&#x4E86;&#x4E00;&#x70B9;&#xFF08;&#x8BB8;&#x591A;&#x5C0F;&#x4EFB;&#x52A1; vs &#x4E00;&#x9879;&#x957F;&#x4EFB;&#x52A1;&#xFF09;&#xFF0C;&#x4F46;&#x6B63;&#x5982;&#x6211;&#x4E0A;&#x9762;&#x89E3;&#x91CA;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x4ECD;&#x7136;&#x4E0D;&#x591F;&#x597D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x63A8;&#x8FDF;&#x6211; UI &#x7EC4;&#x4EF6;&#xFF08;&#x7279;&#x522B;&#x662F;&#xA0;<code>contentLoader</code>&#xA0;&#x548C;&#xA0;<code>drawer</code>&#xFF09;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5B83;&#x4EEC;&#x5C06;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x5835;&#x585E;&#x7528;&#x6237;&#x8F93;&#x5165;&#xFF0C;&#x4F46;&#x662F;&#x5F53;&#x7528;&#x6237;&#x5C1D;&#x8BD5;&#x4E0E;&#x5B83;&#x4EEC;&#x4EA4;&#x4E92;&#x65F6;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x5B58;&#x5728;&#x672A;&#x51C6;&#x5907;&#x597D;&#x7684;&#x98CE;&#x9669;&#xFF01;</p><p>&#x867D;&#x7136;&#x4F7F;&#x7528;&#xA0;<code>requestIdleCallback()</code>&#xA0;&#x5C06;&#x6211;&#x7684; analytics &#x63A8;&#x8FDF;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E3B;&#x610F;&#xFF0C;&#x4F46;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x65F6;&#x6BB5;&#x4E4B;&#x524D;&#x6211;&#x5173;&#x5FC3;&#x7684;&#x4EFB;&#x4F55;&#x4EA4;&#x4E92;&#x90FD;&#x5C06;&#x88AB;&#x9057;&#x6F0F;&#x3002;&#x5982;&#x679C;&#x5728;&#x7528;&#x6237;&#x79BB;&#x5F00;&#x9875;&#x9762;&#x4E4B;&#x524D;&#x6CA1;&#x6709;&#x7A7A;&#x95F2;&#x65F6;&#x6BB5;&#xFF0C;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x8FD0;&#x884C;&#xFF01;</p><p>&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6240;&#x6709;&#x7684;&#x6C42;&#x503C;&#x7B56;&#x7565;&#x90FD;&#x6709;&#x7F3A;&#x70B9;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E00;&#x4E2A;&#x5462;&#xFF1F;</p><h2 id="articleHeader7">Idle Until Urgent &#xFF08;&#x95F2;&#x7F6E;&#x76F4;&#x5230;&#x7D27;&#x6025;&#xFF09;</h2><p>&#x5728;&#x82B1;&#x4E86;&#x5F88;&#x591A;&#x65F6;&#x95F4;&#x601D;&#x8003;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x610F;&#x8BC6;&#x5230;&#x6211;&#x771F;&#x6B63;&#x60F3;&#x8981;&#x7684;&#x6C42;&#x503C;&#x7B56;&#x7565;&#x662F;&#x8BA9;&#x6211;&#x7684;&#x4EE3;&#x7801;&#x5728;&#x6700;&#x521D;&#x65F6;&#x88AB;&#x63A8;&#x8FDF;&#x5230;&#x7A7A;&#x95F2;&#x65F6;&#x6BB5;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x9700;&#x8981;&#x65F6;&#x80FD;&#x591F;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF1A;&#xA0;_idle-until-urgent_&#xA0;&#x3002;</p><p>_idle-until-urgent_&#xA0;&#x7B56;&#x7565;&#x907F;&#x514D;&#x4E86;&#x6211;&#x5728;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x5927;&#x591A;&#x6570;&#x7F3A;&#x70B9;&#x3002;&#x5728;&#x6700;&#x574F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x4E0E;&#x5EF6;&#x8FDF;&#x6C42;&#x503C;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x6027;&#x80FD;&#x7279;&#x5F81;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x6700;&#x597D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B83;&#x6839;&#x672C;&#x4E0D;&#x5835;&#x585E;&#x4EA4;&#x4E92;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x53D1;&#x751F;&#x5728;&#x7A7A;&#x95F2;&#x671F;&#x95F4;&#x3002;</p><p>&#x6211;&#x8FD8;&#x5E94;&#x5F53;&#x63D0;&#x5230;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x7B56;&#x7565;&#x65E2;&#x9002;&#x7528;&#x4E8E;&#x5355;&#x4E2A;&#x4EFB;&#x52A1;&#xFF08;&#x95F2;&#x65F6;&#x8BA1;&#x7B97;&#x503C;&#xFF09;&#xFF0C;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#xFF08;&#x53EF;&#x4EE5;&#x5728;&#x7A7A;&#x95F2;&#x65F6;&#x8FD0;&#x884C;&#x7684;&#x4E00;&#x4E2A;&#x6709;&#x5E8F;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#xFF09;&#x3002;&#x6211;&#x5C06;&#x9996;&#x5148;&#x89E3;&#x91CA;&#x5355;&#x4EFB;&#x52A1;&#xFF08;&#x7A7A;&#x95F2;&#x503C;&#xFF09;&#x5F62;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x66F4;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x3002;</p><h3 id="articleHeader8">&#x7A7A;&#x95F2;&#x503C;</h3><p>&#x5728;&#x4E0A;&#x9762;&#xFF0C;&#x6211;&#x5411;&#x5927;&#x5BB6;&#x5C55;&#x793A;&#x4E86;&#x521D;&#x59CB;&#x5316;&#xA0;<code>Int.DateTimeFormat</code>&#xA0;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x4EE3;&#x4EF7;&#x975E;&#x5E38;&#x6602;&#x8D35;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x7ACB;&#x5373;&#x9700;&#x8981;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x7684;&#x8BDD;&#xFF0C;&#x6700;&#x597D;&#x5728;&#x7A7A;&#x95F2;&#x671F;&#x95F4;&#x521D;&#x59CB;&#x5316;&#x5B83;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x4E00;&#x65E6;&#x5F53;&#x5B83;&#x88AB;&#x9700;&#x8981;&#x65F6;&#xFF0C;&#x4F60;&#x5C31;&#x60F3;&#x8BA9;&#x5B83;&#x5B58;&#x5728;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#xA0;_idle-until-urgent_&#xA0;&#x6C42;&#x503C;&#x7B56;&#x7565;&#x7684;&#x5B8C;&#x7F8E;&#x5019;&#x9009;&#x5BF9;&#x8C61;&#x3002;</p><p>&#x8003;&#x8651;&#x4EE5;&#x4E0B;&#x6211;&#x4EEC;&#x8981;&#x91CD;&#x6784;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;&#x65B0;&#x7B56;&#x7565;&#x7684;&#x7B80;&#x5316;&#x7EC4;&#x4EF6;&#x793A;&#x4F8B;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="class MyComponent {
  constructor() {
    addEventListener(&apos;click&apos;, () =&gt; this.handleUserClick());

    this.formatter = new Intl.DateTimeFormat(&apos;en-US&apos;, {
      timeZone: &apos;America/Los_Angeles&apos;,
    });
  }

  handleUserClick() {
    console.log(this.formatter.format(new Date()));
  }
}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    addEventListener(<span class="hljs-string">&apos;click&apos;</span>, () =&gt; <span class="hljs-keyword">this</span>.handleUserClick());

    <span class="hljs-keyword">this</span>.formatter = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">&apos;en-US&apos;</span>, {
      <span class="hljs-attr">timeZone</span>: <span class="hljs-string">&apos;America/Los_Angeles&apos;</span>,
    });
  }

  handleUserClick() {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.formatter.format(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()));
  }
}</code></pre><p>&#x4E0A;&#x9762;&#x7684;&#xA0;<code>MyComponent</code>&#xA0;&#x5B9E;&#x4F8B;&#x5728;&#x5B83;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x505A;&#x4E86;&#x4E24;&#x4EF6;&#x4E8B;&#xFF1A;</p><ul><li>&#x4E3A;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x6DFB;&#x52A0;&#x4E8B;&#x4EF6;&#x4FA6;&#x542C;&#x5668;&#x3002;</li><li>&#x521B;&#x5EFA;&#xA0;<code>Intl.DateTimeFormat</code>&#xA0;&#x5BF9;&#x8C61;&#x3002;</li></ul><p>&#x8BE5;&#x7EC4;&#x4EF6;&#x5B8C;&#x7F8E;&#x5730;&#x8BF4;&#x660E;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x60A8;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x5728;&#x5355;&#x4E2A;&#x7EC4;&#x4EF6;&#x5185;&#x90E8;&#x62C6;&#x5206;&#x4EFB;&#x52A1;&#xFF08;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5728;&#x7EC4;&#x4EF6;&#x5C42;&#x9762;&#x4E0A;&#x62C6;&#x5206;&#xFF09;&#x3002;</p><p>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x7684;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x4F46;&#x5728;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x7528;&#x5230;&#x4E4B;&#x524D;&#xFF0C;&#x662F;&#x5426;&#x521B;&#x5EFA;&#x4E86;&#xA0;<code>Intl.DateTimeFormat</code>&#xA0;&#x5B9E;&#x4F8B;&#x5E76;&#x4E0D;&#x91CD;&#x8981;&#x3002;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E0D;&#x60F3;&#x5728;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E2D;&#x521B;&#x5EFA;&#xA0;<code>Intl.DateTimeFormat</code>&#xA0;&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x9F9F;&#x901F;&#x4F1A;&#x63A8;&#x8FDF;&#x8BE5;&#x4E8B;&#x4EF6;&#x7684;&#x8FD0;&#x884C;&#x3002;</p><p>&#x6240;&#x4EE5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x66F4;&#x65B0;&#x6B64;&#x4EE3;&#x7801;&#x4EE5;&#x4F7F;&#x7528;&#xA0;_idle-until-urgent_&#xA0;&#x7B56;&#x7565;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x6211;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#xA0;<code>IdleValue</code>&#xA0;&#x8F85;&#x52A9;&#x7C7B;&#xFF0C;&#x6211;&#x5C06;&#x5728;&#x4E0B;&#x9762;&#x89E3;&#x91CA;&#x5B83;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="import {IdleValue} from &apos;./path/to/IdleValue.mjs&apos;;

class MyComponent {
  constructor() {
    addEventListener(&apos;click&apos;, () =&gt; this.handleUserClick());

    this.formatter = new IdleValue(() =&gt; {
      return new Intl.DateTimeFormat(&apos;en-US&apos;, {
        timeZone: &apos;America/Los_Angeles&apos;,
      });
    });
  }

  handleUserClick() {
    console.log(this.formatter.getValue().format(new Date()));
  }
}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">import</span> {IdleValue} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./path/to/IdleValue.mjs&apos;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    addEventListener(<span class="hljs-string">&apos;click&apos;</span>, () =&gt; <span class="hljs-keyword">this</span>.handleUserClick());

    <span class="hljs-keyword">this</span>.formatter = <span class="hljs-keyword">new</span> IdleValue(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">&apos;en-US&apos;</span>, {
        <span class="hljs-attr">timeZone</span>: <span class="hljs-string">&apos;America/Los_Angeles&apos;</span>,
      });
    });
  }

  handleUserClick() {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.formatter.getValue().format(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()));
  }
}</code></pre><p>&#x6B63;&#x5982;&#x4F60;&#x6240;&#x89C1;&#xFF0C;&#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x4E0E;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x770B;&#x8D77;&#x6765;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;&#x662F;&#x4E0E;&#x5C06;&#xA0;<code>this.formatter</code>&#xA0;&#x5206;&#x914D;&#x7ED9;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#xA0;<code>Intl.DateTimeFormat</code>&#xA0;&#x5BF9;&#x8C61;&#x76F8;&#x53CD;&#xFF0C;&#x6211;&#x5C06; <code>this.formatter</code>&#xA0;&#x5206;&#x914D;&#x7ED9;&#x4E86;&#x4E00;&#x4E2A;&#xA0;<code>IdleValue</code>&#xA0;&#x5BF9;&#x8C61;&#xFF0C;&#x5728;&#x5BF9;&#x8C61;&#x4E2D;&#x6211;&#x4F20;&#x9012;&#x4E86;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x529F;&#x80FD;&#x3002;</p><p>&#x6B64;&#xA0;<code>IdleValue</code>&#xA0;&#x7C7B;&#x8D77;&#x4F5C;&#x7528;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#xFF0C;&#x5B83;&#x4F1A;&#x8C03;&#x5EA6;&#x5728;&#x4F1A;&#x4E0B;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x671F;&#x95F4;&#x8FD0;&#x884C;&#x7684;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;&#x3002;&#x5982;&#x679C;&#x7A7A;&#x95F2;&#x9636;&#x6BB5;&#x53D1;&#x751F;&#x5728; <code>IdleValue</code> &#x88AB;&#x5F15;&#x7528;&#x5B9E;&#x4F8B;&#x4E4B;&#x524D;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x963B;&#x585E;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5728;&#x8BF7;&#x6C42;&#x65F6;&#x7ACB;&#x5373;&#x62FF;&#x5230;&#x8BE5;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x4F46;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x5468;&#x671F;_&#x4E4B;&#x524D;_&#x5F15;&#x7528;&#x8BE5;&#x503C;&#xFF0C;&#x5219;&#x5B89;&#x6392;&#x597D;&#x7684;&#x7A7A;&#x95F2;&#x56DE;&#x8C03;&#x4F1A;&#x88AB;&#x53D6;&#x6D88;&#xFF0C;&#x5E76;&#x4E14;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;&#x4F1A;&#x88AB;&#x7ACB;&#x5373;&#x8C03;&#x7528;&#x3002;</p><p>&#x4E0B;&#x9762;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0; <code>IdleValue</code> &#x7C7B;&#x7684;&#x8981;&#x70B9;&#xFF08;&#x6CE8;&#x610F;&#xFF1A;&#x6211;&#x8FD8;&#x53D1;&#x5E03;&#x4E86;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4F5C;&#x4E3A;&#xA0;<a href="https://github.com/GoogleChromeLabs/idlize" rel="nofollow noreferrer" target="_blank">idlize</a>&#xA0;&#x5305; &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x672C;&#x6587;&#x4E2D;&#x663E;&#x793A;&#x7684;&#x6240;&#x6709; helper &#x7C7B;&#xFF09;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="export class IdleValue {
  constructor(init) {
    this._init = init;
    this._value;
    this._idleHandle = requestIdleCallback(() =&gt; {
      this._value = this._init();
    });
  }

  getValue() {
    if (this._value === undefined) {
      cancelIdleCallback(this._idleHandle);
      this._value = this._init();
    }
    return this._value;
  }

  // ...
}}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IdleValue</span> </span>{
  <span class="hljs-keyword">constructor</span>(init) {
    <span class="hljs-keyword">this</span>._init = init;
    <span class="hljs-keyword">this</span>._value;
    <span class="hljs-keyword">this</span>._idleHandle = requestIdleCallback(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">this</span>._value = <span class="hljs-keyword">this</span>._init();
    });
  }

  getValue() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._value === <span class="hljs-literal">undefined</span>) {
      cancelIdleCallback(<span class="hljs-keyword">this</span>._idleHandle);
      <span class="hljs-keyword">this</span>._value = <span class="hljs-keyword">this</span>._init();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._value;
  }

  <span class="hljs-comment">// ...</span>
}}</code></pre><p>&#x867D;&#x7136;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#x5F15;&#x5165;&#xA0;<code>IdleValue</code>&#xA0;&#x7C7B;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x5F88;&#x591A;&#x66F4;&#x6539;&#xFF0C;&#x4F46;&#x5B83;&#x5728;&#x6280;&#x672F;&#x4E0A;&#x6539;&#x53D8;&#x4E86;&#x516C;&#x5171;API&#xFF08;&#xA0;<code>this.formatter</code>&#xA0;&#x4E0E;&#xA0;<code>this.formatter.getValue()</code>&#xA0;&#xFF09;&#x3002;</p><p>&#x5982;&#x679C;&#x60A8;&#x5904;&#x4E8E;&#x60F3;&#x8981;&#x4F7F;&#x7528;&#xA0;<code>IdleValue</code>&#xA0;&#x7C7B;&#x4F46;&#x65E0;&#x6CD5;&#x66F4;&#x6539;&#x516C;&#x5171; API &#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5C06;&#xA0;<code>IdleValue</code>&#xA0;&#x7C7B;&#x4E0E; ES2015 <code>getter</code> &#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="class MyComponent {
  constructor() {
    addEventListener(&apos;click&apos;, () =&gt; this.handleUserClick());

    this._formatter = new IdleValue(() =&gt; {
      return new Intl.DateTimeFormat(&apos;en-US&apos;, {
        timeZone: &apos;America/Los_Angeles&apos;,
      });
    });
  }

  get formatter() {
    return this._formatter.getValue();
  }

  // ...
}}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    addEventListener(<span class="hljs-string">&apos;click&apos;</span>, () =&gt; <span class="hljs-keyword">this</span>.handleUserClick());

    <span class="hljs-keyword">this</span>._formatter = <span class="hljs-keyword">new</span> IdleValue(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">&apos;en-US&apos;</span>, {
        <span class="hljs-attr">timeZone</span>: <span class="hljs-string">&apos;America/Los_Angeles&apos;</span>,
      });
    });
  }

  get formatter() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._formatter.getValue();
  }

  <span class="hljs-comment">// ...</span>
}}</code></pre><p>&#x6216;&#x8005;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x4ECB;&#x610F;&#x4E00;&#x70B9;&#x62BD;&#x8C61;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xA0;<a href="https://github.com/GoogleChromeLabs/idlize/blob/master/docs/defineIdleProperty.md" rel="nofollow noreferrer" target="_blank"><code>defineIdleProperty()</code></a>&#xA0;helper &#x7C7B;&#xFF08;&#x5B83;&#x5728;&#x5E95;&#x5C42;&#x4F7F;&#x7528;&#x4E86;&#xA0;<code>Object.defineProperty()</code>&#xA0;&#xFF09;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="import {defineIdleProperty} from &apos;./path/to/defineIdleProperty.mjs&apos;;

class MyComponent {
  constructor() {
    addEventListener(&apos;click&apos;, () =&gt; this.handleUserClick());

    defineIdleProperty(this, &apos;formatter&apos;, () =&gt; {
      return new Intl.DateTimeFormat(&apos;en-US&apos;, {
        timeZone: &apos;America/Los_Angeles&apos;,
      });
    });
  }

  // ...
}}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">import</span> {defineIdleProperty} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./path/to/defineIdleProperty.mjs&apos;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    addEventListener(<span class="hljs-string">&apos;click&apos;</span>, () =&gt; <span class="hljs-keyword">this</span>.handleUserClick());

    defineIdleProperty(<span class="hljs-keyword">this</span>, <span class="hljs-string">&apos;formatter&apos;</span>, () =&gt; {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">&apos;en-US&apos;</span>, {
        <span class="hljs-attr">timeZone</span>: <span class="hljs-string">&apos;America/Los_Angeles&apos;</span>,
      });
    });
  }

  <span class="hljs-comment">// ...</span>
}}</code></pre><p>&#x5BF9;&#x4E8E;&#x8BA1;&#x7B97;&#x6210;&#x672C;&#x53EF;&#x80FD;&#x5F88;&#x9AD8;&#x7684;&#x5355;&#x4E2A;&#x5C5E;&#x6027;&#x503C;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x4E0D;&#x4F7F;&#x7528;&#x6B64;&#x7B56;&#x7565;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x66F4;&#x6539;API&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x5B83;&#xFF01;</p><p>&#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4F7F;&#x7528;&#x4E86; <code>Intl.DateTimeFormat</code> &#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x5B83;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E0B;&#x5217;&#x4EFB;&#x4E00;&#x9879;&#x64CD;&#x4F5C;&#x7684;&#x597D;&#x5019;&#x9009;&#x65B9;&#x6848;&#xFF1A;</p><ul><li>&#x5904;&#x7406;&#x5927;&#x91CF;&#x503C;&#x7684;&#x96C6;&#x5408;&#x3002;</li><li>&#x4ECE; localStorage&#xFF08;&#x6216; cookie &#xFF09;&#x83B7;&#x53D6;&#x503C;&#x3002;</li><li>&#x8FD0;&#x884C;&#xA0;getComputedStyle()&#xA0;&#xFF0C;&#xA0;getBoundingClientRect()&#xA0;&#x6216;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0A;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x6837;&#x5F0F;&#x6216;&#x5E03;&#x5C40;&#x7684; API&#x3002;</li></ul><h3 id="articleHeader9">&#x7A7A;&#x95F2;&#x4EFB;&#x52A1;&#x961F;&#x5217;</h3><p>&#x4E0A;&#x8FF0;&#x6280;&#x672F;&#x9002;&#x7528;&#x4E8E;&#x5176;&#x503C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5355;&#x4E2A;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x7684;&#x72EC;&#x7ACB;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x7684;&#x903B;&#x8F91;&#x53EF;&#x80FD;&#x4E0D;&#x9002;&#x5408;&#x7528;&#x5355;&#x4E2A;&#x51FD;&#x6570;&#x8868;&#x8FBE;&#xFF0C;&#x6216;&#x8005;&#xFF0C;&#x5373;&#x4F7F;&#x6280;&#x672F;&#x4E0A;&#x53EF;&#x884C;&#xFF0C;&#x60A8;&#x4ECD;&#x7136;&#x5E0C;&#x671B;&#x5C06;&#x5B83;&#x5206;&#x89E3;&#x4E3A;&#x51E0;&#x4E2A;&#x66F4;&#x5C0F;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x957F;&#x65F6;&#x95F4;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;</p><p>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x771F;&#x6B63;&#x9700;&#x8981;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4E2D;&#x5B89;&#x6392;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#xFF08;&#x51FD;&#x6570;&#xFF09;&#xFF0C;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7A7A;&#x95F2;&#x65F6;&#x8FD0;&#x884C;&#x3002;&#x961F;&#x5217;&#x5C06;&#x5728;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8FD0;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x9700;&#x8981;&#x56DE;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x65F6;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF09;&#xFF0C;&#x5B83;&#x5C06;&#x6682;&#x505C;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x3002;</p><p>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#xA0;<a href="https://github.com/GoogleChromeLabs/idlize" rel="nofollow noreferrer" target="_blank">IdleQueue</a>&#xA0;&#x7C7B;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x50CF;&#x8FD9;&#x6837;&#x4F7F;&#x7528;&#x5B83;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="import {IdleQueue} from &apos;./path/to/IdleQueue.mjs&apos;;

const queue = new IdleQueue();

queue.pushTask(() =&gt; {
  // Some expensive function that can run idly...
});

queue.pushTask(() =&gt; {
  // Some other task that depends on the above
  // expensive function having already run...
});" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">import</span> {IdleQueue} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./path/to/IdleQueue.mjs&apos;</span>;

<span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> IdleQueue();

queue.pushTask(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// Some expensive function that can run idly...</span>
});

queue.pushTask(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// Some other task that depends on the above</span>
  <span class="hljs-comment">// expensive function having already run...</span>
});</code></pre><p>&#x6CE8;&#x610F;&#xFF1A;&#x5C06;&#x540C;&#x6B65; JavaScript &#x4EE3;&#x7801;&#x5206;&#x89E3;&#x4E3A;&#x53EF;&#x4F5C;&#x4E3A;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x5F02;&#x6B65;&#x8FD0;&#x884C;&#x7684;&#x5355;&#x72EC;&#x4EFB;&#x52A1;&#x4E0E;<a href="https://developers.google.com/web/fundamentals/performance/optimizing-javascript/code-splitting/" rel="nofollow noreferrer" target="_blank">&#x4EE3;&#x7801;&#x5206;&#x5272;</a>&#x4E0D;&#x540C;&#xFF0C;&#x540E;&#x8005;&#x662F;&#x5C06;&#x5927;&#x578B; JavaScript bundle &#x5206;&#x89E3;&#x4E3A;&#x8F83;&#x5C0F;&#x7684;&#x6587;&#x4EF6;&#xFF08;&#x8FD9;&#x5BF9;&#x4E8E;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x4E5F;&#x5F88;&#x91CD;&#x8981;&#xFF09;&#x3002;</p><p>&#x4E0E;&#x4E0A;&#x9762;&#x663E;&#x793A;&#x7684;&#x7A7A;&#x95F2;&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x7B56;&#x7565;&#x4E00;&#x6837;&#xFF0C;&#x7A7A;&#x95F2;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x9700;&#x8981;&#x7ACB;&#x5373;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#xFF08;&#x5373;&#x201C;&#x7D27;&#x6025;&#x201D;&#x60C5;&#x51B5;&#x4E0B;&#xFF09;&#x3002;</p><p>&#x540C;&#x6837;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x70B9;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF1A;&#x6709;&#x65F6;&#x4E0D;&#x4EC5;&#x662F;&#x56E0;&#x4E3A;&#x4F60;&#x9700;&#x8981;&#x5C3D;&#x5FEB;&#x8BA1;&#x7B97;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x5E38;&#x56E0;&#x4E3A;&#x4F60;&#x8981;&#x4E0E;&#x540C;&#x6B65;&#x7684;&#x7B2C;&#x4E09;&#x65B9; API &#x96C6;&#x6210;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x517C;&#x5BB9;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x80FD;&#x591F;&#x540C;&#x6B65;&#x8FD0;&#x884C;&#x4F60;&#x7684;&#x4EFB;&#x52A1;&#x3002;</p><p>&#x5728;&#x4E00;&#x4E2A;&#x5B8C;&#x7F8E;&#x7684;&#x4E16;&#x754C;&#x4E2D;&#xFF0C;&#x6240;&#x6709; JavaScript API &#x90FD;&#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#xFF0C;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x7531;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x8FD4;&#x56DE;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x5C0F;&#x5757;&#x4EE3;&#x7801;&#x7EC4;&#x6210;&#x3002;&#x4F46;&#x5728;&#x73B0;&#x5B9E;&#x4E16;&#x754C;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x9057;&#x7559;&#x4EE3;&#x7801;&#x5E93;&#x6216;&#x4E0E;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x63A7;&#x5236;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x7684;&#x96C6;&#x6210;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x522B;&#x65E0;&#x9009;&#x62E9;&#xFF0C;&#x53EA;&#x80FD;&#x4FDD;&#x6301;&#x540C;&#x6B65;&#x3002;</p><p>&#x6B63;&#x5982;&#x6211;&#x4E4B;&#x524D;&#x6240;&#x8BF4;&#xFF0C;&#x8FD9;&#x662F; <em>idle-until-urgent</em> &#x6A21;&#x5F0F;&#x7684;&#x5DE8;&#x5927;&#x4F18;&#x52BF;&#x4E4B;&#x4E00;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5E94;&#x7528;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x7A0B;&#x5E8F;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x5927;&#x89C4;&#x6A21;&#x91CD;&#x5199;&#x67B6;&#x6784;&#x3002;</p><h3 id="articleHeader10">&#x4FDD;&#x8BC1;&#x7D27;&#x6025;&#x60C5;&#x51B5;</h3><p>&#x6211;&#x5728;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x8FC7;&#xA0;<code>requestIdleCallback()</code>&#xA0;&#x5E76;&#x6CA1;&#x6709;&#x4FDD;&#x8BC1;&#x56DE;&#x8C03;&#x5C06;&#x4F1A;&#x8FD0;&#x884C;&#x3002;&#x5728;&#x4E0E;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8BA8;&#x8BBA;&#xA0;<code>requestIdleCallback()</code>&#xA0;&#x65F6;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x542C;&#x5230;&#x7684;&#x4ED6;&#x4EEC;&#x4E0D;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#x3002;&#x5728;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x8FD0;&#x884C;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x8DB3;&#x4EE5;&#x6210;&#x4E3A;&#x4E0D;&#x4F7F;&#x7528;&#x4EE3;&#x7801;&#x7684;&#x7406;&#x7531; - &#x4E3A;&#x4E86;&#x4F7F;&#x4EE3;&#x7801;&#x5B89;&#x5168;&#x8FD0;&#x884C;&#x5E76;&#x4FDD;&#x6301;&#x4EE3;&#x7801;&#x540C;&#x6B65;&#xFF08;&#x5F53;&#x7136;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x963B;&#x585E;&#xFF09;&#x3002;</p><p>&#x4E00;&#x4E2A;&#x5B8C;&#x7F8E;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x3002;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x7684;&#x95EE;&#x9898;&#x662F;&#x5728;&#x5F88;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x9700;&#x8981;&#x5728;&#x9875;&#x9762;&#x5378;&#x8F7D;&#x65F6;&#x8FD0;&#x884C;&#xFF08;&#x4F8B;&#x5982;&#x8DDF;&#x8E2A;&#x51FA;&#x7AD9;&#x94FE;&#x63A5;&#x70B9;&#x51FB;&#x7B49;&#xFF09;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#xA0;<code>requestIdleCallback()</code>&#xA0;&#x6839;&#x672C;&#x65E0;&#x6CD5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#xFF0C;&#x56E0;&#x4E3A;&#x56DE;&#x8C03;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x8FD0;&#x884C;&#x3002;&#x7531;&#x4E8E;&#x5206;&#x6790;&#x5E93;&#x4E0D;&#x77E5;&#x9053;&#x4ED6;&#x4EEC;&#x7684;&#x7528;&#x6237;&#x4F55;&#x65F6;&#x4F1A;&#x5728;&#x9875;&#x9762;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x8C03;&#x7528;&#x4ED6;&#x4EEC;&#x7684; API&#xFF0C;&#x6545;&#x800C;&#x4ED6;&#x4EEC;&#x4E5F;&#x503E;&#x5411;&#x4E8E;&#x5B89;&#x5168;&#x5E76;&#x540C;&#x6B65;&#x8FD0;&#x884C;&#x6240;&#x6709;&#x4EE3;&#x7801;&#xFF08;&#x8FD9;&#x5F88;&#x4E0D;&#x5E78;&#xFF0C;&#x56E0;&#x4E3A;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x6765;&#x8BF4;&#x5E76;&#x4E0D;&#x5173;&#x952E;&#xFF09;&#x3002;</p><p>&#x4F46;&#x662F;&#x5728;&#xA0;_idle-until-urgent_ &#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;&#x6211;&#x4EEC;&#x6240;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x786E;&#x4FDD;&#x961F;&#x5217;&#x53EA;&#x8981;&#x5F53;&#x9875;&#x9762;&#x5904;&#x4E8E;&#x53EF;&#x80FD;&#x5F88;&#x5FEB;&#x5378;&#x8F7D;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5C31;&#x4F1A;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x3002;</p><p>&#x5982;&#x679C;&#x60A8;&#x719F;&#x6089;&#x6211;&#x5728;&#x6700;&#x8FD1;&#x5173;&#x4E8E;&#xA0;<a href="https://developers.google.com/web/updates/2018/07/page-lifecycle-api" rel="nofollow noreferrer" target="_blank">Page Lifecycle API &#x7684;&#x6587;&#x7AE0;</a>&#x4E2D;&#x7ED9;&#x51FA;&#x7684;&#x5EFA;&#x8BAE;&#xFF0C;&#x60A8;&#x5C31;&#x4F1A;&#x77E5;&#x9053;&#x5728;&#x9875;&#x9762;&#x88AB;&#x7EC8;&#x6B62;&#x6216;&#x4E22;&#x5F03;&#x4E4B;&#x524D;&#xFF0C;<a href="https://developers.google.com/web/updates/2018/07/page-lifecycle-api#advice-hidden" rel="nofollow noreferrer" target="_blank">&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4F9D;&#x8D56;&#x7684;&#x53EF;&#x9760;&#x56DE;&#x8C03;</a>&#x662F; <code>visibilitychange</code> &#x4E8B;&#x4EF6;&#xFF08;&#x56E0;&#x4E3A;&#x9875;&#x9762;&#x7684; <code>visibilityState</code> &#x53D8;&#x4E3A;&#x9690;&#x85CF;&#xFF09;&#x3002;&#x800C;&#x4E14;&#x7531;&#x4E8E;&#x5728;&#x9690;&#x85CF;&#x72B6;&#x6001;&#x4E0B;&#x7528;&#x6237;&#x65E0;&#x6CD5;&#x4E0E;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x662F;&#x8FD0;&#x884C;&#x4EFB;&#x4F55;&#x6392;&#x961F;&#x4E2D;&#x7684;&#x7A7A;&#x95F2;&#x4EFB;&#x52A1;&#x7684;&#x6700;&#x4F73;&#x65F6;&#x673A;&#x3002;</p><p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#xA0;<code>IdleQueue</code>&#xA0;&#x7C7B;&#xFF0C;&#x5219;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4F20;&#x9012;&#x7ED9;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x7B80;&#x5355;&#x914D;&#x7F6E;&#x9879;&#x6765;&#x542F;&#x7528;&#x6B64;&#x529F;&#x80FD;&#x3002;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const queue = new IdleQueue( { ensureTasksRun &#xFF1A; true } );" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js" style="word-break:break-word;white-space:initial"><span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> IdleQueue( { ensureTasksRun &#xFF1A; <span class="hljs-literal">true</span> } );</code></pre><p>&#x5BF9;&#x4E8E;&#x6E32;&#x67D3;&#x7B49;&#x4EFB;&#x52A1;&#xFF0C;&#x65E0;&#x9700;&#x786E;&#x4FDD;&#x5728;&#x9875;&#x9762;&#x5378;&#x8F7D;&#x4E4B;&#x524D;&#x8FD0;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x4FDD;&#x5B58;&#x7528;&#x6237;&#x72B6;&#x6001;&#x548C;&#x5728;&#x4F1A;&#x8BDD;&#x7ED3;&#x675F;&#x65F6;&#x53D1;&#x9001;&#x5206;&#x6790;&#x7B49;&#x4EFB;&#x52A1;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x5E0C;&#x671B;&#x5C06;&#x6B64;&#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code>&#x3002;</p><p>&#x6CE8;&#x610F;&#xFF1A;&#x76D1;&#x542C;&#xA0;<code>visibilitychange</code>&#xA0;&#x4E8B;&#x4EF6;&#x5E94;&#x8BE5;&#x8DB3;&#x4EE5;&#x786E;&#x4FDD;&#x5728;&#x5378;&#x8F7D;&#x9875;&#x9762;&#x4E4B;&#x524D;&#x8FD0;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E; Safari &#x7684;&#x6F0F;&#x6D1E;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x5173;&#x95ED;&#x9009;&#x9879;&#x5361;&#x65F6;&#xFF0C;&#xA0;<a href="https://github.com/GoogleChromeLabs/page-lifecycle/issues/2" rel="nofollow noreferrer" target="_blank">pagehide &#x548C; visibilitychange &#x4E8B;&#x4EF6;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x89E6;&#x53D1;</a>&#xA0;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x9488;&#x5BF9; Safari &#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5E94;&#x6025;&#x65B9;&#x6CD5;&#x3002;&#x8FD9;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5728; <code>IdleQueue</code>&#xA0;&#x7C7B;&#x4E2D;&#x5DF2;&#x7ECF;&#x4E3A;&#x60A8;&#x5B9E;&#x73B0;&#xA0;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x60A8;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x5B83;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5BF9;&#x5B83;&#x6709;&#x8DB3;&#x591F;&#x4E86;&#x89E3;&#x3002;</p><p>&#x8B66;&#x544A;&#xFF01;&#xA0;&#x4E0D;&#x8981;&#x4E3A;&#x4E86;&#x5728;&#x9875;&#x9762;&#x5378;&#x8F7D;&#x4E4B;&#x524D;&#x8FD0;&#x884C;&#x961F;&#x5217;&#x800C;&#x76D1;&#x542C;&#xA0;<code>unload</code>&#xA0;&#x4E8B;&#x4EF6;&#x3002;<code>unload</code> &#x4E8B;&#x4EF6;&#x5E76;&#x4E0D;&#x53EF;&#x9760;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x6709;&#x635F;&#x6027;&#x80FD;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x6211;&#x7684;&#xA0;<a href="https://developers.google.com/web/updates/2018/07/page-lifecycle-api#the-unload-event" rel="nofollow noreferrer" target="_blank">Page Lifecycle API &#x6587;&#x7AE0;</a>&#xA0;&#x3002;</p><h2 id="articleHeader11">idle-until-urgent &#x7684;&#x7528;&#x4F8B;</h2><p>&#x6BCF;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x53EF;&#x80FD;&#x4EE3;&#x4EF7;&#x9AD8;&#x6602;&#x7684;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x5C1D;&#x8BD5;&#x5C06;&#x5176;&#x5206;&#x89E3;&#x4E3A;&#x66F4;&#x5C0F;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x5982;&#x679C;&#x73B0;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x7ACB;&#x5373;&#x4F7F;&#x7528;&#x8BE5;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x672A;&#x6765;&#x67D0;&#x4E9B;&#x65F6;&#x5019;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8BE5;&#x4EE3;&#x7801;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x7F8E;&#x7684;&#xFF0C;&#x53EF;&#x4F7F;&#x7528;&#x7A7A;&#x95F2;&#x76F4;&#x5230;&#x7D27;&#x6025;&#x7B56;&#x7565;&#x7684;&#x7528;&#x4F8B; &#x3002;</p><p>&#x5728;&#x4F60;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x5EFA;&#x8BAE;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x5C31;&#x662F;&#x67E5;&#x770B;&#x4F60;&#x6240;&#x6709;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x4F1A;&#x8FD0;&#x884C;&#x53EF;&#x80FD;&#x5F88;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x90A3;&#x4E48;&#x91CD;&#x6784;&#x5B83;&#x4EEC;&#x4EE5;&#x4F7F;&#x7528; <code>IdleValue</code> &#x5BF9;&#x8C61;&#x6765;&#x4EE3;&#x66FF;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x4E9B;&#x903B;&#x8F91;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x903B;&#x8F91;&#x5BF9;&#x4E8E;&#x76F4;&#x63A5;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x51B3;&#x5B9A;&#x6027;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x8BF7;&#x8003;&#x8651;&#x5C06;&#x8BE5;&#x903B;&#x8F91;&#x6DFB;&#x52A0;&#x5230;&#xA0;<code>IdleQueue</code>&#xA0;&#x3002;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x8BE5;&#x4EE3;&#x7801;&#xFF0C;&#x4F60;&#x968F;&#x65F6;&#x53EF;&#x4EE5;&#x3002;</p><p>&#x7279;&#x522B;&#x9002;&#x5408;&#x8FD9;&#x79CD;&#x6280;&#x672F;&#x7684;&#x4E24;&#x4E2A;&#x5177;&#x4F53;&#x793A;&#x4F8B;&#xFF08;&#x5E76;&#x4E14;&#x4E0E;&#x5927;&#x90E8;&#x5206;&#x7F51;&#x7AD9;&#x76F8;&#x5173;&#xFF09;&#x662F;&#x6301;&#x4E45;&#x5316;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528;Redux&#x4E4B;&#x7C7B;&#xFF09;&#x548C;&#x7F51;&#x7AD9;&#x5206;&#x6790;&#x3002;</p><p>__&#x6CE8;&#x610F;__&#xFF1A;&#x8FD9;&#x4E9B;&#x7528;&#x4F8B;&#x60F3;&#x8868;&#x660E;&#x7684;&#x610F;&#x56FE;&#x662F;&#x4EFB;&#x52A1;&#x5E94;&#x8BE5;&#x5728;&#x7A7A;&#x95F2;&#x671F;&#x95F4;&#x8FD0;&#x884C;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x4E5F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x5904;&#x7406;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x4E9B;&#x4EFB;&#x52A1;&#x65E8;&#x5728;&#x5C3D;&#x5FEB;&#x8FD0;&#x884C;&#xFF08;&#x4F46;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x54CD;&#x5E94;&#x8F93;&#x5165;&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#xA0;<code>requestIdleCallback()</code>&#xA0;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x89E3;&#x51B3;&#x60A8;&#x7684;&#x95EE;&#x9898;&#x3002;</p><p>&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x7684;&#x4E00;&#x4E9B;&#x540C;&#x4E8B;&#x63D0;&#x51FA;&#x4E86;&#x65B0;&#x7684;Web&#x5E73;&#x53F0;API&#xFF08;&#xA0;<a href="https://discourse.wicg.io/t/shouldyield-enabling-script-to-yield-to-user-input/2881/17" rel="nofollow noreferrer" target="_blank">shouldYield()</a>&#xA0;&#x548C;&#x539F;&#x751F;&#x7684;&#xA0;<a href="https://github.com/spanicker/main-thread-scheduling/blob/master/README.md" rel="nofollow noreferrer" target="_blank">Scheduling API</a>&#xA0;&#xFF09;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p><h3 id="articleHeader12">&#x6301;&#x4E45;&#x5316;&#x5E94;&#x7528;&#x72B6;&#x6001;</h3><p>&#x8003;&#x8651;&#x8FD9;&#x6837;&#x4E00;&#x4E2A; Redux &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B83;&#x5C06;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x5B58;&#x50A8;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x4F46;&#x4E5F;&#x9700;&#x8981;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x5728;&#x6301;&#x4E45;&#x5B58;&#x50A8;&#xFF08;&#x5982; localStorage &#xFF09;&#x4E2D;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0B;&#x6B21;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x65F6;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x3002;</p><p>&#x5728; localStorage &#x4E2D;&#x5B58;&#x50A8;&#x72B6;&#x6001;&#x7684;&#x5927;&#x591A;&#x6570; Redux &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x7684; debounce &#x6280;&#x672F;&#x5927;&#x81F4;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="let debounceTimeout;

// Persist state changes to localStorage using a 1000ms debounce.
store.subscribe(() =&gt; {
  // Clear pending writes since there are new changes to save.
  clearTimeout(debounceTimeout);

  // Schedule the save with a 1000ms timeout (debounce),
  // so frequent changes aren&apos;t saved unnecessarily.
  debounceTimeout = setTimeout(() =&gt; {
    const jsonData = JSON.stringify(store.getState());
    localStorage.setItem(&apos;redux-data&apos;, jsonData);
  }, 1000);
});" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">let</span> debounceTimeout;

<span class="hljs-comment">// Persist state changes to localStorage using a 1000ms debounce.</span>
store.subscribe(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// Clear pending writes since there are new changes to save.</span>
  clearTimeout(debounceTimeout);

  <span class="hljs-comment">// Schedule the save with a 1000ms timeout (debounce),</span>
  <span class="hljs-comment">// so frequent changes aren&apos;t saved unnecessarily.</span>
  debounceTimeout = setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> jsonData = <span class="hljs-built_in">JSON</span>.stringify(store.getState());
    localStorage.setItem(<span class="hljs-string">&apos;redux-data&apos;</span>, jsonData);
  }, <span class="hljs-number">1000</span>);
});</code></pre><p>&#x867D;&#x7136;&#x4F7F;&#x7528; debounce &#x6280;&#x672F;&#x80AF;&#x5B9A;&#x6BD4;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x7528;&#x597D;&#xFF0C;&#x4F46;&#x5B83;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x7F8E;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;&#x95EE;&#x9898;&#x662F;&#x4F60;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x5F53; debounced &#x51FD;&#x6570;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x5728;&#x5BF9;&#x7528;&#x6237;&#x6765;&#x8BF4;&#x5F88;&#x5173;&#x952E;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;</p><p>&#x5728;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x5B89;&#x6392; localStorage &#x5199;&#x5165;&#x4F1A;&#x597D;&#x5F97;&#x591A;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x4ECE; debounce &#x7B56;&#x7565;&#x8F6C;&#x6362;&#x4E3A;&#xA0;_idle-until-urgent_&#xA0;&#x7B56;&#x7565;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const queue = new IdleQueue({ensureTasksRun: true});

// Persist state changes when the browser is idle, and
// only persist the most recent changes to avoid extra work.
store.subscribe(() =&gt; {
  // Clear pending writes since there are new changes to save.
  queue.clearPendingTasks();

  // Schedule the save to run when idle.
  queue.pushTask(() =&gt; {
    const jsonData = JSON.stringify(store.getState());
    localStorage.setItem(&apos;redux-data&apos;, jsonData);
  });
});" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> IdleQueue({<span class="hljs-attr">ensureTasksRun</span>: <span class="hljs-literal">true</span>});

<span class="hljs-comment">// Persist state changes when the browser is idle, and</span>
<span class="hljs-comment">// only persist the most recent changes to avoid extra work.</span>
store.subscribe(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// Clear pending writes since there are new changes to save.</span>
  queue.clearPendingTasks();

  <span class="hljs-comment">// Schedule the save to run when idle.</span>
  queue.pushTask(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> jsonData = <span class="hljs-built_in">JSON</span>.stringify(store.getState());
    localStorage.setItem(<span class="hljs-string">&apos;redux-data&apos;</span>, jsonData);
  });
});</code></pre><p>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6B64;&#x7B56;&#x7565;&#x80AF;&#x5B9A;&#x6BD4;&#x4F7F;&#x7528; debounce &#x66F4;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;&#x5373;&#x4F7F;&#x7528;&#x6237;&#x79BB;&#x5F00;&#x9875;&#x9762;&#xFF0C;&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x72B6;&#x6001;&#x5F97;&#x5230;&#x4FDD;&#x5B58;&#x3002;&#x800C;&#x4F7F;&#x7528; debounce &#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5199;&#x5165;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5931;&#x8D25;&#x3002;</p><h3 id="articleHeader13">&#x7F51;&#x7AD9;&#x5206;&#x6790;</h3><p>_idle-until-urgent_&#xA0;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5B8C;&#x7F8E;&#x7528;&#x4F8B;&#x662F;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#xFF0C;&#x8BF4;&#x660E;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#xA0;IdleQueue&#xA0;&#x7C7B;&#x6765;&#x5B89;&#x6392;&#x53D1;&#x9001;&#x5206;&#x6790;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x5373;&#x4F7F;&#x7528;&#x6237;&#x5173;&#x95ED;&#x9009;&#x9879;&#x5361;&#x6216;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7A7A;&#x95F2;&#x65F6;&#x6BB5;&#x4E4B;&#x524D;&#x5BFC;&#x822A;&#x7F51;&#x9875;&#xFF0C;&#xA0;&#x4E5F;&#x4F1A;&#x53D1;&#x9001;&#x5206;&#x6790;&#x6570;&#x636E;&#x3002;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const queue = new IdleQueue({ensureTasksRun: true});

const signupBtn = document.getElementById(&apos;signup&apos;);
signupBtn.addEventListener(&apos;click&apos;, () =&gt; {
  // Instead of sending the event immediately, add it to the idle queue.
  // The idle queue will ensure the event is sent even if the user
  // closes the tab or navigates away.
  queue.pushTask(() =&gt; {
    ga(&apos;send&apos;, &apos;event&apos;, {
      eventCategory: &apos;Signup Button&apos;,
      eventAction: &apos;click&apos;,
    });
  });
});" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> IdleQueue({<span class="hljs-attr">ensureTasksRun</span>: <span class="hljs-literal">true</span>});

<span class="hljs-keyword">const</span> signupBtn = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;signup&apos;</span>);
signupBtn.addEventListener(<span class="hljs-string">&apos;click&apos;</span>, () =&gt; {
  <span class="hljs-comment">// Instead of sending the event immediately, add it to the idle queue.</span>
  <span class="hljs-comment">// The idle queue will ensure the event is sent even if the user</span>
  <span class="hljs-comment">// closes the tab or navigates away.</span>
  queue.pushTask(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    ga(<span class="hljs-string">&apos;send&apos;</span>, <span class="hljs-string">&apos;event&apos;</span>, {
      <span class="hljs-attr">eventCategory</span>: <span class="hljs-string">&apos;Signup Button&apos;</span>,
      <span class="hljs-attr">eventAction</span>: <span class="hljs-string">&apos;click&apos;</span>,
    });
  });
});</code></pre><p>&#x9664;&#x4E86;&#x786E;&#x4FDD;&#x7D27;&#x6025;&#x65F6;&#x6267;&#x884C;&#x4E4B;&#x5916;&#xFF0C;&#x5C06;&#x6B64;&#x4EFB;&#x52A1;&#x6DFB;&#x52A0;&#x5230;&#x7A7A;&#x95F2;&#x961F;&#x5217;&#x8FD8;&#x53EF;&#x786E;&#x4FDD;&#x5B83;&#x4E0D;&#x4F1A;&#x963B;&#x6B62;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x54CD;&#x5E94;&#x7528;&#x6237;&#x5355;&#x51FB;&#x64CD;&#x4F5C;&#x6240;&#x9700;&#x7684;&#x4EE3;&#x7801;&#x3002;</p><p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x901A;&#x5E38;&#x6700;&#x597D;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x95F2;&#x6687;&#x65F6;&#x8FD0;&#x884C;&#x6240;&#x6709;&#x5206;&#x6790;&#x4EE3;&#x7801;&#xFF0C;&#x5305;&#x62EC;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;&#x3002;&#x5BF9;&#x4E8E;&#x50CF; analytics.js &#x8FD9;&#x6837;&#x7684;<a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/how-analyticsjs-works#the_ga_command_queue" rel="nofollow noreferrer" target="_blank">&#xA0;API &#x5DF2;&#x7ECF;&#x6210;&#x4E3A;&#x961F;&#x5217;&#x7684;&#x5E93;</a>&#xA0;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x5C06;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x6DFB;&#x52A0;&#x5230;&#x6211;&#x4EEC;&#x7684;&#xA0;<code>IdleQueue</code>&#xA0;&#x5B9E;&#x4F8B;&#x4E2D;&#x3002;</p><p>&#x4F8B;&#x5982;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#xA0;<a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/#the_javascript_tracking_snippet" rel="nofollow noreferrer" target="_blank">&#x9ED8;&#x8BA4;analytics.js&#x5B89;&#x88C5;&#x4EE3;&#x7801;&#x6BB5;</a>&#xA0;&#x7684;&#x6700;&#x540E;&#x4E00;&#x90E8;&#x5206;&#x8FD9;&#x6837;&#x8F6C;&#x6362;&#xFF1A; &#x4ECE;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="ga(&apos;create&apos;, &apos;UA-XXXXX-Y&apos;, &apos;auto&apos;);
ga(&apos;send&apos;, &apos;pageview&apos;);" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js">ga(<span class="hljs-string">&apos;create&apos;</span>, <span class="hljs-string">&apos;UA-XXXXX-Y&apos;</span>, <span class="hljs-string">&apos;auto&apos;</span>);
ga(<span class="hljs-string">&apos;send&apos;</span>, <span class="hljs-string">&apos;pageview&apos;</span>);</code></pre><p>&#x8F6C;&#x6210;&#x8FD9;&#x6837;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="const queue = new IdleQueue({ensureTasksRun: true});

queue.pushTask(() =&gt; ga(&apos;create&apos;, &apos;UA-XXXXX-Y&apos;, &apos;auto&apos;));
queue.pushTask(() =&gt; ga(&apos;send&apos;, &apos;pageview&apos;));" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="js"><span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> IdleQueue({<span class="hljs-attr">ensureTasksRun</span>: <span class="hljs-literal">true</span>});

queue.pushTask(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ga(<span class="hljs-string">&apos;create&apos;</span>, <span class="hljs-string">&apos;UA-XXXXX-Y&apos;</span>, <span class="hljs-string">&apos;auto&apos;</span>));
queue.pushTask(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ga(<span class="hljs-string">&apos;send&apos;</span>, <span class="hljs-string">&apos;pageview&apos;</span>));</code></pre><p>&#xFF08;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x7ED9;&#xA0;<code>ga()</code>&#xA0;&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x628A;&#x547D;&#x4EE4;&#x52A0;&#x5165;&#x961F;&#x5217;&#x7684; <code>wrapper</code>&#xFF0C;&#x8FD9;&#x5C31;&#x662F;<a href="https://github.com/philipwalton/blog/blob/0670d46/assets/javascript/analytics.js#L114-L127" rel="nofollow noreferrer" target="_blank">&#x6211;&#x6240;&#x505A;&#x7684;</a>&#xA0;&#xFF09;&#x3002;</p><h2 id="articleHeader14">requestIdleCallback &#x7684;&#x6D4F;&#x89C8;&#x5668;&#x652F;&#x6301;</h2><p>&#x5728;&#x64B0;&#x5199;&#x672C;&#x6587;&#x65F6;&#xFF0C;&#x53EA;&#x6709; Chrome &#x548C; Firefox &#x652F;&#x6301;&#xA0;<code>requestIdleCallback()</code>&#xA0;&#x3002;&#x867D;&#x7136;&#x771F;&#x6B63;&#x7684; polyfill &#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x5B9E;&#x73B0;&#x7684;&#xFF08;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x81EA;&#x5DF1;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x5B83;&#x4F55;&#x65F6;&#x7A7A;&#x95F2;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x9000;&#x56DE;&#xA0;<code>setTimeout</code>&#xA0;&#x7684; fallback&#xFF08;&#x672C;&#x6587;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x6240;&#x6709; helper &#x7C7B;&#x548C;&#x65B9;&#x6CD5;&#x90FD;&#x4F7F;&#x7528;&#x4E86;<a href="https://github.com/GoogleChromeLabs/idlize/blob/master/docs/idle-callback-polyfills.md" rel="nofollow noreferrer" target="_blank">&#x8FD9;&#x4E2A; fallback</a>&#xA0;&#xFF09;&#x3002;</p><p>&#x5373;&#x4F7F;&#x5728;&#x4E0D;&#x539F;&#x751F;&#x652F;&#x6301;&#xA0;<code>requestIdleCallback()</code>&#xA0;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#xFF0C; &#x4F7F;&#x7528;&#xA0;<code>setTimeout</code>&#xA0;&#x7684; fallback &#x80AF;&#x5B9A;&#x6BD4;&#x4E0D;&#x4F7F;&#x7528;&#x6B64;&#x7B56;&#x7565;&#x66F4;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;&#x6D4F;&#x89C8;&#x5668;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5728;&#x901A;&#x8FC7;&#xA0;<code>setTimeout()</code>&#xA0;&#x8FDB;&#x884C;&#x6392;&#x961F;&#x7684;&#x4EFB;&#x52A1;&#x4E4B;&#x524D;&#x8FDB;&#x884C;&#x8F93;&#x5165;&#x4F18;&#x5148;&#x7EA7;&#x6392;&#x5E8F;&#x3002;</p><h2 id="articleHeader15">&#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x63D0;&#x9AD8;&#x4E86;&#x591A;&#x5C11;&#x6027;&#x80FD;&#xFF1F;</h2><p>&#x5728;&#x672C;&#x6587;&#x5F00;&#x5934;&#x6211;&#x63D0;&#x5230;&#x6211;&#x60F3;&#x51FA;&#x4E86;&#x8FD9;&#x4E2A;&#x7B56;&#x7565;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x8BD5;&#x56FE;&#x63D0;&#x9AD8;&#x6211;&#x7684;&#x7F51;&#x7AD9;&#x7684; FID &#x503C;&#x3002;&#x6211;&#x8BD5;&#x56FE;&#x5C06; main bundle &#x52A0;&#x8F7D;&#x540E;&#x7684;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x5206;&#x5272;&#x5F00;&#xFF0C;&#x4F46;&#x6211;&#x8FD8;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x6211;&#x7684;&#x7F51;&#x7AD9;&#x7EE7;&#x7EED;&#x4F7F;&#x7528;&#x53EA;&#x6709;&#x540C;&#x6B65; API &#x7684;&#x67D0;&#x4E9B;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#xFF08;&#x4F8B;&#x5982; analytics.js &#xFF09;&#x3002;</p><p>&#x6211;&#x5728;&#x5B9E;&#x73B0;&#xA0;_idle-until-urgent_&#xA0;&#x4E4B;&#x524D;&#x505A;&#x7684;&#x8DDF;&#x8E2A;&#x663E;&#x793A;&#x51FA;&#xFF0C;&#x6211;&#x6709;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6240;&#x6709;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;&#x7684;233ms &#x4EFB;&#x52A1;&#x3002;&#x5728;&#x5B9E;&#x73B0;&#x6211;&#x5728;&#x6B64;&#x63CF;&#x8FF0;&#x7684;&#x6280;&#x672F;&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x6709;&#x591A;&#x4E2A;&#x66F4;&#x77ED;&#x65F6;&#x95F4;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6700;&#x957F;&#x7684;&#x4E00;&#x4E2A;&#x73B0;&#x5728;&#x53EA;&#x6709;37&#x6BEB;&#x79D2;&#xFF01;<br><span class="img-wrap"><img data-src="https://img.alicdn.com/tfs/TB1KJqDehTpK1RjSZFKXXa2wXXa-1399-636.png" src="https://static.alili.techhttps://img.alicdn.com/tfs/TB1KJqDehTpK1RjSZFKXXa2wXXa-1399-636.png" alt="idle-until-urget-after-1400w-d526f6cca8.png" title="idle-until-urget-after-1400w-d526f6cca8.png" style="cursor:pointer;display:inline"></span><br><em>&#x6211;&#x7F51;&#x7AD9;&#x7684; JavaScript &#x7684;&#x6027;&#x80FD;&#x8DDF;&#x8E2A;&#x663E;&#x793A;&#x4E86;&#x8BB8;&#x591A;&#x7B80;&#x77ED;&#x7684;&#x4EFB;&#x52A1;&#x3002;</em></p><p>&#x8FD9;&#x91CC;&#x8981;&#x5F3A;&#x8C03;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x5B83;&#x5B8C;&#x6210;&#x7684;&#x5DE5;&#x4F5C;&#x548C;&#x4E4B;&#x524D;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x73B0;&#x5728;&#x5206;&#x6563;&#x5728;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x4E0A;&#x5E76;&#x5728;&#x95F2;&#x7F6E;&#x671F;&#x95F4;&#x8FD0;&#x884C;&#x3002;</p><p>&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x9879;&#x4EFB;&#x52A1;&#x8D85;&#x8FC7; 50 &#x6BEB;&#x79D2;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x5F71;&#x54CD;&#x6211;&#x7684;&#x4EA4;&#x4E92;&#x65F6;&#x95F4;&#xFF08;TTI&#xFF09;&#xFF0C;&#x8FD9;&#x5BF9;&#x6211;&#x7684; lighthouse &#x5F97;&#x5206;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#xFF1A;<br><span class="img-wrap"><img data-src="https://img.alicdn.com/tfs/TB154eBeb2pK1RjSZFsXXaNlXXa-700-323.png" src="https://static.alili.techhttps://img.alicdn.com/tfs/TB154eBeb2pK1RjSZFsXXaNlXXa-700-323.png" alt="lighthouse-report-4721b091da.png" title="lighthouse-report-4721b091da.png" style="cursor:pointer"></span><br><em>&#x6211;&#x5B9E;&#x65BD;&#x4E86; _idle-until-urget</em> &#x4E4B;&#x540E;&#x7684; Lighthouse &#x62A5;&#x544A;&#x3002;_</p><p>&#x6700;&#x540E;&#xFF0C;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x5DE5;&#x4F5C;&#x7684;&#x91CD;&#x70B9;&#x662F;&#x63D0;&#x9AD8;&#x6211;&#x7684;FID&#xFF0C;&#x5728;&#x5C06;&#x8FD9;&#x4E9B;&#x66F4;&#x6539;&#x53D1;&#x5E03;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x5E76;&#x67E5;&#x770B;&#x7ED3;&#x679C;&#x540E;&#xFF0C;&#x6211;&#x5F88;&#x9AD8;&#x5174;&#x53D1;&#x73B0;&#x6211;&#x5728;&#x7B2C; 99 &#x767E;&#x5206;&#x4F4D;&#x6570;&#x4E0B;&#x7684; FID &#x503C;&#x51CF;&#x5C11;&#x4E86;67&#xFF05;&#xFF01;</p><table><thead><tr><th>&#x4EE3;&#x7801;&#x7248;&#x672C;</th><th>FID&#xFF08;p99&#xFF09;</th><th>FID&#xFF08;p95&#xFF09;</th><th>FID&#xFF08;p50&#xFF09;</th></tr></thead><tbody><tr><td>&#x5728;&#xA0;_idle-until-urgent_&#xA0;&#x4E4B;&#x524D;</td><td><strong>254ms</strong></td><td>20ms</td><td>3ms</td></tr><tr><td>&#x5728;&#xA0;_idle-until-urgent_&#xA0;&#x4E4B;&#x540E;</td><td><strong>285ms</strong></td><td>16ms</td><td>3ms</td></tr></tbody></table><h2 id="articleHeader16">&#x7ED3;&#x8BBA;</h2><p>&#x5728;&#x4E00;&#x4E2A;&#x5B8C;&#x7F8E;&#x7684;&#x4E16;&#x754C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x7F51;&#x7AD9;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x5728;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x65F6;&#x523B;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;&#x6211;&#x4EEC;&#x90FD;&#x4F7F;&#x7528; Web worker &#x6765;&#x5B8C;&#x6210;&#x975E; UI &#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x5185;&#x7F6E;&#x4E86;&#xA0;<a href="https://discourse.wicg.io/t/shouldyield-enabling-script-to-yield-to-user-input/2881/17" rel="nofollow noreferrer" target="_blank">shouldYield()</a>&#xA0;&#x548C;&#x539F;&#x751F;&#xA0;<a href="https://github.com/spanicker/main-thread-scheduling/blob/master/README.md" rel="nofollow noreferrer" target="_blank">Scheduling API</a>&#xA0;&#x3002;</p><p>&#x4F46;&#x662F;&#x5728;&#x6211;&#x4EEC;&#x5F53;&#x524D;&#x7684;&#x4E16;&#x754C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7684; Web &#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x901A;&#x5E38;&#x522B;&#x65E0;&#x9009;&#x62E9;&#xFF0C;&#x53EA;&#x80FD;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0A;&#x8FD0;&#x884C;&#x975E; UI &#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x65E0;&#x54CD;&#x5E94;&#x3002;</p><p>&#x5E0C;&#x671B;&#x672C;&#x6587;&#x80FD;&#x591F;&#x8BF4;&#x670D;&#x4F60;&#x5207;&#x5206;&#x957F;&#x671F;&#x8FD0;&#x884C;&#x7684; JavaScript &#x4EFB;&#x52A1;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x7531;&#x4E8E;&#xA0;_idle-until-urgent_&#xA0;&#x53EF;&#x4EE5;&#x5C06;&#x770B;&#x8D77;&#x6765;&#x540C;&#x6B65;&#x7684; API &#x53D8;&#x6210;&#x5B9E;&#x9645;&#x4E0A;&#x5728;&#x7A7A;&#x95F2;&#x65F6;&#x6BB5;&#x8FD0;&#x884C;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5E76;&#x9002;&#x7528;&#x4E8E;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x5E93;&#x3002;</p><p>&#x5982;&#x679C;&#x60A8;&#x559C;&#x6B22;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5E76;&#x8BA4;&#x4E3A;&#x5176;&#x4ED6;&#x4EBA;&#x4E5F;&#x5E94;&#x8BE5;&#x9605;&#x8BFB;&#x5B83;&#xFF0C;&#x8BF7;&#x5728;<a href="http://twitter.com/intent/tweet?text=Idle-Until-Urgent&amp;amp" rel="nofollow noreferrer" target="_blank"> Twitter &#x4E0A;&#x5206;&#x4EAB;</a>&#xA0;&#x3002;</p><blockquote>&#x6587;&#x7AE0;&#x53EF;&#x968F;&#x610F;&#x8F6C;&#x8F7D;&#xFF0C;&#x4F46;&#x8BF7;&#x4FDD;&#x7559;&#x6B64; <a href="https://www.yuque.com/es2049/blog" rel="nofollow noreferrer" target="_blank">&#x539F;&#x6587;&#x94FE;&#x63A5;</a>&#x3002;<br>&#x975E;&#x5E38;&#x6B22;&#x8FCE;&#x6709;&#x6FC0;&#x60C5;&#x7684;&#x4F60;&#x52A0;&#x5165; <a href="https://es2049.studio/" rel="nofollow noreferrer" target="_blank">ES2049 Studio</a>&#xFF0C;&#x7B80;&#x5386;&#x8BF7;&#x53D1;&#x9001;&#x81F3; caijun.hcj(at)alibaba-inc.com &#x3002;</blockquote>
{{% /raw %}}

# 版权声明
本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，
本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。
原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！

## 原文标题
「译」代码优化策略 — Idle Until Urgent

## 原文链接
[https://segmentfault.com/a/1190000016573872](https://segmentfault.com/a/1190000016573872)

