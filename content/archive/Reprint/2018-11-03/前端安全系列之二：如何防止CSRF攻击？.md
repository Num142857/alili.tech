---
title: 前端安全系列之二：如何防止CSRF攻击？
reprint: true
categories: reprint
abbrlink: 1fd28e6
date: 2018-11-03 10:03:44
---

{{% raw %}}
<h2 id="articleHeader0">&#x80CC;&#x666F;</h2><p>&#x968F;&#x7740;&#x4E92;&#x8054;&#x7F51;&#x7684;&#x9AD8;&#x901F;&#x53D1;&#x5C55;&#xFF0C;&#x4FE1;&#x606F;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x5DF2;&#x7ECF;&#x6210;&#x4E3A;&#x4F01;&#x4E1A;&#x6700;&#x4E3A;&#x5173;&#x6CE8;&#x7684;&#x7126;&#x70B9;&#x4E4B;&#x4E00;&#xFF0C;&#x800C;&#x524D;&#x7AEF;&#x53C8;&#x662F;&#x5F15;&#x53D1;&#x4F01;&#x4E1A;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x7684;&#x9AD8;&#x5371;&#x636E;&#x70B9;&#x3002;&#x5728;&#x79FB;&#x52A8;&#x4E92;&#x8054;&#x7F51;&#x65F6;&#x4EE3;&#xFF0C;&#x524D;&#x7AEF;&#x4EBA;&#x5458;&#x9664;&#x4E86;&#x4F20;&#x7EDF;&#x7684; XSS&#x3001;CSRF &#x7B49;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x4E4B;&#x5916;&#xFF0C;&#x53C8;&#x65F6;&#x5E38;&#x906D;&#x9047;&#x7F51;&#x7EDC;&#x52AB;&#x6301;&#x3001;&#x975E;&#x6CD5;&#x8C03;&#x7528; Hybrid API &#x7B49;&#x65B0;&#x578B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x81EA;&#x8EAB;&#x4E5F;&#x5728;&#x4E0D;&#x65AD;&#x5728;&#x8FDB;&#x5316;&#x548C;&#x53D1;&#x5C55;&#xFF0C;&#x4E0D;&#x65AD;&#x5F15;&#x5165; CSP&#x3001;Same-Site Cookies &#x7B49;&#x65B0;&#x6280;&#x672F;&#x6765;&#x589E;&#x5F3A;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x4ECD;&#x5B58;&#x5728;&#x5F88;&#x591A;&#x6F5C;&#x5728;&#x7684;&#x5A01;&#x80C1;&#xFF0C;&#x8FD9;&#x9700;&#x8981;&#x524D;&#x7AEF;&#x6280;&#x672F;&#x4EBA;&#x5458;&#x4E0D;&#x65AD;&#x8FDB;&#x884C;&#x201C;&#x67E5;&#x6F0F;&#x8865;&#x7F3A;&#x201D;&#x3002;</p><h2 id="articleHeader1">&#x524D;&#x7AEF;&#x5B89;&#x5168;</h2><p>&#x8FD1;&#x51E0;&#x5E74;&#xFF0C;&#x7F8E;&#x56E2;&#x4E1A;&#x52A1;&#x9AD8;&#x901F;&#x53D1;&#x5C55;&#xFF0C;&#x524D;&#x7AEF;&#x968F;&#x4E4B;&#x9762;&#x4E34;&#x5F88;&#x591A;&#x5B89;&#x5168;&#x6311;&#x6218;&#xFF0C;&#x56E0;&#x6B64;&#x79EF;&#x7D2F;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x5B9E;&#x8DF5;&#x7ECF;&#x9A8C;&#x3002;&#x6211;&#x4EEC;&#x68B3;&#x7406;&#x4E86;&#x5E38;&#x89C1;&#x7684;&#x524D;&#x7AEF;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5C06;&#x4F1A;&#x505A;&#x6210;&#x4E00;&#x4E2A;&#x7CFB;&#x5217;&#xFF0C;&#x5E0C;&#x671B;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x524D;&#x7AEF;&#x540C;&#x5B66;&#x5728;&#x65E5;&#x5E38;&#x5F00;&#x53D1;&#x4E2D;&#x4E0D;&#x65AD;&#x9884;&#x9632;&#x548C;&#x4FEE;&#x590D;&#x5B89;&#x5168;&#x6F0F;&#x6D1E;&#x3002;&#x672C;&#x6587;&#x662F;&#x8BE5;&#x7CFB;&#x5217;&#x7684;&#x7B2C;&#x4E8C;&#x7BC7;&#x3002;</p><p>&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x8BB2;&#x89E3;&#x4E00;&#x4E0B; CSRF&#xFF0C;&#x5176;&#x5B9E;&#x76F8;&#x6BD4;XSS&#xFF0C;CSRF&#x7684;&#x540D;&#x6C14;&#x4F3C;&#x4E4E;&#x5E76;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5927;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x8BA4;&#x4E3A;&#x201C;CSRF&#x4E0D;&#x5177;&#x5907;&#x90A3;&#x4E48;&#x5927;&#x7684;&#x7834;&#x574F;&#x6027;&#x201D;&#x3002;&#x771F;&#x7684;&#x662F;&#x8FD9;&#x6837;&#x5417;&#xFF1F;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6709;&#x8BF7;&#x5C0F;&#x660E;&#x540C;&#x5B66;&#x518D;&#x6B21;&#x201C;&#x95EA;&#x4EAE;&#x201D;&#x767B;&#x573A;&#x3002;</p><h2 id="articleHeader2">CSRF&#x653B;&#x51FB;</h2><h3 id="articleHeader3">CSRF&#x6F0F;&#x6D1E;&#x7684;&#x53D1;&#x751F;</h3><p>&#x76F8;&#x6BD4;XSS&#xFF0C;CSRF&#x7684;&#x540D;&#x6C14;&#x4F3C;&#x4E4E;&#x5E76;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5927;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x8BA4;&#x4E3A;CSRF&#x201C;&#x4E0D;&#x90A3;&#x4E48;&#x6709;&#x7834;&#x574F;&#x6027;&#x201D;&#x3002;&#x771F;&#x7684;&#x662F;&#x8FD9;&#x6837;&#x5417;&#xFF1F;</p><p>&#x63A5;&#x4E0B;&#x6765;&#x6709;&#x8BF7;&#x5C0F;&#x660E;&#x51FA;&#x573A;~~</p><h4>&#x5C0F;&#x660E;&#x7684;&#x60B2;&#x60E8;&#x906D;&#x9047;</h4><p>&#x8FD9;&#x4E00;&#x5929;&#xFF0C;&#x5C0F;&#x660E;&#x540C;&#x5B66;&#x767E;&#x65E0;&#x804A;&#x8D56;&#x5730;&#x5237;&#x7740;Gmail&#x90AE;&#x4EF6;&#x3002;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x6CA1;&#x8425;&#x517B;&#x7684;&#x901A;&#x77E5;&#x3001;&#x9A8C;&#x8BC1;&#x7801;&#x3001;&#x804A;&#x5929;&#x8BB0;&#x5F55;&#x4E4B;&#x7C7B;&#x3002;&#x4F46;&#x6709;&#x4E00;&#x5C01;&#x90AE;&#x4EF6;&#x5F15;&#x8D77;&#x4E86;&#x5C0F;&#x660E;&#x7684;&#x6CE8;&#x610F;&#xFF1A;</p><blockquote>&#x7529;&#x5356;&#x6BD4;&#x7279;&#x5E01;&#xFF0C;&#x4E00;&#x4E2A;&#x53EA;&#x8981;998&#xFF01;&#xFF01;</blockquote><p>&#x806A;&#x660E;&#x7684;&#x5C0F;&#x660E;&#x5F53;&#x7136;&#x77E5;&#x9053;&#x8FD9;&#x79CD;&#x80AF;&#x5B9A;&#x662F;&#x9A97;&#x5B50;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x62B1;&#x7740;&#x597D;&#x5947;&#x7684;&#x6001;&#x5EA6;&#x70B9;&#x4E86;&#x8FDB;&#x53BB;&#xFF08;&#x8BF7;&#x52FF;&#x6A21;&#x4EFF;&#xFF09;&#x3002;&#x679C;&#x7136;&#xFF0C;&#x8FD9;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#x7684;&#x7A7A;&#x767D;&#x9875;&#x9762;&#xFF0C;&#x5C0F;&#x660E;&#x5931;&#x671B;&#x7684;&#x5173;&#x95ED;&#x4E86;&#x9875;&#x9762;&#x3002;&#x4E00;&#x5207;&#x4F3C;&#x4E4E;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;......</p><p>&#x5728;&#x8FD9;&#x5E73;&#x9759;&#x7684;&#x5916;&#x8868;&#x4E4B;&#x4E0B;&#xFF0C;&#x9ED1;&#x5BA2;&#x7684;&#x653B;&#x51FB;&#x5DF2;&#x7136;&#x5F97;&#x624B;&#x3002;&#x5C0F;&#x660E;&#x7684;Gmail&#x4E2D;&#xFF0C;&#x88AB;&#x5077;&#x5077;&#x8BBE;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x8FC7;&#x6EE4;&#x89C4;&#x5219;&#xFF0C;&#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x4F7F;&#x5F97;&#x6240;&#x6709;&#x7684;&#x90AE;&#x4EF6;&#x90FD;&#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x8F6C;&#x53D1;&#x5230;haker@hackermail.com&#x3002;&#x5C0F;&#x660E;&#x8FD8;&#x5728;&#x7EE7;&#x7EED;&#x5237;&#x7740;&#x90AE;&#x4EF6;&#xFF0C;&#x6B8A;&#x4E0D;&#x77E5;&#x4ED6;&#x7684;&#x90AE;&#x4EF6;&#x6B63;&#x5728;&#x4E00;&#x5C01;&#x5C01;&#x5730;&#xFF0C;&#x5982;&#x8131;&#x7F30;&#x7684;&#x91CE;&#x9A6C;&#x4E00;&#x822C;&#x5730;&#xFF0C;&#x6301;&#x7EED;&#x4E0D;&#x65AD;&#x5730;&#x5411;&#x7740;&#x9ED1;&#x5BA2;&#x7684;&#x90AE;&#x7BB1;&#x8F6C;&#x53D1;&#x800C;&#x53BB;&#x3002;</p><p>&#x4E0D;&#x4E45;&#x4E4B;&#x540E;&#x7684;&#x4E00;&#x5929;&#xFF0C;&#x5C0F;&#x660E;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x57DF;&#x540D;&#x5DF2;&#x7ECF;&#x88AB;&#x8F6C;&#x8BA9;&#x4E86;&#x3002;&#x61F5;&#x61C2;&#x7684;&#x5C0F;&#x660E;&#x4EE5;&#x4E3A;&#x662F;&#x57DF;&#x540D;&#x5230;&#x671F;&#x81EA;&#x5DF1;&#x5FD8;&#x4E86;&#x7EED;&#x8D39;&#xFF0C;&#x76F4;&#x5230;&#x6709;&#x4E00;&#x5929;&#xFF0C;&#x5BF9;&#x65B9;&#x5F00;&#x51FA;&#x4E86; $650 &#x7684;&#x8D4E;&#x56DE;&#x4EF7;&#x7801;&#xFF0C;&#x5C0F;&#x660E;&#x624D;&#x5F00;&#x59CB;&#x89C9;&#x5F97;&#x4E0D;&#x592A;&#x5BF9;&#x52B2;&#x3002;</p><p>&#x5C0F;&#x660E;&#x4ED4;&#x7EC6;&#x67E5;&#x4E86;&#x4E0B;&#x57DF;&#x540D;&#x7684;&#x8F6C;&#x8BA9;&#xFF0C;&#x5BF9;&#x65B9;&#x662F;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#xFF0C;&#x800C;&#x57DF;&#x540D;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#x53EA;&#x5B58;&#x5728;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x90AE;&#x7BB1;&#x91CC;&#x9762;&#x3002;&#x5C0F;&#x660E;&#x56DE;&#x60F3;&#x8D77;&#x90A3;&#x5929;&#x5947;&#x602A;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x6253;&#x5F00;&#x540E;&#x91CD;&#x65B0;&#x67E5;&#x770B;&#x4E86;&#x201C;&#x7A7A;&#x767D;&#x9875;&#x201D;&#x7684;&#x6E90;&#x7801;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="&lt;form method=&quot;POST&quot; action=&quot;https://mail.google.com/mail/h/ewt1jmuj4ddv/?v=prf&quot; enctype=&quot;multipart/form-data&quot;&gt; 
    &lt;input type=&quot;hidden&quot; name=&quot;cf2_emc&quot; value=&quot;true&quot;/&gt; 
    &lt;input type=&quot;hidden&quot; name=&quot;cf2_email&quot; value=&quot;hacker@hakermail.com&quot;/&gt; 
    .....
    &lt;input type=&quot;hidden&quot; name=&quot;irf&quot; value=&quot;on&quot;/&gt; 
    &lt;input type=&quot;hidden&quot; name=&quot;nvp_bu_cftb&quot; value=&quot;Create Filter&quot;/&gt; 
&lt;/form&gt; 
&lt;script&gt; 
    document.forms[0].submit();
&lt;/script&gt;" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="hljs accesslog"><code>&lt;form method=<span class="hljs-string">&quot;<span class="hljs-keyword">POST</span>&quot;</span> action=<span class="hljs-string">&quot;https://mail.google.com/mail/h/ewt1jmuj4ddv/?v=prf&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt; 
    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;cf2_emc&quot;</span> value=<span class="hljs-string">&quot;true&quot;</span>/&gt; 
    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;cf2_email&quot;</span> value=<span class="hljs-string">&quot;hacker@hakermail.com&quot;</span>/&gt; 
    .....
    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;irf&quot;</span> value=<span class="hljs-string">&quot;on&quot;</span>/&gt; 
    &lt;input type=<span class="hljs-string">&quot;hidden&quot;</span> name=<span class="hljs-string">&quot;nvp_bu_cftb&quot;</span> value=<span class="hljs-string">&quot;Create Filter&quot;</span>/&gt; 
&lt;/form&gt; 
&lt;script&gt; 
    document.forms<span class="hljs-string">[0]</span>.submit();
&lt;/script&gt;</code></pre><blockquote>&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x53EA;&#x8981;&#x6253;&#x5F00;&#xFF0C;&#x5C31;&#x4F1A;&#x5411;Gmail&#x53D1;&#x9001;&#x4E00;&#x4E2A;post&#x8BF7;&#x6C42;&#x3002;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x6267;&#x884C;&#x4E86;&#x201C;Create Filter&#x201D;&#x547D;&#x4EE4;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x7684;&#x90AE;&#x4EF6;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x201C;hacker@hakermail.com&#x201D;&#x3002;<p>&#x5C0F;&#x660E;&#x7531;&#x4E8E;&#x521A;&#x521A;&#x5C31;&#x767B;&#x9646;&#x4E86;Gmail&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x65F6;&#xFF0C;&#x643A;&#x5E26;&#x7740;&#x5C0F;&#x660E;&#x7684;&#x767B;&#x5F55;&#x51ED;&#x8BC1;&#xFF08;Cookie&#xFF09;&#xFF0C;Gmail&#x7684;&#x540E;&#x53F0;&#x63A5;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#xFF0C;&#x9A8C;&#x8BC1;&#x4E86;&#x786E;&#x5B9E;&#x6709;&#x5C0F;&#x660E;&#x7684;&#x767B;&#x5F55;&#x51ED;&#x8BC1;&#xFF0C;&#x4E8E;&#x662F;&#x6210;&#x529F;&#x7ED9;&#x5C0F;&#x660E;&#x914D;&#x7F6E;&#x4E86;&#x8FC7;&#x6EE4;&#x5668;&#x3002;</p><p>&#x9ED1;&#x5BA2;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5C0F;&#x660E;&#x7684;&#x6240;&#x6709;&#x90AE;&#x4EF6;&#xFF0C;&#x5305;&#x62EC;&#x90AE;&#x4EF6;&#x91CC;&#x7684;&#x57DF;&#x540D;&#x9A8C;&#x8BC1;&#x7801;&#x7B49;&#x9690;&#x79C1;&#x4FE1;&#x606F;&#x3002;&#x62FF;&#x5230;&#x9A8C;&#x8BC1;&#x7801;&#x4E4B;&#x540E;&#xFF0C;&#x9ED1;&#x5BA2;&#x5C31;&#x53EF;&#x4EE5;&#x8981;&#x6C42;&#x57DF;&#x540D;&#x670D;&#x52A1;&#x5546;&#x628A;&#x57DF;&#x540D;&#x91CD;&#x7F6E;&#x7ED9;&#x81EA;&#x5DF1;&#x3002;</p></blockquote><p>&#x5C0F;&#x660E;&#x5F88;&#x5FEB;&#x6253;&#x5F00;Gmail&#xFF0C;&#x627E;&#x5230;&#x4E86;&#x90A3;&#x6761;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x5C06;&#x5176;&#x5220;&#x9664;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5DF2;&#x7ECF;&#x6CC4;&#x9732;&#x7684;&#x90AE;&#x4EF6;&#xFF0C;&#x5DF2;&#x7ECF;&#x88AB;&#x8F6C;&#x8BA9;&#x7684;&#x57DF;&#x540D;&#xFF0C;&#x518D;&#x4E5F;&#x65E0;&#x6CD5;&#x633D;&#x56DE;&#x4E86;......</p><p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x5C0F;&#x660E;&#x7684;&#x60B2;&#x60E8;&#x906D;&#x9047;&#x3002;&#x800C;&#x201C;&#x70B9;&#x5F00;&#x4E00;&#x4E2A;&#x9ED1;&#x5BA2;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x6240;&#x6709;&#x90AE;&#x4EF6;&#x90FD;&#x88AB;&#x7A83;&#x53D6;&#x201D;&#x8FD9;&#x79CD;&#x4E8B;&#x60C5;&#x5E76;&#x4E0D;&#x662F;&#x675C;&#x64B0;&#x7684;&#xFF0C;&#x6B64;&#x4E8B;&#x4EF6;&#x539F;&#x578B;&#x662F;2007&#x5E74;Gmail&#x7684;CSRF&#x6F0F;&#x6D1E;&#xFF1A;</p><p><a href="https://www.davidairey.com/google-gmail-security-hijack/" rel="nofollow noreferrer" target="_blank">https://www.davidairey.com/google-Gmail-security-hijack/</a></p><p>&#x5F53;&#x7136;&#xFF0C;&#x76EE;&#x524D;&#x6B64;&#x6F0F;&#x6D1E;&#x5DF2;&#x88AB;Gmail&#x4FEE;&#x590D;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;Gmail&#x7684;&#x540C;&#x5B66;&#x4E0D;&#x8981;&#x614C;&#x5F20;&#x3002;</p><h4>&#x4EC0;&#x4E48;&#x662F;CSRF</h4><p>CSRF&#xFF08;Cross-site request forgery&#xFF09;&#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x4F2A;&#x9020;&#xFF1A;&#x653B;&#x51FB;&#x8005;&#x8BF1;&#x5BFC;&#x53D7;&#x5BB3;&#x8005;&#x8FDB;&#x5165;&#x7B2C;&#x4E09;&#x65B9;&#x7F51;&#x7AD9;&#xFF0C;&#x5728;&#x7B2C;&#x4E09;&#x65B9;&#x7F51;&#x7AD9;&#x4E2D;&#xFF0C;&#x5411;&#x88AB;&#x653B;&#x51FB;&#x7F51;&#x7AD9;&#x53D1;&#x9001;&#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x3002;&#x5229;&#x7528;&#x53D7;&#x5BB3;&#x8005;&#x5728;&#x88AB;&#x653B;&#x51FB;&#x7F51;&#x7AD9;&#x5DF2;&#x7ECF;&#x83B7;&#x53D6;&#x7684;&#x6CE8;&#x518C;&#x51ED;&#x8BC1;&#xFF0C;&#x7ED5;&#x8FC7;&#x540E;&#x53F0;&#x7684;&#x7528;&#x6237;&#x9A8C;&#x8BC1;&#xFF0C;&#x8FBE;&#x5230;&#x5192;&#x5145;&#x7528;&#x6237;&#x5BF9;&#x88AB;&#x653B;&#x51FB;&#x7684;&#x7F51;&#x7AD9;&#x6267;&#x884C;&#x67D0;&#x9879;&#x64CD;&#x4F5C;&#x7684;&#x76EE;&#x7684;&#x3002;</p><p>&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;CSRF&#x653B;&#x51FB;&#x6709;&#x7740;&#x5982;&#x4E0B;&#x7684;&#x6D41;&#x7A0B;&#xFF1A;</p><ul><li>&#x53D7;&#x5BB3;&#x8005;&#x767B;&#x5F55;a.com&#xFF0C;&#x5E76;&#x4FDD;&#x7559;&#x4E86;&#x767B;&#x5F55;&#x51ED;&#x8BC1;&#xFF08;Cookie&#xFF09;&#x3002;</li><li>&#x653B;&#x51FB;&#x8005;&#x5F15;&#x8BF1;&#x53D7;&#x5BB3;&#x8005;&#x8BBF;&#x95EE;&#x4E86;b.com&#x3002;</li><li>b.com &#x5411; a.com &#x53D1;&#x9001;&#x4E86;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF1A;a.com/act=xx&#x3002;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x9ED8;&#x8BA4;&#x643A;&#x5E26;a.com&#x7684;Cookie&#x3002;</li><li>a.com&#x63A5;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x5BF9;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x786E;&#x8BA4;&#x662F;&#x53D7;&#x5BB3;&#x8005;&#x7684;&#x51ED;&#x8BC1;&#xFF0C;&#x8BEF;&#x4EE5;&#x4E3A;&#x662F;&#x53D7;&#x5BB3;&#x8005;&#x81EA;&#x5DF1;&#x53D1;&#x9001;&#x7684;&#x8BF7;&#x6C42;&#x3002;</li><li>a.com&#x4EE5;&#x53D7;&#x5BB3;&#x8005;&#x7684;&#x540D;&#x4E49;&#x6267;&#x884C;&#x4E86;act=xx&#x3002;</li><li>&#x653B;&#x51FB;&#x5B8C;&#x6210;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x5728;&#x53D7;&#x5BB3;&#x8005;&#x4E0D;&#x77E5;&#x60C5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5192;&#x5145;&#x53D7;&#x5BB3;&#x8005;&#xFF0C;&#x8BA9;a.com&#x6267;&#x884C;&#x4E86;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x64CD;&#x4F5C;&#x3002;</li></ul><h4>&#x51E0;&#x79CD;&#x5E38;&#x89C1;&#x7684;&#x653B;&#x51FB;&#x7C7B;&#x578B;</h4><ul><li>GET&#x7C7B;&#x578B;&#x7684;CSRF</li></ul><p>GET&#x7C7B;&#x578B;&#x7684;CSRF&#x5229;&#x7528;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x8FD9;&#x6837;&#x5229;&#x7528;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" &lt;img src=&quot;http://bank.example/withdraw?amount=10000&amp;for=hacker&quot; &gt; " title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html" style="word-break:break-word;white-space:initial"> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://bank.example/withdraw?amount=10000&amp;for=hacker&quot;</span> &gt;</span> </code></pre><p>&#x5728;&#x53D7;&#x5BB3;&#x8005;&#x8BBF;&#x95EE;&#x542B;&#x6709;&#x8FD9;&#x4E2A;img&#x7684;&#x9875;&#x9762;&#x540E;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x81EA;&#x52A8;&#x5411;<code>http://bank.example/withdraw?account=xiaoming&amp;amount=10000&amp;for=hacker</code>&#x53D1;&#x51FA;&#x4E00;&#x6B21;HTTP&#x8BF7;&#x6C42;&#x3002;bank.example&#x5C31;&#x4F1A;&#x6536;&#x5230;&#x5305;&#x542B;&#x53D7;&#x5BB3;&#x8005;&#x767B;&#x5F55;&#x4FE1;&#x606F;&#x7684;&#x4E00;&#x6B21;&#x8DE8;&#x57DF;&#x8BF7;&#x6C42;&#x3002;</p><ul><li>POST&#x7C7B;&#x578B;&#x7684;CSRF</li></ul><p>&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;CSRF&#x5229;&#x7528;&#x8D77;&#x6765;&#x901A;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x7684;&#x8868;&#x5355;&#xFF0C;&#x5982;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" &lt;form action=&quot;http://bank.example/withdraw&quot; method=POST&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;account&quot; value=&quot;xiaoming&quot; /&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;amount&quot; value=&quot;10000&quot; /&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;for&quot; value=&quot;hacker&quot; /&gt;
&lt;/form&gt;
&lt;script&gt; document.forms[0].submit(); &lt;/script&gt; " title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html"> <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://bank.example/withdraw&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">POST</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;account&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;xiaoming&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;amount&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10000&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;for&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;hacker&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"> <span class="hljs-built_in">document</span>.forms[<span class="hljs-number">0</span>].submit(); </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> </code></pre><p>&#x8BBF;&#x95EE;&#x8BE5;&#x9875;&#x9762;&#x540E;&#xFF0C;&#x8868;&#x5355;&#x4F1A;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x6A21;&#x62DF;&#x7528;&#x6237;&#x5B8C;&#x6210;&#x4E86;&#x4E00;&#x6B21;POST&#x64CD;&#x4F5C;&#x3002;</p><p>POST&#x7C7B;&#x578B;&#x7684;&#x653B;&#x51FB;&#x901A;&#x5E38;&#x6BD4;GET&#x8981;&#x6C42;&#x66F4;&#x52A0;&#x4E25;&#x683C;&#x4E00;&#x70B9;&#xFF0C;&#x4F46;&#x4ECD;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#x3002;&#x4EFB;&#x4F55;&#x4E2A;&#x4EBA;&#x7F51;&#x7AD9;&#x3001;&#x535A;&#x5BA2;&#xFF0C;&#x88AB;&#x9ED1;&#x5BA2;&#x4E0A;&#x4F20;&#x9875;&#x9762;&#x7684;&#x7F51;&#x7AD9;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x53D1;&#x8D77;&#x653B;&#x51FB;&#x7684;&#x6765;&#x6E90;&#xFF0C;&#x540E;&#x7AEF;&#x63A5;&#x53E3;&#x4E0D;&#x80FD;&#x5C06;&#x5B89;&#x5168;&#x5BC4;&#x6258;&#x5728;&#x4EC5;&#x5141;&#x8BB8;POST&#x4E0A;&#x9762;&#x3002;</p><ul><li>&#x94FE;&#x63A5;&#x7C7B;&#x578B;&#x7684;CSRF</li></ul><p>&#x94FE;&#x63A5;&#x7C7B;&#x578B;&#x7684;CSRF&#x5E76;&#x4E0D;&#x5E38;&#x89C1;&#xFF0C;&#x6BD4;&#x8D77;&#x5176;&#x4ED6;&#x4E24;&#x79CD;&#x7528;&#x6237;&#x6253;&#x5F00;&#x9875;&#x9762;&#x5C31;&#x4E2D;&#x62DB;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x79CD;&#x9700;&#x8981;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x94FE;&#x63A5;&#x624D;&#x4F1A;&#x89E6;&#x53D1;&#x3002;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x901A;&#x5E38;&#x662F;&#x5728;&#x8BBA;&#x575B;&#x4E2D;&#x53D1;&#x5E03;&#x7684;&#x56FE;&#x7247;&#x4E2D;&#x5D4C;&#x5165;&#x6076;&#x610F;&#x94FE;&#x63A5;&#xFF0C;&#x6216;&#x8005;&#x4EE5;&#x5E7F;&#x544A;&#x7684;&#x5F62;&#x5F0F;&#x8BF1;&#x5BFC;&#x7528;&#x6237;&#x4E2D;&#x62DB;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x901A;&#x5E38;&#x4F1A;&#x4EE5;&#x6BD4;&#x8F83;&#x5938;&#x5F20;&#x7684;&#x8BCD;&#x8BED;&#x8BF1;&#x9A97;&#x7528;&#x6237;&#x70B9;&#x51FB;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="  &lt;a href=&quot;http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker&quot; taget=&quot;_blank&quot;&gt;
  &#x91CD;&#x78C5;&#x6D88;&#x606F;&#xFF01;&#xFF01;
  &lt;a/&gt;" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html">  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker&quot;</span> <span class="hljs-attr">taget</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>
  &#x91CD;&#x78C5;&#x6D88;&#x606F;&#xFF01;&#xFF01;
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span>/&gt;</span></code></pre><p>&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x7528;&#x6237;&#x767B;&#x5F55;&#x4E86;&#x4FE1;&#x4EFB;&#x7684;&#x7F51;&#x7AD9;A&#xFF0C;&#x5E76;&#x4E14;&#x4FDD;&#x5B58;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF0C;&#x53EA;&#x8981;&#x7528;&#x6237;&#x4E3B;&#x52A8;&#x8BBF;&#x95EE;&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x4E2A;PHP&#x9875;&#x9762;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x653B;&#x51FB;&#x6210;&#x529F;&#x3002;</p><h4>CSRF&#x7684;&#x7279;&#x70B9;</h4><ul><li>&#x653B;&#x51FB;&#x4E00;&#x822C;&#x53D1;&#x8D77;&#x5728;&#x7B2C;&#x4E09;&#x65B9;&#x7F51;&#x7AD9;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x88AB;&#x653B;&#x51FB;&#x7684;&#x7F51;&#x7AD9;&#x3002;&#x88AB;&#x653B;&#x51FB;&#x7684;&#x7F51;&#x7AD9;&#x65E0;&#x6CD5;&#x9632;&#x6B62;&#x653B;&#x51FB;&#x53D1;&#x751F;&#x3002;</li><li>&#x653B;&#x51FB;&#x5229;&#x7528;&#x53D7;&#x5BB3;&#x8005;&#x5728;&#x88AB;&#x653B;&#x51FB;&#x7F51;&#x7AD9;&#x7684;&#x767B;&#x5F55;&#x51ED;&#x8BC1;&#xFF0C;&#x5192;&#x5145;&#x53D7;&#x5BB3;&#x8005;&#x63D0;&#x4EA4;&#x64CD;&#x4F5C;&#xFF1B;&#x800C;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x7A83;&#x53D6;&#x6570;&#x636E;&#x3002;</li><li>&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x653B;&#x51FB;&#x8005;&#x5E76;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x53D7;&#x5BB3;&#x8005;&#x7684;&#x767B;&#x5F55;&#x51ED;&#x8BC1;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x201C;&#x5192;&#x7528;&#x201D;&#x3002;</li><li>&#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x7528;&#x5404;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;&#x56FE;&#x7247;URL&#x3001;&#x8D85;&#x94FE;&#x63A5;&#x3001;CORS&#x3001;Form&#x63D0;&#x4EA4;&#x7B49;&#x7B49;&#x3002;&#x90E8;&#x5206;&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5D4C;&#x5165;&#x5728;&#x7B2C;&#x4E09;&#x65B9;&#x8BBA;&#x575B;&#x3001;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x96BE;&#x4EE5;&#x8FDB;&#x884C;&#x8FFD;&#x8E2A;&#x3002;</li></ul><p>CSRF&#x901A;&#x5E38;&#x662F;&#x8DE8;&#x57DF;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5916;&#x57DF;&#x901A;&#x5E38;&#x66F4;&#x5BB9;&#x6613;&#x88AB;&#x653B;&#x51FB;&#x8005;&#x638C;&#x63A7;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x672C;&#x57DF;&#x4E0B;&#x6709;&#x5BB9;&#x6613;&#x88AB;&#x5229;&#x7528;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;&#x53EF;&#x4EE5;&#x53D1;&#x56FE;&#x548C;&#x94FE;&#x63A5;&#x7684;&#x8BBA;&#x575B;&#x548C;&#x8BC4;&#x8BBA;&#x533A;&#xFF0C;&#x653B;&#x51FB;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x672C;&#x57DF;&#x4E0B;&#x8FDB;&#x884C;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x79CD;&#x653B;&#x51FB;&#x66F4;&#x52A0;&#x5371;&#x9669;&#x3002;</p><h3 id="articleHeader4">&#x9632;&#x62A4;&#x7B56;&#x7565;</h3><p>CSRF&#x901A;&#x5E38;&#x4ECE;&#x7B2C;&#x4E09;&#x65B9;&#x7F51;&#x7AD9;&#x53D1;&#x8D77;&#xFF0C;&#x88AB;&#x653B;&#x51FB;&#x7684;&#x7F51;&#x7AD9;&#x65E0;&#x6CD5;&#x9632;&#x6B62;&#x653B;&#x51FB;&#x53D1;&#x751F;&#xFF0C;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x589E;&#x5F3A;&#x81EA;&#x5DF1;&#x7F51;&#x7AD9;&#x9488;&#x5BF9;CSRF&#x7684;&#x9632;&#x62A4;&#x80FD;&#x529B;&#x6765;&#x63D0;&#x5347;&#x5B89;&#x5168;&#x6027;&#x3002;</p><p>&#x4E0A;&#x6587;&#x4E2D;&#x8BB2;&#x4E86;CSRF&#x7684;&#x4E24;&#x4E2A;&#x7279;&#x70B9;&#xFF1A;</p><ul><li>CSRF&#xFF08;&#x901A;&#x5E38;&#xFF09;&#x53D1;&#x751F;&#x5728;&#x7B2C;&#x4E09;&#x65B9;&#x57DF;&#x540D;&#x3002;</li><li>CSRF&#x653B;&#x51FB;&#x8005;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x5230;Cookie&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x53EA;&#x662F;&#x4F7F;&#x7528;&#x3002;</li></ul><p>&#x9488;&#x5BF9;&#x8FD9;&#x4E24;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E13;&#x95E8;&#x5236;&#x5B9A;&#x9632;&#x62A4;&#x7B56;&#x7565;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p><ul><li><p>&#x963B;&#x6B62;&#x4E0D;&#x660E;&#x5916;&#x57DF;&#x7684;&#x8BBF;&#x95EE;</p><ul><li>&#x540C;&#x6E90;&#x68C0;&#x6D4B;</li><li>Samesite Cookie</li></ul></li><li><p>&#x63D0;&#x4EA4;&#x65F6;&#x8981;&#x6C42;&#x9644;&#x52A0;&#x672C;&#x57DF;&#x624D;&#x80FD;&#x83B7;&#x53D6;&#x7684;&#x4FE1;&#x606F;</p><ul><li>CSRF Token</li><li>&#x53CC;&#x91CD;Cookie&#x9A8C;&#x8BC1;</li></ul></li></ul><p>&#x4EE5;&#x4E0B;&#x6211;&#x4EEC;&#x5BF9;&#x5404;&#x79CD;&#x9632;&#x62A4;&#x65B9;&#x6CD5;&#x505A;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#xFF1A;</p><h4>&#x540C;&#x6E90;&#x68C0;&#x6D4B;</h4><p>&#x65E2;&#x7136;CSRF&#x5927;&#x591A;&#x6765;&#x81EA;&#x7B2C;&#x4E09;&#x65B9;&#x7F51;&#x7AD9;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x76F4;&#x63A5;&#x7981;&#x6B62;&#x5916;&#x57DF;&#xFF08;&#x6216;&#x8005;&#x4E0D;&#x53D7;&#x4FE1;&#x4EFB;&#x7684;&#x57DF;&#x540D;&#xFF09;&#x5BF9;&#x6211;&#x4EEC;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x3002;</p><p>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x6765;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x6765;&#x81EA;&#x5916;&#x57DF;&#x5462;&#xFF1F;</p><p>&#x5728;HTTP&#x534F;&#x8BAE;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x643A;&#x5E26;&#x4E24;&#x4E2A;Header&#xFF0C;&#x7528;&#x4E8E;&#x6807;&#x8BB0;&#x6765;&#x6E90;&#x57DF;&#x540D;&#xFF1A;</p><ul><li>Origin Header</li><li>Referer Header</li></ul><p>&#x8FD9;&#x4E24;&#x4E2A;Header&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4F1A;&#x81EA;&#x52A8;&#x5E26;&#x4E0A;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x80FD;&#x7531;&#x524D;&#x7AEF;&#x81EA;&#x5B9A;&#x4E49;&#x5185;&#x5BB9;&#x3002;<br>&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x89E3;&#x6790;&#x8FD9;&#x4E24;&#x4E2A;Header&#x4E2D;&#x7684;&#x57DF;&#x540D;&#xFF0C;&#x786E;&#x5B9A;&#x8BF7;&#x6C42;&#x7684;&#x6765;&#x6E90;&#x57DF;&#x3002;</p><h5>&#x4F7F;&#x7528;Origin Header&#x786E;&#x5B9A;&#x6765;&#x6E90;&#x57DF;&#x540D;</h5><p>&#x5728;&#x90E8;&#x5206;&#x4E0E;CSRF&#x6709;&#x5173;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x8BF7;&#x6C42;&#x7684;Header&#x4E2D;&#x4F1A;&#x643A;&#x5E26;Origin&#x5B57;&#x6BB5;&#x3002;&#x5B57;&#x6BB5;&#x5185;&#x5305;&#x542B;&#x8BF7;&#x6C42;&#x7684;&#x57DF;&#x540D;&#xFF08;&#x4E0D;&#x5305;&#x542B;path&#x53CA;query&#xFF09;&#x3002;</p><p>&#x5982;&#x679C;Origin&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x76F4;&#x63A5;&#x4F7F;&#x7528;Origin&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#x786E;&#x8BA4;&#x6765;&#x6E90;&#x57DF;&#x540D;&#x5C31;&#x53EF;&#x4EE5;&#x3002;</p><p>&#x4F46;&#x662F;Origin&#x5728;&#x4EE5;&#x4E0B;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5E76;&#x4E0D;&#x5B58;&#x5728;&#xFF1A;</p><ul><li><strong>IE11&#x540C;&#x6E90;&#x7B56;&#x7565;&#xFF1A;</strong> IE 11 &#x4E0D;&#x4F1A;&#x5728;&#x8DE8;&#x7AD9;CORS&#x8BF7;&#x6C42;&#x4E0A;&#x6DFB;&#x52A0;Origin&#x6807;&#x5934;&#xFF0C;Referer&#x5934;&#x5C06;&#x4ECD;&#x7136;&#x662F;&#x552F;&#x4E00;&#x7684;&#x6807;&#x8BC6;&#x3002;&#x6700;&#x6839;&#x672C;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A;IE 11&#x5BF9;&#x540C;&#x6E90;&#x7684;&#x5B9A;&#x4E49;&#x548C;&#x5176;&#x4ED6;&#x6D4F;&#x89C8;&#x5668;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#IE_Exceptions" rel="nofollow noreferrer" target="_blank">MDN Same-origin_policy#IE_Exceptions</a></li><li><strong>302&#x91CD;&#x5B9A;&#x5411;&#xFF1A;</strong> &#x5728;302&#x91CD;&#x5B9A;&#x5411;&#x4E4B;&#x540E;Origin&#x4E0D;&#x5305;&#x542B;&#x5728;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;Origin&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x5176;&#x4ED6;&#x6765;&#x6E90;&#x7684;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x3002;&#x5BF9;&#x4E8E;302&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x60C5;&#x51B5;&#x6765;&#x8BF4;&#x90FD;&#x662F;&#x5B9A;&#x5411;&#x5230;&#x65B0;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;URL&#xFF0C;&#x56E0;&#x6B64;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x60F3;&#x5C06;Origin&#x6CC4;&#x6F0F;&#x5230;&#x65B0;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;</li></ul><h5>&#x4F7F;&#x7528;Referer Header&#x786E;&#x5B9A;&#x6765;&#x6E90;&#x57DF;&#x540D;</h5><p>&#x6839;&#x636E;HTTP&#x534F;&#x8BAE;&#xFF0C;&#x5728;HTTP&#x5934;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x53EB;Referer&#xFF0C;&#x8BB0;&#x5F55;&#x4E86;&#x8BE5;HTTP&#x8BF7;&#x6C42;&#x7684;&#x6765;&#x6E90;&#x5730;&#x5740;&#x3002;<br>&#x5BF9;&#x4E8E;Ajax&#x8BF7;&#x6C42;&#xFF0C;&#x56FE;&#x7247;&#x548C;script&#x7B49;&#x8D44;&#x6E90;&#x8BF7;&#x6C42;&#xFF0C;Referer&#x4E3A;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x5730;&#x5740;&#x3002;&#x5BF9;&#x4E8E;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#xFF0C;Referer&#x4E3A;&#x6253;&#x5F00;&#x9875;&#x9762;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x7684;&#x524D;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x5730;&#x5740;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x4F7F;&#x7528;Referer&#x4E2D;&#x94FE;&#x63A5;&#x7684;Origin&#x90E8;&#x5206;&#x53EF;&#x4EE5;&#x5F97;&#x77E5;&#x8BF7;&#x6C42;&#x7684;&#x6765;&#x6E90;&#x57DF;&#x540D;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5E76;&#x975E;&#x4E07;&#x65E0;&#x4E00;&#x5931;&#xFF0C;Referer&#x7684;&#x503C;&#x662F;&#x7531;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x867D;&#x7136;HTTP&#x534F;&#x8BAE;&#x4E0A;&#x6709;&#x660E;&#x786E;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x5BF9;&#x4E8E;Referer&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x6709;&#x5DEE;&#x522B;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x6D4F;&#x89C8;&#x5668;&#x81EA;&#x8EAB;&#x6CA1;&#x6709;&#x5B89;&#x5168;&#x6F0F;&#x6D1E;&#x3002;&#x4F7F;&#x7528;&#x9A8C;&#x8BC1; Referer &#x503C;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x628A;&#x5B89;&#x5168;&#x6027;&#x90FD;&#x4F9D;&#x8D56;&#x4E8E;&#x7B2C;&#x4E09;&#x65B9;&#xFF08;&#x5373;&#x6D4F;&#x89C8;&#x5668;&#xFF09;&#x6765;&#x4FDD;&#x969C;&#xFF0C;&#x4ECE;&#x7406;&#x8BBA;&#x4E0A;&#x6765;&#x8BB2;&#xFF0C;&#x8FD9;&#x6837;&#x5E76;&#x4E0D;&#x662F;&#x5F88;&#x5B89;&#x5168;&#x3002;&#x5728;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x9690;&#x85CF;&#xFF0C;&#x751A;&#x81F3;&#x4FEE;&#x6539;&#x81EA;&#x5DF1;&#x8BF7;&#x6C42;&#x7684;Referer&#x3002;</p><p>2014&#x5E74;&#xFF0C;W3C&#x7684;Web&#x5E94;&#x7528;&#x5B89;&#x5168;&#x5DE5;&#x4F5C;&#x7EC4;&#x53D1;&#x5E03;&#x4E86;Referrer Policy&#x8349;&#x6848;&#xFF0C;&#x5BF9;&#x6D4F;&#x89C8;&#x5668;&#x8BE5;&#x5982;&#x4F55;&#x53D1;&#x9001;Referer&#x505A;&#x4E86;&#x8BE6;&#x7EC6;&#x7684;&#x89C4;&#x5B9A;&#x3002;&#x622A;&#x6B62;&#x73B0;&#x5728;&#x65B0;&#x7248;&#x6D4F;&#x89C8;&#x5668;&#x5927;&#x90E8;&#x5206;&#x5DF2;&#x7ECF;&#x652F;&#x6301;&#x4E86;&#x8FD9;&#x4EFD;&#x8349;&#x6848;&#xFF0C;&#x6211;&#x4EEC;&#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7075;&#x6D3B;&#x5730;&#x63A7;&#x5236;&#x81EA;&#x5DF1;&#x7F51;&#x7AD9;&#x7684;Referer&#x7B56;&#x7565;&#x4E86;&#x3002;&#x65B0;&#x7248;&#x7684;Referrer Policy&#x89C4;&#x5B9A;&#x4E86;&#x4E94;&#x79CD;Referer&#x7B56;&#x7565;&#xFF1A;No Referrer&#x3001;No Referrer When Downgrade&#x3001;Origin Only&#x3001;Origin When Cross-origin&#x3001;&#x548C; Unsafe URL&#x3002;&#x4E4B;&#x524D;&#x5C31;&#x5B58;&#x5728;&#x7684;&#x4E09;&#x79CD;&#x7B56;&#x7565;&#xFF1A;never&#x3001;default&#x548C;always&#xFF0C;&#x5728;&#x65B0;&#x6807;&#x51C6;&#x91CC;&#x6362;&#x4E86;&#x4E2A;&#x540D;&#x79F0;&#x3002;&#x4ED6;&#x4EEC;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x5982;&#x4E0B;&#xFF1A;</p><table><thead><tr><th align="center">&#x7B56;&#x7565;&#x540D;&#x79F0;</th><th align="center">&#x5C5E;&#x6027;&#x503C;&#xFF08;&#x65B0;&#xFF09;</th><th align="center">&#x5C5E;&#x6027;&#x503C;&#xFF08;&#x65E7;&#xFF09;</th></tr></thead><tbody><tr><td align="center">No Referrer</td><td align="center">no-Referrer</td><td align="center">never</td></tr><tr><td align="center">No Referrer When Downgrade</td><td align="center">no-Referrer-when-downgrade</td><td align="center">default</td></tr><tr><td align="center">Origin Only</td><td align="center">(same or strict) origin</td><td align="center">origin</td></tr><tr><td align="center">Origin When Cross Origin</td><td align="center">(strict) origin-when-crossorigin</td><td align="center">-</td></tr><tr><td align="center">Unsafe URL</td><td align="center">unsafe-url</td><td align="center">always</td></tr></tbody></table><p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x8868;&#x683C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x628A;Referrer Policy&#x7684;&#x7B56;&#x7565;&#x8BBE;&#x7F6E;&#x6210;same-origin&#xFF0C;&#x5BF9;&#x4E8E;&#x540C;&#x6E90;&#x7684;&#x94FE;&#x63A5;&#x548C;&#x5F15;&#x7528;&#xFF0C;&#x4F1A;&#x53D1;&#x9001;Referer&#xFF0C;referer&#x503C;&#x4E3A;Host&#x4E0D;&#x5E26;Path&#xFF1B;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x5219;&#x4E0D;&#x643A;&#x5E26;Referer&#x3002;&#x4F8B;&#x5982;&#xFF1A;<code>aaa.com</code>&#x5F15;&#x7528;<code>bbb.com</code>&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x4E0D;&#x4F1A;&#x53D1;&#x9001;Referer&#x3002;</p><p>&#x8BBE;&#x7F6E;Referrer Policy&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x4E09;&#x79CD;&#xFF1A;</p><ol><li>&#x5728;CSP&#x8BBE;&#x7F6E;</li><li>&#x9875;&#x9762;&#x5934;&#x90E8;&#x589E;&#x52A0;meta&#x6807;&#x7B7E;</li><li>a&#x6807;&#x7B7E;&#x589E;&#x52A0;referrerpolicy&#x5C5E;&#x6027;</li></ol><p>&#x4E0A;&#x9762;&#x8BF4;&#x7684;&#x8FD9;&#x4E9B;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#x9690;&#x85CF;Referer&#x3002;&#x5982;&#x679C;&#x653B;&#x51FB;&#x8005;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x8FD9;&#x6837;&#x586B;&#x5199;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" &lt;img src=&quot;http://bank.example/withdraw?amount=10000&amp;for=hacker&quot; referrerpolicy=&quot;no-referrer&quot;&gt; " title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html" style="word-break:break-word;white-space:initial"> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://bank.example/withdraw?amount=10000&amp;for=hacker&quot;</span> <span class="hljs-attr">referrerpolicy</span>=<span class="hljs-string">&quot;no-referrer&quot;</span>&gt;</span> </code></pre><p>&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x53D1;&#x8D77;&#x7684;&#x653B;&#x51FB;&#x5C06;&#x4E0D;&#x643A;&#x5E26;Referer&#x3002;</p><p>&#x53E6;&#x5916;&#x5728;&#x4EE5;&#x4E0B;&#x60C5;&#x51B5;&#x4E0B;Referer&#x6CA1;&#x6709;&#x6216;&#x8005;&#x4E0D;&#x53EF;&#x4FE1;&#xFF1A;</p><p>1.IE6&#x3001;7&#x4E0B;&#x4F7F;&#x7528;window.location.href=url&#x8FDB;&#x884C;&#x754C;&#x9762;&#x7684;&#x8DF3;&#x8F6C;&#xFF0C;&#x4F1A;&#x4E22;&#x5931;Referer&#x3002;</p><p>2.IE6&#x3001;7&#x4E0B;&#x4F7F;&#x7528;window.open&#xFF0C;&#x4E5F;&#x4F1A;&#x7F3A;&#x5931;Referer&#x3002;</p><p>3.HTTPS&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x5230;HTTP&#x9875;&#x9762;&#xFF0C;&#x6240;&#x6709;&#x6D4F;&#x89C8;&#x5668;Referer&#x90FD;&#x4E22;&#x5931;&#x3002;</p><p>4.&#x70B9;&#x51FB;Flash&#x4E0A;&#x5230;&#x8FBE;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x7684;&#x65F6;&#x5019;&#xFF0C;Referer&#x7684;&#x60C5;&#x51B5;&#x5C31;&#x6BD4;&#x8F83;&#x6742;&#x4E71;&#xFF0C;&#x4E0D;&#x592A;&#x53EF;&#x4FE1;&#x3002;</p><h5>&#x65E0;&#x6CD5;&#x786E;&#x8BA4;&#x6765;&#x6E90;&#x57DF;&#x540D;&#x60C5;&#x51B5;</h5><p>&#x5F53;Origin&#x548C;Referer&#x5934;&#x6587;&#x4EF6;&#x4E0D;&#x5B58;&#x5728;&#x65F6;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x5982;&#x679C;Origin&#x548C;Referer&#x90FD;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5EFA;&#x8BAE;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x963B;&#x6B62;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5982;&#x679C;&#x60A8;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x968F;&#x673A;CSRF Token&#xFF08;&#x53C2;&#x8003;&#x4E0B;&#x65B9;&#xFF09;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E8C;&#x6B21;&#x68C0;&#x67E5;&#x3002;</p><h5>&#x5982;&#x4F55;&#x963B;&#x6B62;&#x5916;&#x57DF;&#x8BF7;&#x6C42;</h5><p>&#x901A;&#x8FC7;Header&#x7684;&#x9A8C;&#x8BC1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x7684;&#x6765;&#x6E90;&#x57DF;&#x540D;&#xFF0C;&#x8FD9;&#x4E9B;&#x6765;&#x6E90;&#x57DF;&#x540D;&#x53EF;&#x80FD;&#x662F;&#x7F51;&#x7AD9;&#x672C;&#x57DF;&#xFF0C;&#x6216;&#x8005;&#x5B50;&#x57DF;&#x540D;&#xFF0C;&#x6216;&#x8005;&#x6709;&#x6388;&#x6743;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x57DF;&#x540D;&#xFF0C;&#x53C8;&#x6216;&#x8005;&#x6765;&#x81EA;&#x4E0D;&#x53EF;&#x4FE1;&#x7684;&#x672A;&#x77E5;&#x57DF;&#x540D;&#x3002;</p><p>&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;&#x8BF7;&#x6C42;&#x57DF;&#x540D;&#x662F;&#x5426;&#x662F;&#x6765;&#x81EA;&#x4E0D;&#x53EF;&#x4FE1;&#x7684;&#x57DF;&#x540D;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x963B;&#x6B62;&#x6389;&#x8FD9;&#x4E9B;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5C31;&#x80FD;&#x9632;&#x5FA1;CSRF&#x653B;&#x51FB;&#x4E86;&#x5417;&#xFF1F;</p><p>&#x4E14;&#x6162;&#xFF01;&#x5F53;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x662F;&#x9875;&#x9762;&#x8BF7;&#x6C42;&#xFF08;&#x6BD4;&#x5982;&#x7F51;&#x7AD9;&#x7684;&#x4E3B;&#x9875;&#xFF09;&#xFF0C;&#x800C;&#x6765;&#x6E90;&#x662F;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x7684;&#x94FE;&#x63A5;&#xFF08;&#x4F8B;&#x5982;&#x767E;&#x5EA6;&#x7684;&#x641C;&#x7D22;&#x7ED3;&#x679C;&#xFF09;&#xFF0C;&#x4E5F;&#x4F1A;&#x88AB;&#x5F53;&#x6210;&#x7591;&#x4F3C;CSRF&#x653B;&#x51FB;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x5224;&#x65AD;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x8FC7;&#x6EE4;&#x6389;&#x9875;&#x9762;&#x8BF7;&#x6C42;&#x60C5;&#x51B5;&#xFF0C;&#x901A;&#x5E38;Header&#x7B26;&#x5408;&#x4EE5;&#x4E0B;&#x60C5;&#x51B5;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="Accept: text/html
Method: GET" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="hljs oxygene"><code>Accept: text/html
<span class="hljs-function"><span class="hljs-keyword">Method</span>:</span> GET</code></pre><p>&#x4F46;&#x76F8;&#x5E94;&#x7684;&#xFF0C;&#x9875;&#x9762;&#x8BF7;&#x6C42;&#x5C31;&#x66B4;&#x9732;&#x5728;&#x4E86;CSRF&#x7684;&#x653B;&#x51FB;&#x8303;&#x56F4;&#x4E4B;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7684;&#x7F51;&#x7AD9;&#x4E2D;&#xFF0C;&#x5728;&#x9875;&#x9762;&#x7684;GET&#x8BF7;&#x6C42;&#x4E2D;&#x5BF9;&#x5F53;&#x524D;&#x7528;&#x6237;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x7684;&#x8BDD;&#xFF0C;&#x9632;&#x8303;&#x5C31;&#x5931;&#x6548;&#x4E86;&#x3002;</p><p>&#x4F8B;&#x5982;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x9875;&#x9762;&#x8BF7;&#x6C42;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="GET https://example.com/addComment?comment=XXX&amp;dest=orderId" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="hljs groovy"><code style="word-break:break-word;white-space:initial">GET <span class="hljs-string">https:</span><span class="hljs-comment">//example.com/addComment?comment=XXX&amp;dest=orderId</span></code></pre><p>&#x6CE8;&#xFF1A;&#x8FD9;&#x79CD;&#x4E25;&#x683C;&#x6765;&#x8BF4;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x5B58;&#x5728;CSRF&#x653B;&#x51FB;&#x7684;&#x98CE;&#x9669;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x6709;&#x5F88;&#x591A;&#x7F51;&#x7AD9;&#x7ECF;&#x5E38;&#x628A;&#x4E3B;&#x6587;&#x6863;GET&#x8BF7;&#x6C42;&#x6302;&#x4E0A;&#x53C2;&#x6570;&#x6765;&#x5B9E;&#x73B0;&#x4EA7;&#x54C1;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x5BF9;&#x4E8E;&#x81EA;&#x8EAB;&#x6765;&#x8BF4;&#x662F;&#x5B58;&#x5728;&#x5B89;&#x5168;&#x98CE;&#x9669;&#x7684;&#x3002;</p><p>&#x53E6;&#x5916;&#xFF0C;&#x524D;&#x9762;&#x8BF4;&#x8FC7;&#xFF0C;CSRF&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x6765;&#x81EA;&#x7B2C;&#x4E09;&#x65B9;&#x57DF;&#x540D;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x80FD;&#x6392;&#x9664;&#x672C;&#x57DF;&#x53D1;&#x8D77;&#x3002;&#x5982;&#x679C;&#x653B;&#x51FB;&#x8005;&#x6709;&#x6743;&#x9650;&#x5728;&#x672C;&#x57DF;&#x53D1;&#x5E03;&#x8BC4;&#x8BBA;&#xFF08;&#x542B;&#x94FE;&#x63A5;&#x3001;&#x56FE;&#x7247;&#x7B49;&#xFF0C;&#x7EDF;&#x79F0;UGC&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x672C;&#x57DF;&#x53D1;&#x8D77;&#x653B;&#x51FB;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x540C;&#x6E90;&#x7B56;&#x7565;&#x65E0;&#x6CD5;&#x8FBE;&#x5230;&#x9632;&#x62A4;&#x7684;&#x4F5C;&#x7528;&#x3002;</p><p>&#x7EFC;&#x4E0A;&#x6240;&#x8FF0;&#xFF1A;&#x540C;&#x6E90;&#x9A8C;&#x8BC1;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#x7684;&#x9632;&#x8303;&#x65B9;&#x6CD5;&#xFF0C;&#x80FD;&#x591F;&#x9632;&#x8303;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x7684;CSRF&#x653B;&#x51FB;&#x3002;&#x4F46;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x4E07;&#x65E0;&#x4E00;&#x5931;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x5B89;&#x5168;&#x6027;&#x8981;&#x6C42;&#x8F83;&#x9AD8;&#xFF0C;&#x6216;&#x8005;&#x6709;&#x8F83;&#x591A;&#x7528;&#x6237;&#x8F93;&#x5165;&#x5185;&#x5BB9;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x5BF9;&#x5173;&#x952E;&#x7684;&#x63A5;&#x53E3;&#x505A;&#x989D;&#x5916;&#x7684;&#x9632;&#x62A4;&#x63AA;&#x65BD;&#x3002;</p><h4>CSRF Token</h4><p>&#x524D;&#x9762;&#x8BB2;&#x5230;CSRF&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7279;&#x5F81;&#x662F;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x7A83;&#x53D6;&#x5230;&#x7528;&#x6237;&#x7684;&#x4FE1;&#x606F;&#xFF08;Cookie&#xFF0C;Header&#xFF0C;&#x7F51;&#x7AD9;&#x5185;&#x5BB9;&#x7B49;&#xFF09;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x5192;&#x7528;Cookie&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x3002;</p><p>&#x800C;CSRF&#x653B;&#x51FB;&#x4E4B;&#x6240;&#x4EE5;&#x80FD;&#x591F;&#x6210;&#x529F;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x8BEF;&#x628A;&#x653B;&#x51FB;&#x8005;&#x53D1;&#x9001;&#x7684;&#x8BF7;&#x6C42;&#x5F53;&#x6210;&#x4E86;&#x7528;&#x6237;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8981;&#x6C42;&#x6240;&#x6709;&#x7684;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x90FD;&#x643A;&#x5E26;&#x4E00;&#x4E2A;CSRF&#x653B;&#x51FB;&#x8005;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x7684;Token&#x3002;&#x670D;&#x52A1;&#x5668;&#x901A;&#x8FC7;&#x6821;&#x9A8C;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x643A;&#x5E26;&#x6B63;&#x786E;&#x7684;Token&#xFF0C;&#x6765;&#x628A;&#x6B63;&#x5E38;&#x7684;&#x8BF7;&#x6C42;&#x548C;&#x653B;&#x51FB;&#x7684;&#x8BF7;&#x6C42;&#x533A;&#x5206;&#x5F00;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x9632;&#x8303;CSRF&#x7684;&#x653B;&#x51FB;&#x3002;</p><h6>&#x539F;&#x7406;</h6><p>CSRF Token&#x7684;&#x9632;&#x62A4;&#x7B56;&#x7565;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x6B65;&#x9AA4;&#xFF1A;</p><p>1.&#x5C06;CSRF Token&#x8F93;&#x51FA;&#x5230;&#x9875;&#x9762;&#x4E2D;</p><p>&#x9996;&#x5148;&#xFF0C;&#x7528;&#x6237;&#x6253;&#x5F00;&#x9875;&#x9762;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;&#x7ED9;&#x8FD9;&#x4E2A;&#x7528;&#x6237;&#x751F;&#x6210;&#x4E00;&#x4E2A;Token&#xFF0C;&#x8BE5;Token&#x901A;&#x8FC7;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#xFF0C;&#x4E00;&#x822C;Token&#x90FD;&#x5305;&#x62EC;&#x968F;&#x673A;&#x5B57;&#x7B26;&#x4E32;&#x548C;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x7EC4;&#x5408;&#xFF0C;&#x663E;&#x7136;&#x5728;&#x63D0;&#x4EA4;&#x65F6;Token&#x4E0D;&#x80FD;&#x518D;&#x653E;&#x5728;Cookie&#x4E2D;&#x4E86;&#xFF0C;&#x5426;&#x5219;&#x53C8;&#x4F1A;&#x88AB;&#x653B;&#x51FB;&#x8005;&#x5192;&#x7528;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#x8D77;&#x89C1;Token&#x6700;&#x597D;&#x8FD8;&#x662F;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7684;Session&#x4E2D;&#xFF0C;&#x4E4B;&#x540E;&#x5728;&#x6BCF;&#x6B21;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;JS&#x904D;&#x5386;&#x6574;&#x4E2A;DOM&#x6811;&#xFF0C;&#x5BF9;&#x4E8E;DOM&#x4E2D;&#x6240;&#x6709;&#x7684;a&#x548C;form&#x6807;&#x7B7E;&#x540E;&#x52A0;&#x5165;Token&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x5927;&#x90E8;&#x5206;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x5728;&#x9875;&#x9762;&#x52A0;&#x8F7D;&#x4E4B;&#x540E;&#x52A8;&#x6001;&#x751F;&#x6210;&#x7684;HTML&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5C31;&#x6CA1;&#x6709;&#x4F5C;&#x7528;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x7A0B;&#x5E8F;&#x5458;&#x5728;&#x7F16;&#x7801;&#x65F6;&#x624B;&#x52A8;&#x6DFB;&#x52A0;Token&#x3002;</p><p>2.&#x9875;&#x9762;&#x63D0;&#x4EA4;&#x7684;&#x8BF7;&#x6C42;&#x643A;&#x5E26;&#x8FD9;&#x4E2A;Token</p><p>&#x5BF9;&#x4E8E;GET&#x8BF7;&#x6C42;&#xFF0C;Token&#x5C06;&#x9644;&#x5728;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x4E4B;&#x540E;&#xFF0C;&#x8FD9;&#x6837;URL &#x5C31;&#x53D8;&#x6210; <a href="http://url?csrftoken=tokenvalue" rel="nofollow noreferrer" target="_blank">http://url?csrftoken=tokenvalue</a>&#x3002; &#x800C;&#x5BF9;&#x4E8E; POST &#x8BF7;&#x6C42;&#x6765;&#x8BF4;&#xFF0C;&#x8981;&#x5728; form &#x7684;&#x6700;&#x540E;&#x52A0;&#x4E0A;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" &lt;input type=&#x201D;hidden&#x201D; name=&#x201D;csrftoken&#x201D; value=&#x201D;tokenvalue&#x201D;/&gt;" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html" style="word-break:break-word;white-space:initial"> <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x201D;hidden&#x201D;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x201D;csrftoken&#x201D;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x201D;tokenvalue&#x201D;/</span>&gt;</span></code></pre><p>&#x8FD9;&#x6837;&#xFF0C;&#x5C31;&#x628A;Token&#x4EE5;&#x53C2;&#x6570;&#x7684;&#x5F62;&#x5F0F;&#x52A0;&#x5165;&#x8BF7;&#x6C42;&#x4E86;&#x3002;</p><p>3.&#x670D;&#x52A1;&#x5668;&#x9A8C;&#x8BC1;Token&#x662F;&#x5426;&#x6B63;&#x786E;</p><p>&#x5F53;&#x7528;&#x6237;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x5F97;&#x5230;&#x4E86;Token&#xFF0C;&#x518D;&#x6B21;&#x63D0;&#x4EA4;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;&#x5224;&#x65AD;Token&#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x9A8C;&#x8BC1;&#x8FC7;&#x7A0B;&#x662F;&#x5148;&#x89E3;&#x5BC6;Token&#xFF0C;&#x5BF9;&#x6BD4;&#x52A0;&#x5BC6;&#x5B57;&#x7B26;&#x4E32;&#x4EE5;&#x53CA;&#x65F6;&#x95F4;&#x6233;&#xFF0C;&#x5982;&#x679C;&#x52A0;&#x5BC6;&#x5B57;&#x7B26;&#x4E32;&#x4E00;&#x81F4;&#x4E14;&#x65F6;&#x95F4;&#x672A;&#x8FC7;&#x671F;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;Token&#x5C31;&#x662F;&#x6709;&#x6548;&#x7684;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x8981;&#x6BD4;&#x4E4B;&#x524D;&#x68C0;&#x67E5;Referer&#x6216;&#x8005;Origin&#x8981;&#x5B89;&#x5168;&#x4E00;&#x4E9B;&#xFF0C;Token&#x53EF;&#x4EE5;&#x5728;&#x4EA7;&#x751F;&#x5E76;&#x653E;&#x4E8E;Session&#x4E4B;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x65F6;&#x628A;Token&#x4ECE;Session&#x4E2D;&#x62FF;&#x51FA;&#xFF0C;&#x4E0E;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;Token&#x8FDB;&#x884C;&#x6BD4;&#x5BF9;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x5728;&#x4E8E;&#x5982;&#x4F55;&#x628A;Token&#x4EE5;&#x53C2;&#x6570;&#x7684;&#x5F62;&#x5F0F;&#x52A0;&#x5165;&#x8BF7;&#x6C42;&#x3002;<br>&#x4E0B;&#x9762;&#x5C06;&#x4EE5;Java&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;CSRF Token&#x7684;&#x670D;&#x52A1;&#x7AEF;&#x6821;&#x9A8C;&#x903B;&#x8F91;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="HttpServletRequest req = (HttpServletRequest)request; 
HttpSession s = req.getSession(); 
 
// &#x4ECE; session &#x4E2D;&#x5F97;&#x5230; csrftoken &#x5C5E;&#x6027;
String sToken = (String)s.getAttribute(&#x201C;csrftoken&#x201D;); 
if(sToken == null){ 
   // &#x4EA7;&#x751F;&#x65B0;&#x7684; token &#x653E;&#x5165; session &#x4E2D;
   sToken = generateToken(); 
   s.setAttribute(&#x201C;csrftoken&#x201D;,sToken); 
   chain.doFilter(request, response); 
} else{ 
   // &#x4ECE; HTTP &#x5934;&#x4E2D;&#x53D6;&#x5F97; csrftoken 
   String xhrToken = req.getHeader(&#x201C;csrftoken&#x201D;); 
   // &#x4ECE;&#x8BF7;&#x6C42;&#x53C2;&#x6570;&#x4E2D;&#x53D6;&#x5F97; csrftoken 
   String pToken = req.getParameter(&#x201C;csrftoken&#x201D;); 
   if(sToken != null &amp;&amp; xhrToken != null &amp;&amp; sToken.equals(xhrToken)){ 
       chain.doFilter(request, response); 
   }else if(sToken != null &amp;&amp; pToken != null &amp;&amp; sToken.equals(pToken)){ 
       chain.doFilter(request, response); 
   }else{ 
       request.getRequestDispatcher(&#x201C;error.jsp&#x201D;).forward(request,response); 
   } 
}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="java hljs"><code class="java">HttpServletRequest req = (HttpServletRequest)request; 
HttpSession s = req.getSession(); 
 
<span class="hljs-comment">// &#x4ECE; session &#x4E2D;&#x5F97;&#x5230; csrftoken &#x5C5E;&#x6027;</span>
String sToken = (String)s.getAttribute(&#x201C;csrftoken&#x201D;); 
<span class="hljs-keyword">if</span>(sToken == <span class="hljs-keyword">null</span>){ 
   <span class="hljs-comment">// &#x4EA7;&#x751F;&#x65B0;&#x7684; token &#x653E;&#x5165; session &#x4E2D;</span>
   sToken = generateToken(); 
   s.setAttribute(&#x201C;csrftoken&#x201D;,sToken); 
   chain.doFilter(request, response); 
} <span class="hljs-keyword">else</span>{ 
   <span class="hljs-comment">// &#x4ECE; HTTP &#x5934;&#x4E2D;&#x53D6;&#x5F97; csrftoken </span>
   String xhrToken = req.getHeader(&#x201C;csrftoken&#x201D;); 
   <span class="hljs-comment">// &#x4ECE;&#x8BF7;&#x6C42;&#x53C2;&#x6570;&#x4E2D;&#x53D6;&#x5F97; csrftoken </span>
   String pToken = req.getParameter(&#x201C;csrftoken&#x201D;); 
   <span class="hljs-keyword">if</span>(sToken != <span class="hljs-keyword">null</span> &amp;&amp; xhrToken != <span class="hljs-keyword">null</span> &amp;&amp; sToken.equals(xhrToken)){ 
       chain.doFilter(request, response); 
   }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(sToken != <span class="hljs-keyword">null</span> &amp;&amp; pToken != <span class="hljs-keyword">null</span> &amp;&amp; sToken.equals(pToken)){ 
       chain.doFilter(request, response); 
   }<span class="hljs-keyword">else</span>{ 
       request.getRequestDispatcher(&#x201C;error.jsp&#x201D;).forward(request,response); 
   } 
}</code></pre><p>&#x4EE3;&#x7801;&#x6E90;&#x81EA;<a href="https://www.ibm.com/developerworks/cn/web/1102_niugang_csrf/" rel="nofollow noreferrer" target="_blank">IBM developerworks CSRF</a></p><p>&#x8FD9;&#x4E2A;Token&#x7684;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x968F;&#x673A;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x5B83;&#x5C31;&#x4E0D;&#x4F1A;&#x88AB;&#x653B;&#x51FB;&#x8005;&#x731C;&#x5230;&#xFF0C;&#x8003;&#x8651;&#x5229;&#x7528;Java&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;java.security.SecureRandom&#x7C7B;&#x6765;&#x751F;&#x6210;&#x8DB3;&#x591F;&#x957F;&#x7684;&#x968F;&#x673A;&#x6807;&#x8BB0;&#xFF0C;&#x66FF;&#x4EE3;&#x751F;&#x6210;&#x7B97;&#x6CD5;&#x5305;&#x62EC;&#x4F7F;&#x7528;256&#x4F4D;BASE64&#x7F16;&#x7801;&#x54C8;&#x5E0C;&#xFF0C;&#x9009;&#x62E9;&#x8FD9;&#x79CD;&#x751F;&#x6210;&#x7B97;&#x6CD5;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5FC5;&#x987B;&#x786E;&#x4FDD;&#x5728;&#x6563;&#x5217;&#x6570;&#x636E;&#x4E2D;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x6027;&#x548C;&#x552F;&#x4E00;&#x6027;&#x6765;&#x751F;&#x6210;&#x968F;&#x673A;&#x6807;&#x8BC6;&#x3002;&#x901A;&#x5E38;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EA;&#x9700;&#x4E3A;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x751F;&#x6210;&#x4E00;&#x6B21;Token&#x3002;&#x5728;&#x521D;&#x59CB;&#x751F;&#x6210;&#x6B64;Token&#x4E4B;&#x540E;&#xFF0C;&#x8BE5;&#x503C;&#x5C06;&#x5B58;&#x50A8;&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#xFF0C;&#x5E76;&#x7528;&#x4E8E;&#x6BCF;&#x4E2A;&#x540E;&#x7EED;&#x8BF7;&#x6C42;&#xFF0C;&#x76F4;&#x5230;&#x4F1A;&#x8BDD;&#x8FC7;&#x671F;&#x3002;&#x5F53;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x53D1;&#x51FA;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5FC5;&#x987B;&#x9A8C;&#x8BC1;&#x8BF7;&#x6C42;&#x4E2D;Token&#x7684;&#x5B58;&#x5728;&#x6027;&#x548C;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x4E0E;&#x4F1A;&#x8BDD;&#x4E2D;&#x627E;&#x5230;&#x7684;Token&#x76F8;&#x6BD4;&#x8F83;&#x3002;&#x5982;&#x679C;&#x5728;&#x8BF7;&#x6C42;&#x4E2D;&#x627E;&#x4E0D;&#x5230;Token&#xFF0C;&#x6216;&#x8005;&#x63D0;&#x4F9B;&#x7684;&#x503C;&#x4E0E;&#x4F1A;&#x8BDD;&#x4E2D;&#x7684;&#x503C;&#x4E0D;&#x5339;&#x914D;&#xFF0C;&#x5219;&#x5E94;&#x4E2D;&#x6B62;&#x8BF7;&#x6C42;&#xFF0C;&#x5E94;&#x91CD;&#x7F6E;Token&#x5E76;&#x5C06;&#x4E8B;&#x4EF6;&#x8BB0;&#x5F55;&#x4E3A;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x7684;&#x6F5C;&#x5728;CSRF&#x653B;&#x51FB;&#x3002;</p><h4>&#x5206;&#x5E03;&#x5F0F;&#x6821;&#x9A8C;</h4><p>&#x5728;&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;Session&#x5B58;&#x50A8;CSRF Token&#x4F1A;&#x5E26;&#x6765;&#x5F88;&#x5927;&#x7684;&#x538B;&#x529B;&#x3002;&#x8BBF;&#x95EE;&#x5355;&#x53F0;&#x670D;&#x52A1;&#x5668;session&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x3002;&#x4F46;&#x662F;&#x73B0;&#x5728;&#x7684;&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x5668;&#x901A;&#x5E38;&#x4E0D;&#x6B62;&#x4E00;&#x53F0;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x51E0;&#x5341;&#x53F0;&#x751A;&#x81F3;&#x51E0;&#x767E;&#x53F0;&#x4E4B;&#x591A;&#xFF0C;&#x751A;&#x81F3;&#x591A;&#x4E2A;&#x673A;&#x623F;&#x90FD;&#x53EF;&#x80FD;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x7701;&#x4EFD;&#xFF0C;&#x7528;&#x6237;&#x53D1;&#x8D77;&#x7684;HTTP&#x8BF7;&#x6C42;&#x901A;&#x5E38;&#x8981;&#x7ECF;&#x8FC7;&#x50CF;Ngnix&#x4E4B;&#x7C7B;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x8DEF;&#x7531;&#x5230;&#x5177;&#x4F53;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x7531;&#x4E8E;Session&#x9ED8;&#x8BA4;&#x5B58;&#x50A8;&#x5728;&#x5355;&#x673A;&#x670D;&#x52A1;&#x5668;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x73AF;&#x5883;&#x4E0B;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x53D1;&#x9001;&#x7684;&#x591A;&#x6B21;HTTP&#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x4F1A;&#x5148;&#x540E;&#x843D;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x5BFC;&#x81F4;&#x540E;&#x9762;&#x53D1;&#x8D77;&#x7684;HTTP&#x8BF7;&#x6C42;&#x65E0;&#x6CD5;&#x62FF;&#x5230;&#x4E4B;&#x524D;&#x7684;HTTP&#x8BF7;&#x6C42;&#x5B58;&#x50A8;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x7684;Session&#x6570;&#x636E;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5F97;Session&#x673A;&#x5236;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x73AF;&#x5883;&#x4E0B;&#x5931;&#x6548;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x96C6;&#x7FA4;&#x4E2D;CSRF Token&#x9700;&#x8981;&#x5B58;&#x50A8;&#x5728;Redis&#x4E4B;&#x7C7B;&#x7684;&#x516C;&#x5171;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x3002;</p><p>&#x7531;&#x4E8E;&#x4F7F;&#x7528;Session&#x5B58;&#x50A8;&#xFF0C;&#x8BFB;&#x53D6;&#x548C;&#x9A8C;&#x8BC1;CSRF Token&#x4F1A;&#x5F15;&#x8D77;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x548C;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;&#x76EE;&#x524D;&#x5F88;&#x591A;&#x7F51;&#x7AD9;&#x91C7;&#x7528;Encrypted Token Pattern&#x65B9;&#x5F0F;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7684;Token&#x662F;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x975E;&#x968F;&#x673A;&#x751F;&#x6210;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x8FD9;&#x6837;&#x5728;&#x6821;&#x9A8C;&#x65F6;&#x65E0;&#x9700;&#x518D;&#x53BB;&#x8BFB;&#x53D6;&#x5B58;&#x50A8;&#x7684;Token&#xFF0C;&#x53EA;&#x7528;&#x518D;&#x6B21;&#x8BA1;&#x7B97;&#x4E00;&#x6B21;&#x5373;&#x53EF;&#x3002;</p><p>&#x8FD9;&#x79CD;Token&#x7684;&#x503C;&#x901A;&#x5E38;&#x662F;&#x4F7F;&#x7528;UserID&#x3001;&#x65F6;&#x95F4;&#x6233;&#x548C;&#x968F;&#x673A;&#x6570;&#xFF0C;&#x901A;&#x8FC7;&#x52A0;&#x5BC6;&#x7684;&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x3002;&#x8FD9;&#x6837;&#x65E2;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x5206;&#x5E03;&#x5F0F;&#x670D;&#x52A1;&#x7684;Token&#x4E00;&#x81F4;&#xFF0C;&#x53C8;&#x80FD;&#x4FDD;&#x8BC1;Token&#x4E0D;&#x5BB9;&#x6613;&#x88AB;&#x7834;&#x89E3;&#x3002;</p><p>&#x5728;token&#x89E3;&#x5BC6;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x89E3;&#x6790;&#x503C;&#xFF0C;Token&#x4E2D;&#x5305;&#x542B;&#x7684;UserID&#x548C;&#x65F6;&#x95F4;&#x6233;&#x5C06;&#x4F1A;&#x88AB;&#x62FF;&#x6765;&#x88AB;&#x9A8C;&#x8BC1;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x5C06;UserID&#x4E0E;&#x5F53;&#x524D;&#x767B;&#x5F55;&#x7684;UserID&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5E76;&#x5C06;&#x65F6;&#x95F4;&#x6233;&#x4E0E;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;</p><h5>&#x603B;&#x7ED3;</h5><p>Token&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x6709;&#x6548;&#x7684;CSRF&#x9632;&#x62A4;&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x8981;&#x9875;&#x9762;&#x6CA1;&#x6709;XSS&#x6F0F;&#x6D1E;&#x6CC4;&#x9732;Token&#xFF0C;&#x90A3;&#x4E48;&#x63A5;&#x53E3;&#x7684;CSRF&#x653B;&#x51FB;&#x5C31;&#x65E0;&#x6CD5;&#x6210;&#x529F;&#x3002;</p><p>&#x4F46;&#x662F;&#x6B64;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x9700;&#x8981;&#x7ED9;&#x6BCF;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x90FD;&#x5199;&#x5165;Token&#xFF08;&#x524D;&#x7AEF;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x7EAF;&#x9759;&#x6001;&#x9875;&#x9762;&#xFF09;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;Form&#x53CA;Ajax&#x8BF7;&#x6C42;&#x90FD;&#x643A;&#x5E26;&#x8FD9;&#x4E2A;Token&#xFF0C;&#x540E;&#x7AEF;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x90FD;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;&#x5E76;&#x4FDD;&#x8BC1;&#x9875;&#x9762;Token&#x53CA;&#x8BF7;&#x6C42;Token&#x4E00;&#x81F4;&#x3002;&#x8FD9;&#x5C31;&#x4F7F;&#x5F97;&#x8FD9;&#x4E2A;&#x9632;&#x62A4;&#x7B56;&#x7565;&#x4E0D;&#x80FD;&#x5728;&#x901A;&#x7528;&#x7684;&#x62E6;&#x622A;&#x4E0A;&#x7EDF;&#x4E00;&#x62E6;&#x622A;&#x5904;&#x7406;&#xFF0C;&#x800C;&#x9700;&#x8981;&#x6BCF;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x548C;&#x63A5;&#x53E3;&#x90FD;&#x6DFB;&#x52A0;&#x5BF9;&#x5E94;&#x7684;&#x8F93;&#x51FA;&#x548C;&#x6821;&#x9A8C;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5DE5;&#x4F5C;&#x91CF;&#x5DE8;&#x5927;&#xFF0C;&#x4E14;&#x6709;&#x53EF;&#x80FD;&#x9057;&#x6F0F;&#x3002;</p><blockquote>&#x9A8C;&#x8BC1;&#x7801;&#x548C;&#x5BC6;&#x7801;&#x5176;&#x5B9E;&#x4E5F;&#x53EF;&#x4EE5;&#x8D77;&#x5230;CSRF Token&#x7684;&#x4F5C;&#x7528;&#x54E6;&#xFF0C;&#x800C;&#x4E14;&#x66F4;&#x5B89;&#x5168;&#x3002;<p>&#x4E3A;&#x4EC0;&#x4E48;&#x5F88;&#x591A;&#x94F6;&#x884C;&#x7B49;&#x7F51;&#x7AD9;&#x4F1A;&#x8981;&#x6C42;&#x5DF2;&#x7ECF;&#x767B;&#x5F55;&#x7684;&#x7528;&#x6237;&#x5728;&#x8F6C;&#x8D26;&#x65F6;&#x518D;&#x6B21;&#x8F93;&#x5165;&#x5BC6;&#x7801;&#xFF0C;&#x73B0;&#x5728;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x4E00;&#x5B9A;&#x9053;&#x7406;&#x4E86;&#xFF1F;</p></blockquote><h4>&#x53CC;&#x91CD;Cookie&#x9A8C;&#x8BC1;</h4><p>&#x5728;&#x4F1A;&#x8BDD;&#x4E2D;&#x5B58;&#x50A8;CSRF Token&#x6BD4;&#x8F83;&#x7E41;&#x7410;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x80FD;&#x5728;&#x901A;&#x7528;&#x7684;&#x62E6;&#x622A;&#x4E0A;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#x6240;&#x6709;&#x7684;&#x63A5;&#x53E3;&#x3002;</p><p>&#x90A3;&#x4E48;&#x53E6;&#x4E00;&#x79CD;&#x9632;&#x5FA1;&#x63AA;&#x65BD;&#x662F;&#x4F7F;&#x7528;&#x53CC;&#x91CD;&#x63D0;&#x4EA4;Cookie&#x3002;&#x5229;&#x7528;CSRF&#x653B;&#x51FB;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x7528;&#x6237;Cookie&#x7684;&#x7279;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8981;&#x6C42;Ajax&#x548C;&#x8868;&#x5355;&#x8BF7;&#x6C42;&#x643A;&#x5E26;&#x4E00;&#x4E2A;Cookie&#x4E2D;&#x7684;&#x503C;&#x3002;</p><p>&#x53CC;&#x91CD;Cookie&#x91C7;&#x7528;&#x4EE5;&#x4E0B;&#x6D41;&#x7A0B;&#xFF1A;</p><ul><li>&#x5728;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x7F51;&#x7AD9;&#x9875;&#x9762;&#x65F6;&#xFF0C;&#x5411;&#x8BF7;&#x6C42;&#x57DF;&#x540D;&#x6CE8;&#x5165;&#x4E00;&#x4E2A;Cookie&#xFF0C;&#x5185;&#x5BB9;&#x4E3A;&#x968F;&#x673A;&#x5B57;&#x7B26;&#x4E32;&#xFF08;&#x4F8B;&#x5982;<code>csrfcookie=v8g9e4ksfhw</code>&#xFF09;&#x3002;</li><li>&#x5728;&#x524D;&#x7AEF;&#x5411;&#x540E;&#x7AEF;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x53D6;&#x51FA;Cookie&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x5230;URL&#x7684;&#x53C2;&#x6570;&#x4E2D;&#xFF08;&#x63A5;&#x4E0A;&#x4F8B;<code>POST https://www.a.com/comment?csrfcookie=v8g9e4ksfhw</code>&#xFF09;&#x3002;</li><li>&#x540E;&#x7AEF;&#x63A5;&#x53E3;&#x9A8C;&#x8BC1;Cookie&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#x4E0E;URL&#x53C2;&#x6570;&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#x662F;&#x5426;&#x4E00;&#x81F4;&#xFF0C;&#x4E0D;&#x4E00;&#x81F4;&#x5219;&#x62D2;&#x7EDD;&#x3002;</li></ul><p>&#x6B64;&#x65B9;&#x6CD5;&#x76F8;&#x5BF9;&#x4E8E;CSRF Token&#x5C31;&#x7B80;&#x5355;&#x4E86;&#x8BB8;&#x591A;&#x3002;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x524D;&#x540E;&#x7AEF;&#x62E6;&#x622A;&#x7684;&#x7684;&#x65B9;&#x6CD5;&#x81EA;&#x52A8;&#x5316;&#x5B9E;&#x73B0;&#x3002;&#x540E;&#x7AEF;&#x6821;&#x9A8C;&#x4E5F;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#xFF0C;&#x53EA;&#x9700;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x4E2D;&#x5B57;&#x6BB5;&#x7684;&#x5BF9;&#x6BD4;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x548C;&#x5B58;&#x50A8;Token&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x5E76;&#x6CA1;&#x6709;&#x5927;&#x89C4;&#x6A21;&#x5E94;&#x7528;&#xFF0C;&#x5176;&#x5728;&#x5927;&#x578B;&#x7F51;&#x7AD9;&#x4E0A;&#x7684;&#x5B89;&#x5168;&#x6027;&#x8FD8;&#x662F;&#x6CA1;&#x6709;CSRF Token&#x9AD8;&#xFF0C;&#x539F;&#x56E0;&#x6211;&#x4EEC;&#x4E3E;&#x4F8B;&#x8FDB;&#x884C;&#x8BF4;&#x660E;&#x3002;</p><p>&#x7531;&#x4E8E;&#x4EFB;&#x4F55;&#x8DE8;&#x57DF;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;&#x524D;&#x7AEF;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;Cookie&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#xFF08;&#x5305;&#x62EC;&#x5B50;&#x57DF;&#x540D;&#x4E4B;&#x95F4;&#xFF09;&#xFF0C;&#x4E8E;&#x662F;&#x53D1;&#x751F;&#x4E86;&#x5982;&#x4E0B;&#x60C5;&#x51B5;&#xFF1A;</p><ul><li>&#x5982;&#x679C;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x7684;&#x7F51;&#x7AD9;&#x4E3A;<code>www.a.com</code>&#xFF0C;&#x800C;&#x540E;&#x7AEF;&#x7684;api&#x57DF;&#x540D;&#x4E3A;<code>api.a.com</code>&#x3002;&#x90A3;&#x4E48;&#x5728;<code>www.a.com</code>&#x4E0B;&#xFF0C;&#x524D;&#x7AEF;&#x62FF;&#x4E0D;&#x5230;<code>api.a.com</code>&#x7684;Cookie&#xFF0C;&#x4E5F;&#x5C31;&#x65E0;&#x6CD5;&#x5B8C;&#x6210;&#x53CC;&#x91CD;Cookie&#x8BA4;&#x8BC1;&#x3002;</li><li>&#x4E8E;&#x662F;&#x8FD9;&#x4E2A;&#x8BA4;&#x8BC1;Cookie&#x5FC5;&#x987B;&#x88AB;&#x79CD;&#x5728;<code>a.com</code>&#x4E0B;&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x4E2A;&#x5B50;&#x57DF;&#x90FD;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;</li><li>&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5B50;&#x57DF;&#x90FD;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;<code>a.com</code>&#x4E0B;&#x7684;Cookie&#x3002;</li><li>&#x67D0;&#x4E2A;&#x5B50;&#x57DF;&#x540D;&#x5B58;&#x5728;&#x6F0F;&#x6D1E;&#x88AB;XSS&#x653B;&#x51FB;&#xFF08;&#x4F8B;&#x5982;<code>upload.a.com</code>&#xFF09;&#x3002;&#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x5B50;&#x57DF;&#x4E0B;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x503C;&#x5F97;&#x7A83;&#x53D6;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x4F46;&#x653B;&#x51FB;&#x8005;&#x4FEE;&#x6539;&#x4E86;<code>a.com</code>&#x4E0B;&#x7684;Cookie&#x3002;</li><li>&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x914D;&#x7F6E;&#x7684;Cookie&#xFF0C;&#x5BF9;XSS&#x4E2D;&#x62DB;&#x7684;&#x7528;&#x6237;&#x518D;&#x5411;<code>www.a.com</code>&#x4E0B;&#xFF0C;&#x53D1;&#x8D77;CSRF&#x653B;&#x51FB;&#x3002;</li></ul><h5>&#x603B;&#x7ED3;</h5><p>&#x7528;&#x53CC;&#x91CD;Cookie&#x9632;&#x5FA1;CSRF&#x7684;&#x4F18;&#x70B9;&#xFF1A;</p><ul><li>&#x65E0;&#x9700;&#x4F7F;&#x7528;Session&#xFF0C;&#x9002;&#x7528;&#x9762;&#x66F4;&#x5E7F;&#xFF0C;&#x6613;&#x4E8E;&#x5B9E;&#x65BD;&#x3002;</li><li>Token&#x50A8;&#x5B58;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x4E2D;&#xFF0C;&#x4E0D;&#x4F1A;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x5E26;&#x6765;&#x538B;&#x529B;&#x3002;</li><li>&#x76F8;&#x5BF9;&#x4E8E;Token&#xFF0C;&#x5B9E;&#x65BD;&#x6210;&#x672C;&#x66F4;&#x4F4E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x524D;&#x540E;&#x7AEF;&#x7EDF;&#x4E00;&#x62E6;&#x622A;&#x6821;&#x9A8C;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x4E2A;&#x63A5;&#x53E3;&#x548C;&#x9875;&#x9762;&#x6DFB;&#x52A0;&#x3002;</li></ul><p>&#x7F3A;&#x70B9;&#xFF1A;</p><ul><li>Cookie&#x4E2D;&#x589E;&#x52A0;&#x4E86;&#x989D;&#x5916;&#x7684;&#x5B57;&#x6BB5;&#x3002;</li><li>&#x5982;&#x679C;&#x6709;&#x5176;&#x4ED6;&#x6F0F;&#x6D1E;&#xFF08;&#x4F8B;&#x5982;XSS&#xFF09;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x6CE8;&#x5165;Cookie&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x9632;&#x5FA1;&#x65B9;&#x5F0F;&#x5931;&#x6548;&#x3002;</li><li>&#x96BE;&#x4EE5;&#x505A;&#x5230;&#x5B50;&#x57DF;&#x540D;&#x7684;&#x9694;&#x79BB;&#x3002;</li><li>&#x4E3A;&#x4E86;&#x786E;&#x4FDD;Cookie&#x4F20;&#x8F93;&#x5B89;&#x5168;&#xFF0C;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x9632;&#x5FA1;&#x65B9;&#x5F0F;&#x7684;&#x6700;&#x597D;&#x786E;&#x4FDD;&#x7528;&#x6574;&#x7AD9;HTTPS&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x5207;HTTPS&#x7684;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4E5F;&#x4F1A;&#x6709;&#x98CE;&#x9669;&#x3002;</li></ul><h4>Samesite Cookie&#x5C5E;&#x6027;</h4><p>&#x9632;&#x6B62;CSRF&#x653B;&#x51FB;&#x7684;&#x529E;&#x6CD5;&#x5DF2;&#x7ECF;&#x6709;&#x4E0A;&#x9762;&#x7684;&#x9884;&#x9632;&#x63AA;&#x65BD;&#x3002;&#x4E3A;&#x4E86;&#x4ECE;&#x6E90;&#x5934;&#x4E0A;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;Google&#x8D77;&#x8349;&#x4E86;&#x4E00;&#x4EFD;&#x8349;&#x6848;&#x6765;&#x6539;&#x8FDB;HTTP&#x534F;&#x8BAE;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x4E3A;Set-Cookie&#x54CD;&#x5E94;&#x5934;&#x65B0;&#x589E;Samesite&#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x7528;&#x6765;&#x6807;&#x660E;&#x8FD9;&#x4E2A; Cookie&#x662F;&#x4E2A;&#x201C;&#x540C;&#x7AD9; Cookie&#x201D;&#xFF0C;&#x540C;&#x7AD9;Cookie&#x53EA;&#x80FD;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E00;&#x65B9;Cookie&#xFF0C;&#x4E0D;&#x80FD;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E09;&#x65B9;Cookie&#xFF0C;Samesite &#x6709;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x503C;&#xFF0C;&#x5206;&#x522B;&#x662F; Strict &#x548C; Lax&#xFF0C;&#x4E0B;&#x9762;&#x5206;&#x522B;&#x8BB2;&#x89E3;&#xFF1A;</p><h5>Samesite=Strict</h5><p>&#x8FD9;&#x79CD;&#x79F0;&#x4E3A;&#x4E25;&#x683C;&#x6A21;&#x5F0F;&#xFF0C;&#x8868;&#x660E;&#x8FD9;&#x4E2A; Cookie &#x5728;&#x4EFB;&#x4F55;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x4E0D;&#x53EF;&#x80FD;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E09;&#x65B9; Cookie&#xFF0C;&#x7EDD;&#x65E0;&#x4F8B;&#x5916;&#x3002;&#x6BD4;&#x5982;&#x8BF4; b.com &#x8BBE;&#x7F6E;&#x4E86;&#x5982;&#x4E0B; Cookie&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="Set-Cookie: foo=1; Samesite=Strict
Set-Cookie: bar=2; Samesite=Lax
Set-Cookie: baz=3" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html">Set-Cookie: foo=1; Samesite=Strict
Set-Cookie: bar=2; Samesite=Lax
Set-Cookie: baz=3</code></pre><p>&#x6211;&#x4EEC;&#x5728; a.com &#x4E0B;&#x53D1;&#x8D77;&#x5BF9; b.com &#x7684;&#x4EFB;&#x610F;&#x8BF7;&#x6C42;&#xFF0C;foo &#x8FD9;&#x4E2A; Cookie &#x90FD;&#x4E0D;&#x4F1A;&#x88AB;&#x5305;&#x542B;&#x5728; Cookie &#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#xFF0C;&#x4F46; bar &#x4F1A;&#x3002;&#x4E3E;&#x4E2A;&#x5B9E;&#x9645;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#xFF0C;&#x5047;&#x5982;&#x6DD8;&#x5B9D;&#x7F51;&#x7AD9;&#x7528;&#x6765;&#x8BC6;&#x522B;&#x7528;&#x6237;&#x767B;&#x5F55;&#x4E0E;&#x5426;&#x7684; Cookie &#x88AB;&#x8BBE;&#x7F6E;&#x6210;&#x4E86; Samesite=Strict&#xFF0C;&#x90A3;&#x4E48;&#x7528;&#x6237;&#x4ECE;&#x767E;&#x5EA6;&#x641C;&#x7D22;&#x9875;&#x9762;&#x751A;&#x81F3;&#x5929;&#x732B;&#x9875;&#x9762;&#x7684;&#x94FE;&#x63A5;&#x70B9;&#x51FB;&#x8FDB;&#x5165;&#x6DD8;&#x5B9D;&#x540E;&#xFF0C;&#x6DD8;&#x5B9D;&#x90FD;&#x4E0D;&#x4F1A;&#x662F;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF0C;&#x56E0;&#x4E3A;&#x6DD8;&#x5B9D;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x4F1A;&#x63A5;&#x53D7;&#x5230;&#x90A3;&#x4E2A; Cookie&#xFF0C;&#x5176;&#x5B83;&#x7F51;&#x7AD9;&#x53D1;&#x8D77;&#x7684;&#x5BF9;&#x6DD8;&#x5B9D;&#x7684;&#x4EFB;&#x610F;&#x8BF7;&#x6C42;&#x90FD;&#x4E0D;&#x4F1A;&#x5E26;&#x4E0A;&#x90A3;&#x4E2A; Cookie&#x3002;</p><h5>Samesite=Lax</h5><p>&#x8FD9;&#x79CD;&#x79F0;&#x4E3A;&#x5BBD;&#x677E;&#x6A21;&#x5F0F;&#xFF0C;&#x6BD4; Strict &#x653E;&#x5BBD;&#x4E86;&#x70B9;&#x9650;&#x5236;&#xFF1A;&#x5047;&#x5982;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x662F;&#x8FD9;&#x79CD;&#x8BF7;&#x6C42;&#xFF08;&#x6539;&#x53D8;&#x4E86;&#x5F53;&#x524D;&#x9875;&#x9762;&#x6216;&#x8005;&#x6253;&#x5F00;&#x4E86;&#x65B0;&#x9875;&#x9762;&#xFF09;&#x4E14;&#x540C;&#x65F6;&#x662F;&#x4E2A;GET&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x8FD9;&#x4E2A;Cookie&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E09;&#x65B9;Cookie&#x3002;&#x6BD4;&#x5982;&#x8BF4; b.com&#x8BBE;&#x7F6E;&#x4E86;&#x5982;&#x4E0B;Cookie&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="Set-Cookie: foo=1; Samesite=Strict
Set-Cookie: bar=2; Samesite=Lax
Set-Cookie: baz=3" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html">Set-Cookie: foo=1; Samesite=Strict
Set-Cookie: bar=2; Samesite=Lax
Set-Cookie: baz=3</code></pre><p>&#x5F53;&#x7528;&#x6237;&#x4ECE; a.com &#x70B9;&#x51FB;&#x94FE;&#x63A5;&#x8FDB;&#x5165; b.com &#x65F6;&#xFF0C;foo &#x8FD9;&#x4E2A; Cookie &#x4E0D;&#x4F1A;&#x88AB;&#x5305;&#x542B;&#x5728; Cookie &#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#xFF0C;&#x4F46; bar &#x548C; baz &#x4F1A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x7528;&#x6237;&#x5728;&#x4E0D;&#x540C;&#x7F51;&#x7AD9;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x94FE;&#x63A5;&#x8DF3;&#x8F6C;&#x662F;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#x4E86;&#x3002;&#x4F46;&#x5047;&#x5982;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x662F;&#x4ECE; a.com &#x53D1;&#x8D77;&#x7684;&#x5BF9; b.com &#x7684;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#xFF0C;&#x6216;&#x8005;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x662F;&#x901A;&#x8FC7;&#x8868;&#x5355;&#x7684; post &#x63D0;&#x4EA4;&#x89E6;&#x53D1;&#x7684;&#xFF0C;&#x5219;bar&#x4E5F;&#x4E0D;&#x4F1A;&#x53D1;&#x9001;&#x3002;</p><p>&#x751F;&#x6210;Token&#x653E;&#x5230;Cookie&#x4E2D;&#x5E76;&#x4E14;&#x8BBE;&#x7F6E;Cookie&#x7684;Samesite&#xFF0C;Java&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text=" private void addTokenCookieAndHeader(HttpServletRequest httpRequest, HttpServletResponse httpResponse) {
        //&#x751F;&#x6210;token
        String sToken = this.generateToken();
        //&#x624B;&#x52A8;&#x6DFB;&#x52A0;Cookie&#x5B9E;&#x73B0;&#x652F;&#x6301;&#x201C;Samesite=strict&#x201D;
        //Cookie&#x6DFB;&#x52A0;&#x53CC;&#x91CD;&#x9A8C;&#x8BC1;
        String CookieSpec = String.format(&quot;%s=%s; Path=%s; HttpOnly; Samesite=Strict&quot;, this.determineCookieName(httpRequest), sToken, httpRequest.getRequestURI());
        httpResponse.addHeader(&quot;Set-Cookie&quot;, CookieSpec);
        httpResponse.setHeader(CSRF_TOKEN_NAME, token);
    }" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="java hljs"><code class="java"> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addTokenCookieAndHeader</span><span class="hljs-params">(HttpServletRequest httpRequest, HttpServletResponse httpResponse)</span> </span>{
        <span class="hljs-comment">//&#x751F;&#x6210;token</span>
        String sToken = <span class="hljs-keyword">this</span>.generateToken();
        <span class="hljs-comment">//&#x624B;&#x52A8;&#x6DFB;&#x52A0;Cookie&#x5B9E;&#x73B0;&#x652F;&#x6301;&#x201C;Samesite=strict&#x201D;</span>
        <span class="hljs-comment">//Cookie&#x6DFB;&#x52A0;&#x53CC;&#x91CD;&#x9A8C;&#x8BC1;</span>
        String CookieSpec = String.format(<span class="hljs-string">&quot;%s=%s; Path=%s; HttpOnly; Samesite=Strict&quot;</span>, <span class="hljs-keyword">this</span>.determineCookieName(httpRequest), sToken, httpRequest.getRequestURI());
        httpResponse.addHeader(<span class="hljs-string">&quot;Set-Cookie&quot;</span>, CookieSpec);
        httpResponse.setHeader(CSRF_TOKEN_NAME, token);
    }</code></pre><p>&#x4EE3;&#x7801;&#x6E90;&#x81EA;<a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet#Implementation_example" rel="nofollow noreferrer" target="_blank">OWASP Cross-Site_Request_Forgery #Implementation example</a></p><h5>&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x4F7F;&#x7528;SamesiteCookie</h5><p>&#x5982;&#x679C;SamesiteCookie&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;Strict&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x4EFB;&#x4F55;&#x8DE8;&#x57DF;&#x8BF7;&#x6C42;&#x4E2D;&#x90FD;&#x4E0D;&#x4F1A;&#x643A;&#x5E26;Cookie&#xFF0C;&#x65B0;&#x6807;&#x7B7E;&#x91CD;&#x65B0;&#x6253;&#x5F00;&#x4E5F;&#x4E0D;&#x643A;&#x5E26;&#xFF0C;&#x6240;&#x4EE5;&#x8BF4;CSRF&#x653B;&#x51FB;&#x57FA;&#x672C;&#x6CA1;&#x6709;&#x673A;&#x4F1A;&#x3002;</p><p>&#x4F46;&#x662F;&#x8DF3;&#x8F6C;&#x5B50;&#x57DF;&#x540D;&#x6216;&#x8005;&#x662F;&#x65B0;&#x6807;&#x7B7E;&#x91CD;&#x65B0;&#x6253;&#x5F00;&#x521A;&#x767B;&#x9646;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x4E4B;&#x524D;&#x7684;Cookie&#x90FD;&#x4E0D;&#x4F1A;&#x5B58;&#x5728;&#x3002;&#x5C24;&#x5176;&#x662F;&#x6709;&#x767B;&#x5F55;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x65B0;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x6807;&#x7B7E;&#x8FDB;&#x5165;&#xFF0C;&#x6216;&#x8005;&#x8DF3;&#x8F6C;&#x5230;&#x5B50;&#x57DF;&#x540D;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x3002;&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x6765;&#x8BB2;&#xFF0C;&#x53EF;&#x80FD;&#x4F53;&#x9A8C;&#x4E0D;&#x4F1A;&#x5F88;&#x597D;&#x3002;</p><p>&#x5982;&#x679C;SamesiteCookie&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;Lax&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x4ED6;&#x7F51;&#x7AD9;&#x901A;&#x8FC7;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x8FC7;&#x6765;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Cookie&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x969C;&#x5916;&#x57DF;&#x8FDE;&#x63A5;&#x6253;&#x5F00;&#x9875;&#x9762;&#x65F6;&#x7528;&#x6237;&#x7684;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x3002;&#x4F46;&#x76F8;&#x5E94;&#x7684;&#xFF0C;&#x5176;&#x5B89;&#x5168;&#x6027;&#x4E5F;&#x6BD4;&#x8F83;&#x4F4E;&#x3002;</p><p>&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x662F;Samesite&#x7684;&#x517C;&#x5BB9;&#x6027;&#x4E0D;&#x662F;&#x5F88;&#x597D;&#xFF0C;&#x73B0;&#x9636;&#x6BB5;&#x9664;&#x4E86;&#x4ECE;&#x65B0;&#x7248;Chrome&#x548C;Firefox&#x652F;&#x6301;&#x4EE5;&#x5916;&#xFF0C;Safari&#x4EE5;&#x53CA;iOS Safari&#x90FD;&#x8FD8;&#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x73B0;&#x9636;&#x6BB5;&#x770B;&#x6765;&#x6682;&#x65F6;&#x8FD8;&#x4E0D;&#x80FD;&#x666E;&#x53CA;&#x3002;</p><p>&#x800C;&#x4E14;&#xFF0C;SamesiteCookie&#x76EE;&#x524D;&#x6709;&#x4E00;&#x4E2A;&#x81F4;&#x547D;&#x7684;&#x7F3A;&#x9677;&#xFF1A;&#x4E0D;&#x652F;&#x6301;&#x5B50;&#x57DF;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x79CD;&#x5728;topic.a.com&#x4E0B;&#x7684;Cookie&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;a.com&#x4E0B;&#x79CD;&#x690D;&#x7684;SamesiteCookie&#x3002;&#x8FD9;&#x5C31;&#x5BFC;&#x81F4;&#x4E86;&#x5F53;&#x6211;&#x4EEC;&#x7F51;&#x7AD9;&#x6709;&#x591A;&#x4E2A;&#x5B50;&#x57DF;&#x540D;&#x65F6;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;SamesiteCookie&#x5728;&#x4E3B;&#x57DF;&#x540D;&#x5B58;&#x50A8;&#x7528;&#x6237;&#x767B;&#x5F55;&#x4FE1;&#x606F;&#x3002;&#x6BCF;&#x4E2A;&#x5B50;&#x57DF;&#x540D;&#x90FD;&#x9700;&#x8981;&#x7528;&#x6237;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x4E00;&#x6B21;&#x3002;</p><p>&#x603B;&#x4E4B;&#xFF0C;SamesiteCookie&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x66FF;&#x4EE3;&#x540C;&#x6E90;&#x9A8C;&#x8BC1;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x4F46;&#x76EE;&#x524D;&#x8FD8;&#x5E76;&#x4E0D;&#x6210;&#x719F;&#xFF0C;&#x5176;&#x5E94;&#x7528;&#x573A;&#x666F;&#x6709;&#x5F85;&#x89C2;&#x671B;&#x3002;</p><h3 id="articleHeader5">&#x9632;&#x6B62;&#x7F51;&#x7AD9;&#x88AB;&#x5229;&#x7528;</h3><p>&#x524D;&#x9762;&#x6240;&#x8BF4;&#x7684;&#xFF0C;&#x90FD;&#x662F;&#x88AB;&#x653B;&#x51FB;&#x7684;&#x7F51;&#x7AD9;&#x5982;&#x4F55;&#x505A;&#x597D;&#x9632;&#x62A4;&#x3002;&#x800C;&#x975E;&#x9632;&#x6B62;&#x653B;&#x51FB;&#x7684;&#x53D1;&#x751F;&#xFF0C;CSRF&#x7684;&#x653B;&#x51FB;&#x53EF;&#x4EE5;&#x6765;&#x81EA;&#xFF1A;</p><ul><li>&#x653B;&#x51FB;&#x8005;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7AD9;&#x3002;</li><li>&#x6709;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x6F0F;&#x6D1E;&#x7684;&#x7F51;&#x7AD9;&#x3002;</li><li>&#x7B2C;&#x4E09;&#x65B9;&#x8BBA;&#x575B;&#x7B49;&#x7528;&#x6237;&#x5185;&#x5BB9;&#x3002;</li><li>&#x88AB;&#x653B;&#x51FB;&#x7F51;&#x7AD9;&#x81EA;&#x5DF1;&#x7684;&#x8BC4;&#x8BBA;&#x529F;&#x80FD;&#x7B49;&#x3002;</li></ul><p>&#x5BF9;&#x4E8E;&#x6765;&#x81EA;&#x9ED1;&#x5BA2;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x9632;&#x62A4;&#x3002;&#x4F46;&#x5BF9;&#x5176;&#x4ED6;&#x60C5;&#x51B5;&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x9632;&#x6B62;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7AD9;&#x88AB;&#x5229;&#x7528;&#x6210;&#x4E3A;&#x653B;&#x51FB;&#x7684;&#x6E90;&#x5934;&#x5462;&#xFF1F;</p><ul><li>&#x4E25;&#x683C;&#x7BA1;&#x7406;&#x6240;&#x6709;&#x7684;&#x4E0A;&#x4F20;&#x63A5;&#x53E3;&#xFF0C;&#x9632;&#x6B62;&#x4EFB;&#x4F55;&#x9884;&#x671F;&#x4E4B;&#x5916;&#x7684;&#x4E0A;&#x4F20;&#x5185;&#x5BB9;&#xFF08;&#x4F8B;&#x5982;HTML&#xFF09;&#x3002;</li><li>&#x6DFB;&#x52A0;Header <code>X-Content-Type-Options: nosniff</code> &#x9632;&#x6B62;&#x9ED1;&#x5BA2;&#x4E0A;&#x4F20;HTML&#x5185;&#x5BB9;&#x7684;&#x8D44;&#x6E90;&#xFF08;&#x4F8B;&#x5982;&#x56FE;&#x7247;&#xFF09;&#x88AB;&#x89E3;&#x6790;&#x4E3A;&#x7F51;&#x9875;&#x3002;</li><li>&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x4E0A;&#x4F20;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x8FDB;&#x884C;&#x8F6C;&#x5B58;&#x6216;&#x8005;&#x6821;&#x9A8C;&#x3002;&#x4E0D;&#x8981;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x586B;&#x5199;&#x7684;&#x56FE;&#x7247;&#x94FE;&#x63A5;&#x3002;</li><li>&#x5F53;&#x524D;&#x7528;&#x6237;&#x6253;&#x5F00;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x586B;&#x5199;&#x7684;&#x94FE;&#x63A5;&#x65F6;&#xFF0C;&#x9700;&#x544A;&#x77E5;&#x98CE;&#x9669;&#xFF08;&#x8FD9;&#x4E5F;&#x662F;&#x5F88;&#x591A;&#x8BBA;&#x575B;&#x4E0D;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x5728;&#x5185;&#x5BB9;&#x4E2D;&#x53D1;&#x5E03;&#x5916;&#x57DF;&#x94FE;&#x63A5;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x7528;&#x6237;&#x7559;&#x5B58;&#xFF0C;&#x4E5F;&#x6709;&#x5B89;&#x5168;&#x8003;&#x8651;&#xFF09;&#x3002;</li></ul><h3 id="articleHeader6">CSRF&#x5176;&#x4ED6;&#x9632;&#x8303;&#x63AA;&#x65BD;</h3><p>&#x5BF9;&#x4E8E;&#x4E00;&#x7EBF;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x540C;&#x5B66;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5404;&#x79CD;&#x9632;&#x62A4;&#x7B56;&#x7565;&#x6765;&#x9632;&#x5FA1;CSRF&#xFF0C;&#x5BF9;&#x4E8E;QA&#x3001;SRE&#x3001;&#x5B89;&#x5168;&#x8D1F;&#x8D23;&#x4EBA;&#x7B49;&#x540C;&#x5B66;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x505A;&#x54EA;&#x4E9B;&#x4E8B;&#x60C5;&#x6765;&#x63D0;&#x5347;&#x5B89;&#x5168;&#x6027;&#x5462;&#xFF1F;</p><h4>CSRF&#x6D4B;&#x8BD5;</h4><p>CSRFTester&#x662F;&#x4E00;&#x6B3E;CSRF&#x6F0F;&#x6D1E;&#x7684;&#x6D4B;&#x8BD5;&#x5DE5;&#x5177;&#xFF0C;CSRFTester&#x5DE5;&#x5177;&#x7684;&#x6D4B;&#x8BD5;&#x539F;&#x7406;&#x5927;&#x6982;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x6293;&#x53D6;&#x6211;&#x4EEC;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x8BBF;&#x95EE;&#x8FC7;&#x7684;&#x6240;&#x6709;&#x7684;&#x8FDE;&#x63A5;&#x4EE5;&#x53CA;&#x6240;&#x6709;&#x7684;&#x8868;&#x5355;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x901A;&#x8FC7;&#x5728;CSRFTester&#x4E2D;&#x4FEE;&#x6539;&#x76F8;&#x5E94;&#x7684;&#x8868;&#x5355;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x91CD;&#x65B0;&#x63D0;&#x4EA4;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x6B21;&#x4F2A;&#x9020;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x6D4B;&#x8BD5;&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x88AB;&#x7F51;&#x7AD9;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x53D7;&#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x5B58;&#x5728;CSRF&#x6F0F;&#x6D1E;&#xFF0C;&#x5F53;&#x7136;&#x6B64;&#x6B3E;&#x5DE5;&#x5177;&#x4E5F;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x6765;&#x8FDB;&#x884C;CSRF&#x653B;&#x51FB;&#x3002;<br>CSRFTester&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5927;&#x81F4;&#x5206;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;&#xFF1A;</p><ul><li>&#x6B65;&#x9AA4;1&#xFF1A;&#x8BBE;&#x7F6E;&#x6D4F;&#x89C8;&#x5668;&#x4EE3;&#x7406;</li></ul><p>CSRFTester&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;Localhost&#x4E0A;&#x7684;&#x7AEF;&#x53E3;8008&#x4F5C;&#x4E3A;&#x5176;&#x4EE3;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x4EE3;&#x7406;&#x914D;&#x7F6E;&#x6210;&#x529F;&#xFF0C;CSRFTester&#x5C06;&#x4E3A;&#x60A8;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x751F;&#x6210;&#x7684;&#x6240;&#x6709;&#x540E;&#x7EED;HTTP&#x8BF7;&#x6C42;&#x751F;&#x6210;&#x8C03;&#x8BD5;&#x6D88;&#x606F;&#x3002;</p><ul><li>&#x6B65;&#x9AA4;2&#xFF1A;&#x4F7F;&#x7528;&#x5408;&#x6CD5;&#x8D26;&#x6237;&#x8BBF;&#x95EE;&#x7F51;&#x7AD9;&#x5F00;&#x59CB;&#x6D4B;&#x8BD5;</li></ul><p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x4E3A;CSRF&#x6D4B;&#x8BD5;&#x7684;&#x7279;&#x5B9A;&#x4E1A;&#x52A1;Web&#x9875;&#x9762;&#x3002;&#x627E;&#x5230;&#x6B64;&#x9875;&#x9762;&#x540E;&#xFF0C;&#x9009;&#x62E9;CSRFTester&#x4E2D;&#x7684;&#x201C;&#x5F00;&#x59CB;&#x5F55;&#x5236;&#x201D;&#x6309;&#x94AE;&#x5E76;&#x6267;&#x884C;&#x4E1A;&#x52A1;&#x529F;&#x80FD;&#xFF1B;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x70B9;&#x51FB;CSRFTester&#x4E2D;&#x7684;&#x201C;&#x505C;&#x6B62;&#x5F55;&#x5236;&#x201D;&#x6309;&#x94AE;&#xFF1B;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BE5;&#x8F6F;&#x4EF6;&#x4F1A;&#x5168;&#x90E8;&#x904D;&#x5386;&#x4E00;&#x904D;&#x5F53;&#x524D;&#x9875;&#x9762;&#x7684;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x3002;</p><ul><li>&#x6B65;&#x9AA4;3&#xFF1A;&#x901A;&#x8FC7;CSRF&#x4FEE;&#x6539;&#x5E76;&#x4F2A;&#x9020;&#x8BF7;&#x6C42;</li></ul><p>&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x8F6F;&#x4EF6;&#x4E0A;&#x6709;&#x4E00;&#x7CFB;&#x5217;&#x8DD1;&#x51FA;&#x6765;&#x7684;&#x8BB0;&#x5F55;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x6267;&#x884C;&#x4E1A;&#x52A1;&#x529F;&#x80FD;&#x65F6;&#x751F;&#x6210;&#x7684;&#x6240;&#x6709;GET&#x6216;&#x8005;POST&#x8BF7;&#x6C42;&#x3002;&#x901A;&#x8FC7;&#x9009;&#x62E9;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x67D0;&#x4E00;&#x884C;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x4E1A;&#x52A1;&#x529F;&#x80FD;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x5BF9;&#x5E94;&#x7684;&#x8BF7;&#x6C42;&#x4FEE;&#x6539;query&#x548C;form&#x7684;&#x53C2;&#x6570;&#x3002;&#x5F53;&#x4FEE;&#x6539;&#x5B8C;&#x6240;&#x6709;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8BF1;&#x5BFC;&#x7528;&#x6237;form&#x6700;&#x7EC8;&#x7684;&#x63D0;&#x4EA4;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5F00;&#x59CB;&#x751F;&#x6210;HTML&#x62A5;&#x544A;&#x3002;</p><ul><li>&#x6B65;&#x9AA4;4&#xFF1A;&#x62FF;&#x5230;&#x7ED3;&#x679C;&#x5982;&#x6709;&#x6F0F;&#x6D1E;&#x8FDB;&#x884C;&#x4FEE;&#x590D;</li></ul><p>&#x9996;&#x5148;&#x5FC5;&#x987B;&#x9009;&#x62E9;&#x201C;&#x62A5;&#x544A;&#x7C7B;&#x578B;&#x201D;&#x3002;&#x62A5;&#x544A;&#x7C7B;&#x578B;&#x51B3;&#x5B9A;&#x4E86;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x53D7;&#x5BB3;&#x8005;&#x6D4F;&#x89C8;&#x5668;&#x5982;&#x4F55;&#x63D0;&#x4EA4;&#x5148;&#x524D;&#x8BB0;&#x5F55;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x76EE;&#x524D;&#x6709;5&#x79CD;&#x53EF;&#x80FD;&#x7684;&#x62A5;&#x544A;&#xFF1A;&#x8868;&#x5355;&#x3001;iFrame&#x3001;IMG&#x3001;XHR&#x548C;&#x94FE;&#x63A5;&#x3002;&#x4E00;&#x65E6;&#x9009;&#x62E9;&#x4E86;&#x62A5;&#x544A;&#x7C7B;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x542F;&#x52A8;&#x65B0;&#x751F;&#x6210;&#x7684;&#x62A5;&#x544A;&#xFF0C;&#x6700;&#x540E;&#x6839;&#x636E;&#x62A5;&#x544A;&#x7684;&#x60C5;&#x51B5;&#x8FDB;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x6392;&#x67E5;&#x548C;&#x4FEE;&#x590D;&#x3002;</p><h4>CSRF&#x76D1;&#x63A7;</h4><p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x7F51;&#x7AD9;&#x7CFB;&#x7EDF;&#xFF0C;&#x67D0;&#x4E9B;&#x9879;&#x76EE;&#x3001;&#x9875;&#x9762;&#x3001;&#x63A5;&#x53E3;&#x6F0F;&#x6389;&#x4E86;CSRF&#x9632;&#x62A4;&#x63AA;&#x65BD;&#x662F;&#x5F88;&#x53EF;&#x80FD;&#x7684;&#x3002;</p><p>&#x4E00;&#x65E6;&#x53D1;&#x751F;&#x4E86;CSRF&#x653B;&#x51FB;&#xFF0C;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x53CA;&#x65F6;&#x7684;&#x53D1;&#x73B0;&#x8FD9;&#x4E9B;&#x653B;&#x51FB;&#x5462;&#xFF1F;</p><p>CSRF&#x653B;&#x51FB;&#x6709;&#x7740;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#x7684;&#x7279;&#x5F81;&#xFF1A;</p><ul><li>&#x8DE8;&#x57DF;&#x8BF7;&#x6C42;&#x3002;</li><li>GET&#x7C7B;&#x578B;&#x8BF7;&#x6C42;Header&#x7684;MIME&#x7C7B;&#x578B;&#x5927;&#x6982;&#x7387;&#x4E3A;&#x56FE;&#x7247;&#xFF0C;&#x800C;&#x5B9E;&#x9645;&#x8FD4;&#x56DE;Header&#x7684;MIME&#x7C7B;&#x578B;&#x4E3A;Text&#x3001;JSON&#x3001;HTML&#x3002;</li></ul><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x7F51;&#x7AD9;&#x7684;&#x4EE3;&#x7406;&#x5C42;&#x76D1;&#x63A7;&#x6240;&#x6709;&#x7684;&#x63A5;&#x53E3;&#x8BF7;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x7B26;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x8BF7;&#x6C42;&#x6709;CSRF&#x653B;&#x51FB;&#x5ACC;&#x7591;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x63D0;&#x9192;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#x548C;&#x9879;&#x76EE;&#x8D1F;&#x8D23;&#x4EBA;&#xFF0C;&#x68C0;&#x67E5;&#x6216;&#x8005; Review&#x5176;CSRF&#x9632;&#x62A4;&#x7B56;&#x7565;&#x3002;</p><h3 id="articleHeader7">&#x4E2A;&#x4EBA;&#x7528;&#x6237;CSRF&#x5B89;&#x5168;&#x7684;&#x5EFA;&#x8BAE;</h3><p>&#x7ECF;&#x5E38;&#x4E0A;&#x7F51;&#x7684;&#x4E2A;&#x4EBA;&#x7528;&#x6237;&#xFF0C;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5;&#x6765;&#x4FDD;&#x62A4;&#x81EA;&#x5DF1;&#xFF1A;</p><ul><li>&#x4F7F;&#x7528;&#x7F51;&#x9875;&#x7248;&#x90AE;&#x4EF6;&#x7684;&#x6D4F;&#x89C8;&#x90AE;&#x4EF6;&#x6216;&#x8005;&#x65B0;&#x95FB;&#x4E5F;&#x4F1A;&#x5E26;&#x6765;&#x989D;&#x5916;&#x7684;&#x98CE;&#x9669;&#xFF0C;&#x56E0;&#x4E3A;&#x67E5;&#x770B;&#x90AE;&#x4EF6;&#x6216;&#x8005;&#x65B0;&#x95FB;&#x6D88;&#x606F;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x6076;&#x610F;&#x4EE3;&#x7801;&#x7684;&#x653B;&#x51FB;&#x3002;</li><li>&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x6253;&#x5F00;&#x53EF;&#x7591;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x6253;&#x5F00;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x3002;</li></ul><h3 id="articleHeader8">&#x603B;&#x7ED3;</h3><p>&#x7B80;&#x5355;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x4E0A;&#x6587;&#x7684;&#x9632;&#x62A4;&#x7B56;&#x7565;&#xFF1A;</p><ul><li>CSRF&#x81EA;&#x52A8;&#x9632;&#x5FA1;&#x7B56;&#x7565;&#xFF1A;&#x540C;&#x6E90;&#x68C0;&#x6D4B;&#xFF08;Origin &#x548C; Referer &#x9A8C;&#x8BC1;&#xFF09;&#x3002;</li><li>CSRF&#x4E3B;&#x52A8;&#x9632;&#x5FA1;&#x63AA;&#x65BD;&#xFF1A;Token&#x9A8C;&#x8BC1; &#x6216;&#x8005; &#x53CC;&#x91CD;Cookie&#x9A8C;&#x8BC1; &#x4EE5;&#x53CA;&#x914D;&#x5408;Samesite Cookie&#x3002;</li><li>&#x4FDD;&#x8BC1;&#x9875;&#x9762;&#x7684;&#x5E42;&#x7B49;&#x6027;&#xFF0C;&#x540E;&#x7AEF;&#x63A5;&#x53E3;&#x4E0D;&#x8981;&#x5728;GET&#x9875;&#x9762;&#x4E2D;&#x505A;&#x7528;&#x6237;&#x64CD;&#x4F5C;&#x3002;</li></ul><p>&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x9632;&#x5FA1;CSRF&#xFF0C;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x5E94;&#x8BE5;&#x662F;&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x603B;&#x7ED3;&#x7684;&#x9632;&#x5FA1;&#x63AA;&#x65BD;&#x65B9;&#x5F0F;&#x4E2D;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#x6765;&#x7EFC;&#x5408;&#x8003;&#x8651;&#xFF0C;&#x7ED3;&#x5408;&#x5F53;&#x524D;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x81EA;&#x8EAB;&#x7684;&#x60C5;&#x51B5;&#x505A;&#x5408;&#x9002;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x624D;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x9884;&#x9632;CSRF&#x7684;&#x53D1;&#x751F;&#x3002;</p><h3 id="articleHeader9">&#x5386;&#x53F2;&#x6848;&#x4F8B;</h3><h4>WordPress&#x7684;CSRF&#x6F0F;&#x6D1E;</h4><p>2012&#x5E74;3&#x6708;&#x4EFD;&#xFF0C;WordPress&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;CSRF&#x6F0F;&#x6D1E;&#xFF0C;&#x5F71;&#x54CD;&#x4E86;WordPress 3.3.1&#x7248;&#x672C;&#xFF0C;WordPress&#x662F;&#x4F17;&#x6240;&#x5468;&#x77E5;&#x7684;&#x535A;&#x5BA2;&#x5E73;&#x53F0;&#xFF0C;&#x8BE5;&#x6F0F;&#x6D1E;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x653B;&#x51FB;&#x8005;&#x4FEE;&#x6539;&#x67D0;&#x4E2A;Post&#x7684;&#x6807;&#x9898;&#xFF0C;&#x6DFB;&#x52A0;&#x7BA1;&#x7406;&#x6743;&#x9650;&#x7528;&#x6237;&#x4EE5;&#x53CA;&#x64CD;&#x4F5C;&#x7528;&#x6237;&#x8D26;&#x6237;&#xFF0C;&#x5305;&#x62EC;&#x4F46;&#x4E0D;&#x9650;&#x4E8E;&#x5220;&#x9664;&#x8BC4;&#x8BBA;&#x3001;&#x4FEE;&#x6539;&#x5934;&#x50CF;&#x7B49;&#x7B49;&#x3002;&#x5177;&#x4F53;&#x7684;&#x5217;&#x8868;&#x5982;&#x4E0B;:</p><ul><li>Add Admin/User</li><li>Delete Admin/User</li><li>Approve comment</li><li>Unapprove comment</li><li>Delete comment</li><li>Change background image</li><li>Insert custom header image</li><li>Change site title</li><li>Change administrator&apos;s email</li><li>Change Wordpress Address</li><li>Change Site Address</li></ul><p>&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6F0F;&#x6D1E;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x653B;&#x51FB;&#x8005;&#x5F15;&#x5BFC;&#x7528;&#x6237;&#x5148;&#x8FDB;&#x5165;&#x76EE;&#x6807;&#x7684;WordPress&#xFF0C;&#x7136;&#x540E;&#x70B9;&#x51FB;&#x5176;&#x9493;&#x9C7C;&#x7AD9;&#x70B9;&#x4E0A;&#x7684;&#x67D0;&#x4E2A;&#x6309;&#x94AE;&#xFF0C;&#x8BE5;&#x6309;&#x94AE;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x8868;&#x5355;&#x63D0;&#x4EA4;&#x6309;&#x94AE;&#xFF0C;&#x5176;&#x4F1A;&#x89E6;&#x53D1;&#x8868;&#x5355;&#x7684;&#x63D0;&#x4EA4;&#x5DE5;&#x4F5C;&#xFF0C;&#x6DFB;&#x52A0;&#x67D0;&#x4E2A;&#x5177;&#x6709;&#x7BA1;&#x7406;&#x5458;&#x6743;&#x9650;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x5B9E;&#x73B0;&#x7684;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="&lt;html&gt; 
&lt;body onload=&quot;javascript:document.forms[0].submit()&quot;&gt; 
&lt;H2&gt;CSRF Exploit to add Administrator&lt;/H2&gt; 
&lt;form method=&quot;POST&quot; name=&quot;form0&quot; action=&quot;http://&lt;wordpress_ip&gt;:80/wp-admin/user-new.php&quot;&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;createuser&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;_wpnonce_create-user&quot; value=&quot;&lt;sniffed_value&gt;&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;_wp_http_referer&quot; value=&quot;%2Fwordpress%2Fwp-admin%2Fuser-new.php&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;user_login&quot; value=&quot;admin2&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;email&quot; value=&quot;admin2@admin.com&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;first_name&quot; value=&quot;admin2@admin.com&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;last_name&quot; value=&quot;&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;url&quot; value=&quot;&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;pass1&quot; value=&quot;password&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;pass2&quot; value=&quot;password&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;role&quot; value=&quot;administrator&quot;/&gt; 
&lt;input type=&quot;hidden&quot; name=&quot;createuser&quot; value=&quot;Add+New+User+&quot;/&gt; 
&lt;/form&gt; 
&lt;/body&gt; 
&lt;/html&gt; " title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;javascript:document.forms[0].submit()&quot;</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">H2</span>&gt;</span>CSRF Exploit to add Administrator<span class="hljs-tag">&lt;/<span class="hljs-name">H2</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;form0&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://&lt;wordpress_ip&gt;:80/wp-admin/user-new.php&quot;</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;action&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;createuser&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_wpnonce_create-user&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&lt;sniffed_value&gt;&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;_wp_http_referer&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;%2Fwordpress%2Fwp-admin%2Fuser-new.php&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user_login&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin2&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin2@admin.com&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;first_name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin2@admin.com&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;last_name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pass1&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pass2&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;role&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;administrator&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;createuser&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Add+New+User+&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span> </code></pre><h4>YouTube&#x7684;CSRF&#x6F0F;&#x6D1E;</h4><p>2008&#x5E74;&#xFF0C;&#x6709;&#x5B89;&#x5168;&#x7814;&#x7A76;&#x4EBA;&#x5458;&#x53D1;&#x73B0;&#xFF0C;YouTube&#x4E0A;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x64CD;&#x4F5C;&#x7684;&#x52A8;&#x4F5C;&#x90FD;&#x5B58;&#x5728;CSRF&#x6F0F;&#x6D1E;&#x3002;&#x5982;&#x679C;&#x653B;&#x51FB;&#x8005;&#x5DF2;&#x7ECF;&#x5C06;&#x89C6;&#x9891;&#x6DFB;&#x52A0;&#x5230;&#x7528;&#x6237;&#x7684;&#x201C;Favorites&#x201D;&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x5C31;&#x80FD;&#x5C06;&#x4ED6;&#x81EA;&#x5DF1;&#x6DFB;&#x52A0;&#x5230;&#x7528;&#x6237;&#x7684;&#x201C;Friend&#x201D;&#x6216;&#x8005;&#x201C;Family&#x201D;&#x5217;&#x8868;&#xFF0C;&#x4EE5;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#x53D1;&#x9001;&#x4EFB;&#x610F;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x5C06;&#x89C6;&#x9891;&#x6807;&#x8BB0;&#x4E3A;&#x4E0D;&#x5B9C;&#x7684;&#xFF0C;&#x81EA;&#x52A8;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x7684;&#x8054;&#x7CFB;&#x4EBA;&#x6765;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x89C6;&#x9891;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x628A;&#x89C6;&#x9891;&#x6DFB;&#x52A0;&#x5230;&#x7528;&#x6237;&#x7684;&#x201C;Favorites&#x201D;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EA;&#x9700;&#x5728;&#x4EFB;&#x4F55;&#x7AD9;&#x70B9;&#x4E0A;&#x5D4C;&#x5165;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x7684;IMG&#x6807;&#x7B7E;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="&lt;img src=&quot;http://youtube.com/watch_ajax?action_add_favorite_playlist=1&amp;video_
id=[VIDEO ID]&amp;playlist_id=&amp;add_to_favorite=1&amp;show=1&amp;button=AddvideoasFavorite&quot;/&gt;" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="xml hljs"><code class="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://youtube.com/watch_ajax?action_add_favorite_playlist=1&amp;video_
id=[VIDEO ID]&amp;playlist_id=&amp;add_to_favorite=1&amp;show=1&amp;button=AddvideoasFavorite&quot;</span>/&gt;</span></code></pre><p>&#x653B;&#x51FB;&#x8005;&#x4E5F;&#x8BB8;&#x5DF2;&#x7ECF;&#x5229;&#x7528;&#x4E86;&#x8BE5;&#x6F0F;&#x6D1E;&#x6765;&#x63D0;&#x9AD8;&#x89C6;&#x9891;&#x7684;&#x6D41;&#x884C;&#x5EA6;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5C06;&#x4E00;&#x4E2A;&#x89C6;&#x9891;&#x6DFB;&#x52A0;&#x5230;&#x8DB3;&#x591F;&#x591A;&#x7528;&#x6237;&#x7684;&#x201C;Favorites&#x201D;&#xFF0C;YouTube&#x5C31;&#x4F1A;&#x628A;&#x8BE5;&#x89C6;&#x9891;&#x4F5C;&#x4E3A;&#x201C;Top Favorites&#x201D;&#x6765;&#x663E;&#x793A;&#x3002;&#x9664;&#x63D0;&#x9AD8;&#x4E00;&#x4E2A;&#x89C6;&#x9891;&#x7684;&#x6D41;&#x884C;&#x5EA6;&#x4E4B;&#x5916;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x8FD8;&#x53EF;&#x4EE5;&#x5BFC;&#x81F4;&#x7528;&#x6237;&#x5728;&#x6BEB;&#x4E0D;&#x77E5;&#x60C5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x4E00;&#x4E2A;&#x89C6;&#x9891;&#x6807;&#x8BB0;&#x4E3A;&#x201C;&#x4E0D;&#x5B9C;&#x7684;&#x201D;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;YouTube&#x5220;&#x9664;&#x8BE5;&#x89C6;&#x9891;&#x3002;</p><p>&#x8FD9;&#x4E9B;&#x653B;&#x51FB;&#x8FD8;&#x53EF;&#x80FD;&#x5DF2;&#x88AB;&#x7528;&#x4E8E;&#x4FB5;&#x72AF;&#x7528;&#x6237;&#x9690;&#x79C1;&#x3002;YouTube&#x5141;&#x8BB8;&#x7528;&#x6237;&#x53EA;&#x8BA9;&#x670B;&#x53CB;&#x6216;&#x4EB2;&#x5C5E;&#x89C2;&#x770B;&#x67D0;&#x4E9B;&#x89C6;&#x9891;&#x3002;&#x8FD9;&#x4E9B;&#x653B;&#x51FB;&#x4F1A;&#x5BFC;&#x81F4;&#x653B;&#x51FB;&#x8005;&#x5C06;&#x5176;&#x6DFB;&#x52A0;&#x4E3A;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x201C;Friend&#x201D;&#x6216;&#x201C;Family&#x201D;&#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x6837;&#x4ED6;&#x4EEC;&#x5C31;&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x6240;&#x6709;&#x539F;&#x672C;&#x53EA;&#x9650;&#x4E8E;&#x597D;&#x53CB;&#x548C;&#x4EB2;&#x5C5E;&#x8868;&#x4E2D;&#x7684;&#x7528;&#x6237;&#x89C2;&#x770B;&#x7684;&#x79C1;&#x4EBA;&#x7684;&#x89C6;&#x9891;&#x3002;</p><p>&#x653B;&#x51FB;&#x8005;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x7684;&#x6240;&#x6709;&#x8054;&#x7CFB;&#x4EBA;&#x540D;&#x5355;&#xFF08;&#x201C;Friends&#x201D;&#x3001;&#x201C;Family&#x201D;&#x7B49;&#x7B49;&#xFF09;&#x6765;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x89C6;&#x9891;&#xFF0C;&#x201C;&#x5171;&#x4EAB;&#x201D;&#x5C31;&#x610F;&#x5473;&#x7740;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x89C6;&#x9891;&#x7684;&#x94FE;&#x63A5;&#x7ED9;&#x4ED6;&#x4EEC;&#xFF0C;&#x5F53;&#x7136;&#x8FD8;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x9644;&#x52A0;&#x6D88;&#x606F;&#x3002;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x4E2D;&#x7684;&#x94FE;&#x63A5;&#x5DF2;&#x7ECF;&#x5E76;&#x4E0D;&#x662F;&#x771F;&#x6B63;&#x610F;&#x4E49;&#x4E0A;&#x7684;&#x89C6;&#x9891;&#x94FE;&#x63A5;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x653B;&#x51FB;&#x6027;&#x7684;&#x7F51;&#x7AD9;&#x94FE;&#x63A5;&#xFF0C;&#x7528;&#x6237;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x70B9;&#x51FB;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#xFF0C;&#x8FD9;&#x4FBF;&#x4F7F;&#x5F97;&#x8BE5;&#x79CD;&#x653B;&#x51FB;&#x80FD;&#x591F;&#x8FDB;&#x884C;&#x75C5;&#x6BD2;&#x5F0F;&#x7684;&#x4F20;&#x64AD;&#x3002;</p><h3 id="articleHeader10">&#x53C2;&#x8003;&#x6587;&#x732E;</h3><ul><li>Mozilla wiki.<a href="https://wiki.mozilla.org/Security/Origin" rel="nofollow noreferrer" target="_blank">Security-Origin</a></li><li>OWASP.<a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF" rel="nofollow noreferrer" target="_blank">Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet</a>_Prevention_Cheat_Sheet).</li><li>Gmail Security Hijack Case.<a href="https://www.davidairey.com/google-gmail-security-hijack/" rel="nofollow noreferrer" target="_blank">Google-Gmail-Security-Hijack</a>.</li><li>Netsparker Blog.<a href="https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/" rel="nofollow noreferrer" target="_blank">Same-Site-Cookie-Attribute-Prevent-Cross-site-Request-Forgery</a></li><li>MDN.<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#IE_Exceptions" rel="nofollow noreferrer" target="_blank">Same-origin_policy#IE_Exceptions</a></li></ul><h2 id="articleHeader11">&#x4E0B;&#x671F;&#x9884;&#x544A;</h2><p>&#x524D;&#x7AEF;&#x5B89;&#x5168;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x5C06;&#x5BF9;XSS&#x3001;CSRF&#x3001;&#x7F51;&#x7EDC;&#x52AB;&#x6301;&#x3001;Hybrid&#x5B89;&#x5168;&#x7B49;&#x5B89;&#x5168;&#x8BAE;&#x9898;&#x5C55;&#x5F00;&#x8BBA;&#x8FF0;&#x3002;&#x4E0B;&#x671F;&#x6211;&#x4EEC;&#x8981;&#x8BA8;&#x8BBA;&#x7684;&#x662F;&#x7F51;&#x7EDC;&#x52AB;&#x6301;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x3002;</p><h2 id="articleHeader12">&#x4F5C;&#x8005;&#x7B80;&#x4ECB;</h2><p>&#x5218;&#x70E8;&#xFF0C;&#x7F8E;&#x56E2;&#x70B9;&#x8BC4;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x8D1F;&#x8D23;&#x5916;&#x5356;&#x7528;&#x6237;&#x7AEF;&#x524D;&#x7AEF;&#x4E1A;&#x52A1;&#x3002;</p><p><span class="img-wrap"><img data-src="/img/remote/1460000016659949?w=1875&amp;h=835" src="https://static.alili.tech/img/remote/1460000016659949?w=1875&amp;h=835" alt="" title="" style="cursor:pointer"></span></p>
{{% /raw %}}

# 版权声明
本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，
本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。
原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！

## 原文标题
前端安全系列之二：如何防止CSRF攻击？

## 原文链接
[https://segmentfault.com/a/1190000016659945](https://segmentfault.com/a/1190000016659945)

