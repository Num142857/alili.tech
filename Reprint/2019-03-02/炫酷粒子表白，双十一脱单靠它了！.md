---
title: 'ç‚«é…·ç²’å­è¡¨ç™½ï¼ŒåŒåä¸€è„±å•é å®ƒäº†ï¼' 
date: 2019-03-02 2:30:07
hidden: true
slug: hqn4m86ws07
categories: [reprint]
---

{{< raw >}}

                    
<p><span class="img-wrap"><img data-src="/img/remote/1460000016908379?w=1100&amp;h=564" src="https://static.alili.tech/img/remote/1460000016908379?w=1100&amp;h=564" alt="æˆ‘è€å©†" title="æˆ‘è€å©†" style="cursor: pointer; display: inline;"></span></p>
<p>â€‹    åŒåä¸€å…‰æ£èŠ‚åˆè¦æ¥ä¸´äº†ï¼Œæ¯å¹´è¿™ä¸ªæ—¶å€™éƒ½æ˜¯æœ¬äººæœ€è‹¦é—·çš„æ—¶åˆ»ã€‚æ—¥æ¸æ¶ˆç˜¦çš„é’±åŒ…ï¼Œæ„ˆå‘å¹²æ¶¸çš„åŒæ‰‹ï¼Œè™½ç„¶å˜å¼ºäº†ï¼Œå¤´å´å˜å‡‰äº†ã€‚ä»Šå¹´ä¸€å®šè¦æç‚¹äº‹æƒ…ï¼</p>
<p>&lt;img src="<a href="https://img.alicdn.com/tfs/TB1vmSanhTpK1RjSZR0XXbEwXXa-400-400.gif&amp;quot" rel="nofollow noreferrer" target="_blank">https://img.alicdn.com/tfs/TB...</a>; alt="fxxking things" width="160"&gt;</p>
<p>â€‹    æœ€è¿‘å¬å¥³ç¥è¯´æƒ³è°ˆæ‹çˆ±äº†ï¼Œâœ§(â‰– â—¡ â‰–) å˜¿å˜¿ï¼Œä¸€å®šä¸èƒ½æ”¾è¿‡è¿™ä¸ªæœºä¼šï¼Œç»™å¥¹æ¥ä¸ªä¸ä¸€æ ·çš„è¡¨ç™½ã€‚</p>
<p>&lt;img src="<a href="https://img.alicdn.com/tfs/TB10VGcnbPpK1RjSZFFXXa5PpXa-1342-752.png&amp;quot" rel="nofollow noreferrer" target="_blank">https://img.alicdn.com/tfs/TB...</a>; alt="æˆ‘è€å©†" width="360"&gt;</p>
<p>ä½œä¸ºæ•´å¤©æå¯è§†åŒ–çš„å‰ç«¯æ”»åŸç‹®ï¼Œæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯å¸¸ç©çš„å„ç§ç²’å­ã€‚é‚£ä¹ˆå’±ä»¬å°±ä¸€èµ·æ¥æŠŠè¿™ä¸ªç²’å­ç³»ç»Ÿç©å‡ºèŠ±æ¥å§ã€‚<br><a href="https://es2049.studio/work-show/textPraticle/" rel="nofollow noreferrer" target="_blank">æ¼”ç¤ºåœ°å€</a></p>
<h2 id="articleHeader0">ç”¨ç²’å­ç»„æˆæ–‡å­—</h2>
<p>é¦–å…ˆï¼Œå’±ä»¬æƒ³ä¸‹è¦å¦‚ä½•å°†ä¸€ç³»åˆ—çš„ç²’å­ç»„æˆä¸€å¥è¡¨ç™½å‘¢ï¼Ÿ</p>
<p>å®ç°åŸç†å…¶å®å¾ˆç®€å•ï¼ŒCanvas ä¸­æœ‰ä¸ª getImageData çš„æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªçŸ©å½¢èŒƒå›´æ‰€æœ‰åƒç´ ç‚¹æ•°æ®ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±è¯•è¯•æ¥è·å–ä¸€ä¸ªæ–‡å­—çš„å½¢çŠ¶å§ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œç”¨ measureText çš„æ–¹æ³•æ¥è®¡ç®—å‡ºæ–‡å­—é€‚å½“çš„å°ºå¯¸å’Œä½ç½®ã€‚</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="å…¨é€‰"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// åˆ›å»ºä¸€ä¸ªè·Ÿç”»å¸ƒç­‰æ¯”ä¾‹çš„ canvas
const width = 100;
const height = ~~(width * this.height / this.width); // this.width , this.height è¯´æ•´ä¸ªç”»å¸ƒçš„å°ºå¯¸
const offscreenCanvas = document.createElement('canvas');
const offscreenCanvasCtx = offscreenCanvas.getContext('2d');
offscreenCanvas.setAttribute('width', width);
offscreenCanvas.setAttribute('height', height);

// åœ¨è¿™ç¦»å± canvas ä¸­å°†æˆ‘ä»¬æƒ³è¦çš„æ–‡å­— textAll ç»˜åˆ¶å‡ºæ¥åï¼Œå†è®¡ç®—å®ƒåˆé€‚çš„å°ºå¯¸
offscreenCanvasCtx.fillStyle = '#000';
offscreenCanvasCtx.font = 'bold 10px Arial';
const measure = offscreenCanvasCtx.measureText(textAll); // æµ‹é‡æ–‡å­—ï¼Œç”¨æ¥è·å–å®½åº¦
const size = 0.8;
// å®½é«˜åˆ†åˆ«è¾¾åˆ°å±å¹•0.8æ—¶çš„size
const fSize = Math.min(height * size * 10 / lineHeight, width * size * 10 / measure.width);  // 10åƒç´ å­—ä½“è¡Œé«˜ lineHeight=7 magic
offscreenCanvasCtx.font = `bold ${fSize}px Arial`;

// æ ¹æ®è®¡ç®—åçš„å­—ä½“å¤§å°ï¼Œåœ¨å°†æ–‡å­—æ‘†æ”¾åˆ°é€‚åˆçš„ä½ç½®ï¼Œæ–‡å­—çš„åæ ‡èµ·å§‹ä½ç½®åœ¨å·¦ä¸‹æ–¹
const measureResize = offscreenCanvasCtx.measureText(textAll);
// æ–‡å­—èµ·å§‹ä½ç½®åœ¨å·¦ä¸‹æ–¹
let left = (width - measureResize.width) / 2;
const bottom = (height + fSize / 10 * lineHeight) / 2;
offscreenCanvasCtx.fillText(textAll, left, bottom);" title="" data-original-title="å¤åˆ¶"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="æ”¾è¿›ç¬”è®°"></span>
      </div>
      </div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè·Ÿç”»å¸ƒç­‰æ¯”ä¾‹çš„ canvas</span>
<span class="hljs-keyword">const</span> width = <span class="hljs-number">100</span>;
<span class="hljs-keyword">const</span> height = ~~(width * <span class="hljs-keyword">this</span>.height / <span class="hljs-keyword">this</span>.width); <span class="hljs-comment">// this.width , this.height è¯´æ•´ä¸ªç”»å¸ƒçš„å°ºå¯¸</span>
<span class="hljs-keyword">const</span> offscreenCanvas = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>);
<span class="hljs-keyword">const</span> offscreenCanvasCtx = offscreenCanvas.getContext(<span class="hljs-string">'2d'</span>);
offscreenCanvas.setAttribute(<span class="hljs-string">'width'</span>, width);
offscreenCanvas.setAttribute(<span class="hljs-string">'height'</span>, height);

<span class="hljs-comment">// åœ¨è¿™ç¦»å± canvas ä¸­å°†æˆ‘ä»¬æƒ³è¦çš„æ–‡å­— textAll ç»˜åˆ¶å‡ºæ¥åï¼Œå†è®¡ç®—å®ƒåˆé€‚çš„å°ºå¯¸</span>
offscreenCanvasCtx.fillStyle = <span class="hljs-string">'#000'</span>;
offscreenCanvasCtx.font = <span class="hljs-string">'bold 10px Arial'</span>;
<span class="hljs-keyword">const</span> measure = offscreenCanvasCtx.measureText(textAll); <span class="hljs-comment">// æµ‹é‡æ–‡å­—ï¼Œç”¨æ¥è·å–å®½åº¦</span>
<span class="hljs-keyword">const</span> size = <span class="hljs-number">0.8</span>;
<span class="hljs-comment">// å®½é«˜åˆ†åˆ«è¾¾åˆ°å±å¹•0.8æ—¶çš„size</span>
<span class="hljs-keyword">const</span> fSize = <span class="hljs-built_in">Math</span>.min(height * size * <span class="hljs-number">10</span> / lineHeight, width * size * <span class="hljs-number">10</span> / measure.width);  <span class="hljs-comment">// 10åƒç´ å­—ä½“è¡Œé«˜ lineHeight=7 magic</span>
offscreenCanvasCtx.font = <span class="hljs-string">`bold <span class="hljs-subst">${fSize}</span>px Arial`</span>;

<span class="hljs-comment">// æ ¹æ®è®¡ç®—åçš„å­—ä½“å¤§å°ï¼Œåœ¨å°†æ–‡å­—æ‘†æ”¾åˆ°é€‚åˆçš„ä½ç½®ï¼Œæ–‡å­—çš„åæ ‡èµ·å§‹ä½ç½®åœ¨å·¦ä¸‹æ–¹</span>
<span class="hljs-keyword">const</span> measureResize = offscreenCanvasCtx.measureText(textAll);
<span class="hljs-comment">// æ–‡å­—èµ·å§‹ä½ç½®åœ¨å·¦ä¸‹æ–¹</span>
<span class="hljs-keyword">let</span> left = (width - measureResize.width) / <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> bottom = (height + fSize / <span class="hljs-number">10</span> * lineHeight) / <span class="hljs-number">2</span>;
offscreenCanvasCtx.fillText(textAll, left, bottom);</code></pre>
<p>å’±ä»¬å¯ä»¥ appendChild åˆ° body é‡Œçœ‹çœ¼</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000016908380" src="https://static.alili.tech/img/remote/1460000016908380" alt="textAll" title="textAll" style="cursor: pointer;"></span></p>
<p>å¥½çš„ã€‚åŒå­¦ä»¬æ³¨æ„ï¼Œæˆ‘è¦å¼€å§‹å˜å½¢äº† [æ¨çœ¼é•œ] ã€‚</p>
<p>getImageData è·å–çš„åƒç´ æ•°æ®æ˜¯ä¸€ä¸ª Uint8ClampedArray ï¼ˆå€¼æ˜¯ 0 - 255 çš„æ•°ç»„ï¼‰ï¼Œ4 ä¸ªæ•°ä¸€ç»„åˆ†åˆ«å¯¹åº”ä¸€ä¸ªåƒç´ ç‚¹çš„ R G B A å€¼ã€‚æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ i * 4 + 3 ä¸ä¸º 0 å°±å¯ä»¥å¾—åˆ°éœ€è¦çš„å­—ä½“å½¢çŠ¶æ•°æ®äº†ã€‚</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="å…¨é€‰"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// texts æ‰€æœ‰çš„å•è¯åˆ†åˆ«è·å– data ï¼Œä¸Šæ–‡çš„ textAll æ˜¯ texts åŠ ä¸€èµ·
Object.values(texts).forEach(item => {
    offscreenCanvasCtx.clearRect(0, 0, width, height);
    offscreenCanvasCtx.fillText(item.text, left, bottom);
    left += offscreenCanvasCtx.measureText(item.text).width;
    const data = offscreenCanvasCtx.getImageData(0, 0, width, height);
    const points = [];
    // åˆ¤æ–­ç¬¬ i * 4 + 3 ä½æ˜¯å¦ä¸º0ï¼Œè·å¾—ç›¸å¯¹çš„ x,y åæ ‡(ä½¿ç”¨æ—¶éœ€ä¹˜ç”»å¸ƒçš„å®é™…é•¿å®½, y åæ ‡ä¹Ÿéœ€è¦å–åå‘)
    for (let i = 0, max = data.width * data.height; i < max; i++) {
        if (data.data[i * 4 + 3]) {
            points.push({
                x: (i % data.width) / data.width,
                y: (i / data.width) / data.height
            });
        }
    }
    // ä¿å­˜åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºåé¢çš„ç»˜åˆ¶
    geometry.push({
        color: item.hsla,
        points
    });
})" title="" data-original-title="å¤åˆ¶"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="æ”¾è¿›ç¬”è®°"></span>
      </div>
      </div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// texts æ‰€æœ‰çš„å•è¯åˆ†åˆ«è·å– data ï¼Œä¸Šæ–‡çš„ textAll æ˜¯ texts åŠ ä¸€èµ·</span>
<span class="hljs-built_in">Object</span>.values(texts).forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    offscreenCanvasCtx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);
    offscreenCanvasCtx.fillText(item.text, left, bottom);
    left += offscreenCanvasCtx.measureText(item.text).width;
    <span class="hljs-keyword">const</span> data = offscreenCanvasCtx.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);
    <span class="hljs-keyword">const</span> points = [];
    <span class="hljs-comment">// åˆ¤æ–­ç¬¬ i * 4 + 3 ä½æ˜¯å¦ä¸º0ï¼Œè·å¾—ç›¸å¯¹çš„ x,y åæ ‡(ä½¿ç”¨æ—¶éœ€ä¹˜ç”»å¸ƒçš„å®é™…é•¿å®½, y åæ ‡ä¹Ÿéœ€è¦å–åå‘)</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, max = data.width * data.height; i &lt; max; i++) {
        <span class="hljs-keyword">if</span> (data.data[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>]) {
            points.push({
                <span class="hljs-attr">x</span>: (i % data.width) / data.width,
                <span class="hljs-attr">y</span>: (i / data.width) / data.height
            });
        }
    }
    <span class="hljs-comment">// ä¿å­˜åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºåé¢çš„ç»˜åˆ¶</span>
    geometry.push({
        <span class="hljs-attr">color</span>: item.hsla,
        points
    });
})</code></pre>
<h2 id="articleHeader1">åˆ¶å®šåœºæ™¯ï¼Œç»˜åˆ¶å›¾å½¢</h2>
<p>æ–‡å­—å›¾å½¢çš„è·å–æ–¹å¼ä»¥åŠæå®šäº†ï¼Œé‚£ä¹ˆå’±ä»¬å°±å¯ä»¥æŠŠå†…å®¹æ•´ä½“è¾“å‡ºäº†ã€‚å’±ä»¬å®šä¹‰ä¸€ä¸ªç®€å•çš„è„šæœ¬æ ¼å¼ã€‚</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="å…¨é€‰"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// hsla æ ¼å¼æ–¹ä¾¿ä»¥ååšè‰²å½©å˜åŒ–çš„æ‰©å±•
const color1 = {h:197,s:'100%',l:'50%',a:'80%'};
const color2 = {h:197,s:'100%',l:'50%',a:'80%'};
// lifeTime ç¥¯æ•°
const Actions = [
    {lifeTime:60,text:[{text:3,hsla:color1}]},
    {lifeTime:60,text:[{text:2,hsla:color1}]},
    {lifeTime:60,text:[{text:1,hsla:color1}]},
    {lifeTime:120,text:[
        {text:'I',hsla:color1},
        {text:'â¤ï¸',hsla:color2},
        {text:'Y',hsla:color1},
        {text:'O',hsla:color1},
        {text:'U',hsla:color1}
    ]},
];" title="" data-original-title="å¤åˆ¶"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="æ”¾è¿›ç¬”è®°"></span>
      </div>
      </div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// hsla æ ¼å¼æ–¹ä¾¿ä»¥ååšè‰²å½©å˜åŒ–çš„æ‰©å±•</span>
<span class="hljs-keyword">const</span> color1 = {<span class="hljs-attr">h</span>:<span class="hljs-number">197</span>,<span class="hljs-attr">s</span>:<span class="hljs-string">'100%'</span>,<span class="hljs-attr">l</span>:<span class="hljs-string">'50%'</span>,<span class="hljs-attr">a</span>:<span class="hljs-string">'80%'</span>};
<span class="hljs-keyword">const</span> color2 = {<span class="hljs-attr">h</span>:<span class="hljs-number">197</span>,<span class="hljs-attr">s</span>:<span class="hljs-string">'100%'</span>,<span class="hljs-attr">l</span>:<span class="hljs-string">'50%'</span>,<span class="hljs-attr">a</span>:<span class="hljs-string">'80%'</span>};
<span class="hljs-comment">// lifeTime ç¥¯æ•°</span>
<span class="hljs-keyword">const</span> Actions = [
    {<span class="hljs-attr">lifeTime</span>:<span class="hljs-number">60</span>,<span class="hljs-attr">text</span>:[{<span class="hljs-attr">text</span>:<span class="hljs-number">3</span>,<span class="hljs-attr">hsla</span>:color1}]},
    {<span class="hljs-attr">lifeTime</span>:<span class="hljs-number">60</span>,<span class="hljs-attr">text</span>:[{<span class="hljs-attr">text</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">hsla</span>:color1}]},
    {<span class="hljs-attr">lifeTime</span>:<span class="hljs-number">60</span>,<span class="hljs-attr">text</span>:[{<span class="hljs-attr">text</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">hsla</span>:color1}]},
    {<span class="hljs-attr">lifeTime</span>:<span class="hljs-number">120</span>,<span class="hljs-attr">text</span>:[
        {<span class="hljs-attr">text</span>:<span class="hljs-string">'I'</span>,<span class="hljs-attr">hsla</span>:color1},
        {<span class="hljs-attr">text</span>:<span class="hljs-string">'â¤ï¸'</span>,<span class="hljs-attr">hsla</span>:color2},
        {<span class="hljs-attr">text</span>:<span class="hljs-string">'Y'</span>,<span class="hljs-attr">hsla</span>:color1},
        {<span class="hljs-attr">text</span>:<span class="hljs-string">'O'</span>,<span class="hljs-attr">hsla</span>:color1},
        {<span class="hljs-attr">text</span>:<span class="hljs-string">'U'</span>,<span class="hljs-attr">hsla</span>:color1}
    ]},
];</code></pre>
<p>æ ¹æ®é¢„è®¾çš„è„šæœ¬è§£æå‡ºæ¯ä¸ªåœºæ™¯çš„å›¾å½¢ï¼ŒåŠ ä¸€ä¸ª tick åˆ¤æ–­æ˜¯å¦åˆ°äº† lifeTime åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå›¾å½¢é‡æ–°ç»˜åˆ¶å›¾å½¢ã€‚</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="å…¨é€‰"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="function draw() {
    this.tick++;
    if (this.tick >= this.actions[this.actionIndex].lifeTime) {
        this.nextAction();
    }
    this.clear();
    this.renderParticles(); // ç»˜åˆ¶ç‚¹
    this.raf = requestAnimationFrame(this.draw);
}

function nextAction() {
    ....//åˆ‡æ¢åœºæ™¯ balabala..
    this.setParticle(); // éšæœºå°†ç‚¹è®¾ç½®åˆ°ä¹‹å‰å¾—åˆ°çš„ action.geometry.points ä¸Š
}" title="" data-original-title="å¤åˆ¶"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="æ”¾è¿›ç¬”è®°"></span>
      </div>
      </div><pre class="javascript hljs"><code class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.tick++;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tick &gt;= <span class="hljs-keyword">this</span>.actions[<span class="hljs-keyword">this</span>.actionIndex].lifeTime) {
        <span class="hljs-keyword">this</span>.nextAction();
    }
    <span class="hljs-keyword">this</span>.clear();
    <span class="hljs-keyword">this</span>.renderParticles(); <span class="hljs-comment">// ç»˜åˆ¶ç‚¹</span>
    <span class="hljs-keyword">this</span>.raf = requestAnimationFrame(<span class="hljs-keyword">this</span>.draw);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextAction</span>(<span class="hljs-params"></span>) </span>{
    ....<span class="hljs-comment">//åˆ‡æ¢åœºæ™¯ balabala..</span>
    <span class="hljs-keyword">this</span>.setParticle(); <span class="hljs-comment">// éšæœºå°†ç‚¹è®¾ç½®åˆ°ä¹‹å‰å¾—åˆ°çš„ action.geometry.points ä¸Š</span>
}</code></pre>
<p><span class="img-wrap"><img data-src="/img/remote/1460000016908381" src="https://static.alili.tech/img/remote/1460000016908381" alt="1" title="1" style="cursor: pointer; display: inline;"></span></p>
<p>è¿™æ ·å’±ä»¬åŸºæœ¬çš„åŠŸèƒ½å·²ç»å®Œæˆäº†ã€‚</p>
<h2 id="articleHeader2">èƒ½ä¸èƒ½å†ç»™åŠ›ä¸€ç‚¹</h2>
<p>è¯´å¥½çš„ç²’å­ç³»ç»Ÿï¼Œç°åœ¨åªæ˜¯ context.arc ç®€å•çš„ç”»äº†ä¸€ç‚¹ã€‚é‚£å’±ä»¬å°±æ¥åŠ ä¸ªç²’å­ç³»ç»Ÿå§ã€‚</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="å…¨é€‰"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="class PARTICLE {
    // x,y,z ä¸ºå½“å‰çš„åæ ‡ï¼Œvx,vy,vz åˆ™æ˜¯3ä¸ªæ–¹å‘çš„é€Ÿåº¦
    constructor(center) {
        this.center = center;
        this.x = 0;
        this.y = 0;
        this.z = 0;
        this.vx = 0;
        this.vy = 0;
        this.vz = 0;
    }
    // è®¾ç½®è¿™äº›ç²’å­éœ€è¦è¿åŠ¨åˆ°çš„ç»ˆç‚¹(ä¸‹ä¸€ä¸ªä½ç½®)
    setAxis(axis) {
        this.nextX = axis.x;
        this.nextY = axis.y;
        this.nextZ = axis.z;
        this.color = axis.color;
    }
    step() {
        // å¼¹åŠ›æ¨¡å‹ è·ç¦»ç›®æ ‡è¶Šè¿œé€Ÿåº¦è¶Šå¿«
        this.vx += (this.nextX - this.x) * SPRING;
        this.vy += (this.nextY - this.y) * SPRING;
        this.vz += (this.nextZ - this.z) * SPRING;
        // æ‘©æ“¦ç³»æ•° è®©ç²’å­å¯ä»¥è¶‹å‘ç¨³å®š
        this.vx *= FRICTION;
        this.vy *= FRICTION;
        this.vz *= FRICTION;
        
        this.x += this.vx;
        this.y += this.vy;
        this.z += this.vz;
    }
    getAxis2D() {
        this.step();
        // 3D åæ ‡ä¸‹çš„ 2D åç§»ï¼Œæš‚ä¸”åªè€ƒè™‘ä½ç½®ï¼Œä¸è€ƒè™‘å¤§å°å˜åŒ–
        const scale = FOCUS_POSITION / (FOCUS_POSITION + this.z);
        return {
            x: this.center.x + (this.x * scale),
            y: this.center.y - (this.y * scale),
        };
    }
}" title="" data-original-title="å¤åˆ¶"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="æ”¾è¿›ç¬”è®°"></span>
      </div>
      </div><pre class="javascript hljs"><code class="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PARTICLE</span> </span>{
    <span class="hljs-comment">// x,y,z ä¸ºå½“å‰çš„åæ ‡ï¼Œvx,vy,vz åˆ™æ˜¯3ä¸ªæ–¹å‘çš„é€Ÿåº¦</span>
    <span class="hljs-keyword">constructor</span>(center) {
        <span class="hljs-keyword">this</span>.center = center;
        <span class="hljs-keyword">this</span>.x = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.y = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.z = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.vx = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.vy = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.vz = <span class="hljs-number">0</span>;
    }
    <span class="hljs-comment">// è®¾ç½®è¿™äº›ç²’å­éœ€è¦è¿åŠ¨åˆ°çš„ç»ˆç‚¹(ä¸‹ä¸€ä¸ªä½ç½®)</span>
    setAxis(axis) {
        <span class="hljs-keyword">this</span>.nextX = axis.x;
        <span class="hljs-keyword">this</span>.nextY = axis.y;
        <span class="hljs-keyword">this</span>.nextZ = axis.z;
        <span class="hljs-keyword">this</span>.color = axis.color;
    }
    step() {
        <span class="hljs-comment">// å¼¹åŠ›æ¨¡å‹ è·ç¦»ç›®æ ‡è¶Šè¿œé€Ÿåº¦è¶Šå¿«</span>
        <span class="hljs-keyword">this</span>.vx += (<span class="hljs-keyword">this</span>.nextX - <span class="hljs-keyword">this</span>.x) * SPRING;
        <span class="hljs-keyword">this</span>.vy += (<span class="hljs-keyword">this</span>.nextY - <span class="hljs-keyword">this</span>.y) * SPRING;
        <span class="hljs-keyword">this</span>.vz += (<span class="hljs-keyword">this</span>.nextZ - <span class="hljs-keyword">this</span>.z) * SPRING;
        <span class="hljs-comment">// æ‘©æ“¦ç³»æ•° è®©ç²’å­å¯ä»¥è¶‹å‘ç¨³å®š</span>
        <span class="hljs-keyword">this</span>.vx *= FRICTION;
        <span class="hljs-keyword">this</span>.vy *= FRICTION;
        <span class="hljs-keyword">this</span>.vz *= FRICTION;
        
        <span class="hljs-keyword">this</span>.x += <span class="hljs-keyword">this</span>.vx;
        <span class="hljs-keyword">this</span>.y += <span class="hljs-keyword">this</span>.vy;
        <span class="hljs-keyword">this</span>.z += <span class="hljs-keyword">this</span>.vz;
    }
    getAxis2D() {
        <span class="hljs-keyword">this</span>.step();
        <span class="hljs-comment">// 3D åæ ‡ä¸‹çš„ 2D åç§»ï¼Œæš‚ä¸”åªè€ƒè™‘ä½ç½®ï¼Œä¸è€ƒè™‘å¤§å°å˜åŒ–</span>
        <span class="hljs-keyword">const</span> scale = FOCUS_POSITION / (FOCUS_POSITION + <span class="hljs-keyword">this</span>.z);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">x</span>: <span class="hljs-keyword">this</span>.center.x + (<span class="hljs-keyword">this</span>.x * scale),
            <span class="hljs-attr">y</span>: <span class="hljs-keyword">this</span>.center.y - (<span class="hljs-keyword">this</span>.y * scale),
        };
    }
}</code></pre>
<p><span class="img-wrap"><img data-src="/img/remote/1460000016908382?w=426&amp;h=170" src="https://static.alili.tech/img/remote/1460000016908382?w=426&amp;h=170" alt="2" title="2" style="cursor: pointer;"></span></p>
<p>å¤§åŠŸå‘Šæˆï¼</p>
<p>æ—¢ç„¶æ˜¯ 3D çš„ç²’å­ï¼Œå…¶å®è¿™ä¸Šé¢è¿˜æœ‰ä¸æ˜¯æ–‡ç« å¯åšï¼ŒåŒå­¦ä»¬å¯ä»¥å‘æŒ¥æƒ³è±¡åŠ›æ¥ç‚¹æ›´é…·ç‚«çš„ã€‚</p>
<h2 id="articleHeader3">è¿˜æœ‰ä»€ä¹ˆå¥½ç©çš„</h2>
<p>ä¸Šé¢æ˜¯å°†ç²’å­æ‘†æˆæ–‡å­—ã€‚é‚£å’±ä»¬å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å†™å…¬å¼æ‘†å‡ºä¸ªé€ å‹ã€‚</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="å…¨é€‰"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// Actions ä¸­ç”¨ func ä»£æ›¿ texts
{
    lifeTime: 100,
    func: (radius) => {
        const i = Math.random() * 1200;
        let x = (i - 1200 / 2) / 300;
        let y = Math.sqrt(Math.abs(x)) - Math.sqrt(Math.cos(x)) * Math.cos(30 * x);
        return {
            x: x * radius / 2,
            y: y * radius / 2,
            z: ~~(Math.random() * 30),
            color: color3
        };
    }
}" title="" data-original-title="å¤åˆ¶"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="æ”¾è¿›ç¬”è®°"></span>
      </div>
      </div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// Actions ä¸­ç”¨ func ä»£æ›¿ texts</span>
{
    <span class="hljs-attr">lifeTime</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">func</span>: <span class="hljs-function">(<span class="hljs-params">radius</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> i = <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">1200</span>;
        <span class="hljs-keyword">let</span> x = (i - <span class="hljs-number">1200</span> / <span class="hljs-number">2</span>) / <span class="hljs-number">300</span>;
        <span class="hljs-keyword">let</span> y = <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-built_in">Math</span>.abs(x)) - <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-built_in">Math</span>.cos(x)) * <span class="hljs-built_in">Math</span>.cos(<span class="hljs-number">30</span> * x);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">x</span>: x * radius / <span class="hljs-number">2</span>,
            <span class="hljs-attr">y</span>: y * radius / <span class="hljs-number">2</span>,
            <span class="hljs-attr">z</span>: ~~(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">30</span>),
            <span class="hljs-attr">color</span>: color3
        };
    }
}</code></pre>
<p>å†æŠŠåˆšæ‰æ–‡å­—è½¬æ¢å½¢çŠ¶çš„æ–¹æ³•ç”¨ä¸€ä¸‹</p>
<div class="widget-codetool" style="display:none;">
      <div class="widget-codetool--inner">
      <span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="å…¨é€‰"></span>
      <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="{
    lifeTime: Infinity,
        func: (width, height) => {
            if(!points.length){
                const img = document.getElementById(&quot;tulip&quot;);
                const offscreenCanvas = document.createElement('canvas');
                const offscreenCanvasCtx = offscreenCanvas.getContext('2d');
                const imgWidth = 200;
                const imgHeight = 200;
                offscreenCanvas.setAttribute('width', imgWidth);
                offscreenCanvas.setAttribute('height', imgHeight);
                offscreenCanvasCtx.drawImage(img, 0, 0, imgWidth, imgHeight);
                let imgData = offscreenCanvasCtx.getImageData(0, 0, imgWidth, imgHeight);
                for (let i = 0, max = imgData.width * imgData.height; i < max; i++) {
                    if (imgData.data[i * 4 + 3]) {
                        points.push({
                            x: (i % imgData.width) / imgData.width,
                            y: (i / imgData.width) / imgData.height
                        });
                    }
                }
            }

            const p = points[~~(Math.random() * points.length)]
            const radius = Math.min(width * 0.8, height * 0.8);
            return {
                x: p.x * radius - radius / 2,
                y: (1 - p.y) * radius - radius / 2,
                z: ~~(Math.random() * 30),
                color: color3
            };
        }
}" title="" data-original-title="å¤åˆ¶"></span>
      <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="æ”¾è¿›ç¬”è®°"></span>
      </div>
      </div><pre class="javascript hljs"><code class="javascript">{
    <span class="hljs-attr">lifeTime</span>: <span class="hljs-literal">Infinity</span>,
        <span class="hljs-attr">func</span>: <span class="hljs-function">(<span class="hljs-params">width, height</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span>(!points.length){
                <span class="hljs-keyword">const</span> img = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"tulip"</span>);
                <span class="hljs-keyword">const</span> offscreenCanvas = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>);
                <span class="hljs-keyword">const</span> offscreenCanvasCtx = offscreenCanvas.getContext(<span class="hljs-string">'2d'</span>);
                <span class="hljs-keyword">const</span> imgWidth = <span class="hljs-number">200</span>;
                <span class="hljs-keyword">const</span> imgHeight = <span class="hljs-number">200</span>;
                offscreenCanvas.setAttribute(<span class="hljs-string">'width'</span>, imgWidth);
                offscreenCanvas.setAttribute(<span class="hljs-string">'height'</span>, imgHeight);
                offscreenCanvasCtx.drawImage(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, imgWidth, imgHeight);
                <span class="hljs-keyword">let</span> imgData = offscreenCanvasCtx.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, imgWidth, imgHeight);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, max = imgData.width * imgData.height; i &lt; max; i++) {
                    <span class="hljs-keyword">if</span> (imgData.data[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>]) {
                        points.push({
                            <span class="hljs-attr">x</span>: (i % imgData.width) / imgData.width,
                            <span class="hljs-attr">y</span>: (i / imgData.width) / imgData.height
                        });
                    }
                }
            }

            <span class="hljs-keyword">const</span> p = points[~~(<span class="hljs-built_in">Math</span>.random() * points.length)]
            <span class="hljs-keyword">const</span> radius = <span class="hljs-built_in">Math</span>.min(width * <span class="hljs-number">0.8</span>, height * <span class="hljs-number">0.8</span>);
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">x</span>: p.x * radius - radius / <span class="hljs-number">2</span>,
                <span class="hljs-attr">y</span>: (<span class="hljs-number">1</span> - p.y) * radius - radius / <span class="hljs-number">2</span>,
                <span class="hljs-attr">z</span>: ~~(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">30</span>),
                <span class="hljs-attr">color</span>: color3
            };
        }
}</code></pre>
<p><span class="img-wrap"><img data-src="/img/remote/1460000016908383" src="https://static.alili.tech/img/remote/1460000016908383" alt="3" title="3" style="cursor: pointer;"></span></p>
<p>â€‹å®Œç¾ ğŸ˜ã€‚</p>
<p>ç„¶åå’±ä¹Ÿå¯ä»¥ç”¨ drawImage ç»˜åˆ¶å›¾ç‰‡æ¥ä»£æ›¿ arc ç”»ç‚¹ã€‚</p>
<p>&lt;img src="<a href="https://img.alicdn.com/tfs/TB1_JffnirpK1RjSZFhXXXSdXXa-916-750.png&amp;quot" rel="nofollow noreferrer" target="_blank">https://img.alicdn.com/tfs/TB...</a>; width="160"&gt;</p>
<p>ç­‰ç­‰ï¼ï¼å‰é¢çš„æ•ˆæœæ€»è§‰å¾—å“ªé‡Œä¸å¯¹åŠ²ï¼Œå¥½åƒæœ‰äº›å¡ ã€‚</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000016908384?w=440&amp;h=339" src="https://static.alili.tech/img/remote/1460000016908384?w=440&amp;h=339" alt="ç¨³å¾—ä¸€ç¬”" title="ç¨³å¾—ä¸€ç¬”" style="cursor: pointer; display: inline;"></span></p>
<h2 id="articleHeader4">ä¼˜åŒ–å°æç¤º</h2>
<ol>
<li>åˆ†å±‚ã€‚å¦‚æœè¿˜éœ€è¦å¢åŠ ä¸€äº›å…¶ä»–çš„å†…å®¹åˆ° Canvas ä¸­çš„è¯ï¼Œå¯ä»¥è€ƒè™‘æ‹†å‡ºå¤šä¸ª Canvas æ¥åšã€‚</li>
<li>å‡å°‘å±æ€§è®¾ç½®ã€‚åŒ…æ‹¬ lineWidthã€fillStyle ç­‰ç­‰ã€‚Canvas ä¸Šä¸‹æ–‡æ˜¯å¾ˆå¤æ‚çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå½“ä½ è°ƒå®ƒçš„ä¸€äº›å±æ€§è®¾ç½®æ—¶æ¶ˆè€—çš„æ€§èƒ½è¿˜æ˜¯ä¸å°‘çš„ã€‚arc ä¹‹ç±»çš„ç”»å›¾æ–¹æ³•ä¹Ÿè¦å‡å°‘ã€‚</li>
<li>ç¦»å±ç»˜åˆ¶ã€‚ä¸ç”¨ arc ç”»ç‚¹ï¼Œè¦æ€ä¹ˆåŠã€‚ä¸Šé¢çš„å»¶è¿Ÿå…¶å®å°±æ˜¯æ¯æ¬¡ç”»ç‚¹æ—¶éƒ½è°ƒç”¨äº†ä¸€é fillStyleã€arcã€‚ä½†æ˜¯å½“æˆ‘ä»¬ç»˜åˆ¶å›¾ç‰‡ drawImage æ—¶ï¼Œæ€§èƒ½æ˜æ˜¾ä¼šå¥½ä¸Šå¾ˆå¤šã€‚drawImage é™¤äº†ç›´æ¥ç»˜å›¾ç‰‡å¤–ï¼Œè¿˜èƒ½ç»˜åˆ¶å¦ä¸€ä¸ª Canvasï¼Œæ‰€ä»¥æˆ‘ä»¬æå‰å°†è¿™äº›ç‚¹ç”»åˆ°ä¸€ä¸ªä¸åœ¨å±å¹•ä¸Šçš„ Canvas é‡Œå°±å¯ä»¥äº†ã€‚</li>
<li>å‡å°‘ js è®¡ç®—ï¼Œé¿å…å µå¡è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ web workerã€‚å½“ç„¶å’±ä»¬ç›®å‰çš„è®¡ç®—å®Œå…¨ç”¨ä¸ä¸Šè¿™ä¸ªã€‚</li>
</ol>
<p>æˆ‘è¿™ä½¿ç”¨äº† 3000 ä¸ªç²’å­ï¼Œå¯¹æ¯”ä¸‹ä½¿ç”¨ç¦»å±ç»˜åˆ¶å‰åçš„å¸§ç‡ã€‚</p>
<p><span class="img-wrap"><img data-src="/img/remote/1460000016908385?w=382&amp;h=256" src="https://static.alili.tech/img/remote/1460000016908385?w=382&amp;h=256" alt="æ–¹ä¸æ–¹" title="æ–¹ä¸æ–¹" style="cursor: pointer;"></span><span class="img-wrap"><img data-src="/img/remote/1460000016908386" src="https://static.alili.tech/img/remote/1460000016908386" alt="åœ†äº†" title="åœ†äº†" style="cursor: pointer;"></span></p>
<h2 id="articleHeader5">æ€»ç»“</h2>
<p>ç°åœ¨å”¯ä¸€é™åˆ¶ä½ çš„å°±æ˜¯æƒ³è±¡åŠ›äº†ã€‚å¤§å®¶ä¸€èµ·å»å¾æœè€æ¿ï¼Œå¾æœå¥³ç¥ï¼</p>
<p>è¿™ä¸ªåŒåä¸€è„±è´«è„±å•ä¸è„±å‘ï¼</p>
<p>å¥½äº†ä¸è¯´äº†ï¼Œå¥³ç¥å–Šæˆ‘ä¿®ç”µè„‘å»äº†ã€‚</p>
<h2 id="articleHeader6">å‚è€ƒ</h2>
<ul>
<li><a href="https://codepen.io/airen/pen/owRMoY" rel="nofollow noreferrer" target="_blank">deformable particles</a><button class="btn btn-xs btn-default ml10 preview" data-url="airen/pen/owRMoY" data-typeid="3">ç‚¹å‡»é¢„è§ˆ</button></li>
<li><a href="https://pixabay.com/zh/%E5%BF%83%E8%84%8F-%E7%88%B1-%E7%BA%A2%E8%89%B2%E7%9A%84%E5%BF%83-%E6%83%85%E4%BA%BA%E8%8A%82%E9%82%A3%E5%A4%A9-%E8%AE%A2%E5%A9%9A-%E6%BF%80%E6%83%85-%E7%BA%A2%E8%89%B2-%E6%84%9F%E8%A7%89-%E7%9C%9F%E7%88%B1-2402086/" rel="nofollow noreferrer" target="_blank">heart.png</a></li>
<li><a href="http://www.w3school.com.cn/tags/html_ref_canvas.asp" rel="nofollow noreferrer" target="_blank">Canvas å‚è€ƒæ‰‹å†Œ</a></li>
<li>y=sqrt(abs(x))-sqrt(cos(x))*cos(40x)<p>â€‹</p>
</li>
</ul>
<blockquote>æ–‡ç« å¯éšæ„è½¬è½½ï¼Œä½†è¯·ä¿ç•™æ­¤ <a href="https://www.yuque.com/es2049/blog" rel="nofollow noreferrer" target="_blank">åŸæ–‡é“¾æ¥</a>ã€‚<br>éå¸¸æ¬¢è¿æœ‰æ¿€æƒ…çš„ä½ åŠ å…¥ <a href="https://es2049.studio/" rel="nofollow noreferrer" target="_blank">ES2049 Studio</a>ï¼Œç®€å†è¯·å‘é€è‡³ caijun.hcj(at)alibaba-inc.com ã€‚</blockquote>

                
{{< /raw >}}

# ç‰ˆæƒå£°æ˜
æœ¬æ–‡èµ„æºæ¥æºäº’è”ç½‘ï¼Œä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œç‰ˆæƒå½’è¯¥èµ„æºçš„åˆæ³•æ‹¥æœ‰è€…æ‰€æœ‰ï¼Œ

æœ¬æ–‡ä»…ç”¨äºå­¦ä¹ ã€ç ”ç©¶å’Œäº¤æµç›®çš„ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€å®Œæ•´é“¾æ¥ä»¥åŠåŸä½œè€…ã€‚

åŸä½œè€…è‹¥è®¤ä¸ºæœ¬ç«™ä¾µçŠ¯äº†æ‚¨çš„ç‰ˆæƒï¼Œè¯·è”ç³»æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šç«‹å³åˆ é™¤ï¼

## åŸæ–‡æ ‡é¢˜
ç‚«é…·ç²’å­è¡¨ç™½ï¼ŒåŒåä¸€è„±å•é å®ƒäº†ï¼

## åŸæ–‡é“¾æ¥
[https://segmentfault.com/a/1190000016908376](https://segmentfault.com/a/1190000016908376)

